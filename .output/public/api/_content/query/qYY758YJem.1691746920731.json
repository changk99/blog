{"_path":"/articles/javascript/proxyandreflect","_dir":"javascript","_draft":false,"_partial":false,"_locale":"zh-Hans","_empty":false,"title":"es6 深入理解 Proxy 和 Reflect 这对影子兄弟","description":"","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"前言"},"children":[{"type":"text","value":"前言"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"vue3.0 使用了 Proxy 对象做响应式系统,让很多人都认识了 Proxy 对象,vue3.0 中的响应式数据甚至是组件实例,其实都是 Proxy 对象。但是这篇文章不是说 Proxy 对象在 vue3.0 是怎样发挥作用的,而是说说其影子兄弟 Reflect。既然是影子,自然是相映相随的。Reflect 中文解释可以是映射,也正好说明其设计初衷。简单来说 Proxy 对象代理并拦截目标对象特定行为,而这些行为都有其默认行为,而 Reflect 对象就是方便可以实现这些默认行为,Proxy 有多少拦截类型,Reflect 就实现了多少对应类型的映射函数("},{"type":"element","tag":"a","props":{"href":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy","rel":["nofollow"]},"children":[{"type":"text","value":"Proxy 对象的拦截类型"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect","rel":["nofollow"]},"children":[{"type":"text","value":"Reflect 对象的映射 API"}]},{"type":"text","value":" 如果对这个两个对象还不是很了解,可以先看看上面链接中对这两个对象的介绍)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n可能你会想,我都知道默认行为了,自已实现不就可以了,为什么还需要 Reflect,为了说明这个问题,下文将针对 set 这个常用拦截类型去说明,如果不用 Reflect 去实现你将遇到多少问题,才能成功实现其默认行为。"}]},{"type":"element","tag":"h2","props":{"id":"存取器属性搭上-receiver-参数"},"children":[{"type":"text","value":"存取器属性搭上 receiver 参数"}]},{"type":"element","tag":"h3","props":{"id":"基础实现"},"children":[{"type":"text","value":"基础实现"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下面先定义基础的代码"}]},{"type":"element","tag":"code","props":{"code":"const target = {\n  _name: '目标对象',\n  get name() {\n    return this._name;\n  },\n  set name(name) {\n    this._name = name;\n  },\n  age: 18\n};\nconst defaultProxy = new Proxy(target, {});\nconst customProxy = new Proxy(target, {\n  set(target, key, value, receiver) {\n    target[key] = value;\n  }\n});\n","language":"javascript","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"_name:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'目标对象'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"18\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {});\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"] = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"});"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"存取器属性"},"children":[{"type":"text","value":"存取器属性"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"先看设置的 target 对象,也就是代理的目标对象,先看 name 属性,可以看到该属性前面有 get set 标识,这类属性叫存取器属性,在访问值和设置值时才会惰性执行对应的 getter setter 函数。\n每一个普通对象属性都有一个对应属性描述对象,下面是其属性描述符对象"}]},{"type":"element","tag":"code","props":{"code":"Object.getOwnPropertyDescriptor(target, 'name')\n{enumerable: true, configurable: true, get: ƒ, set: ƒ}\n","language":"javascript","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"getOwnPropertyDescriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'name'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"enumerable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"configurable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"ƒ"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"ƒ"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"age 属性是一个数据属性,其属性描述符对象是"}]},{"type":"element","tag":"code","props":{"code":"Object.getOwnPropertyDescriptor(target, 'age')\n{value: 18, writable: true, enumerable: true, configurable: true}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"getOwnPropertyDescriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'age'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"18"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"writable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"enumerable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"configurable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果要让一个属性变为只读可以把数据属性的 writable 设置为 false,或者把存取器属性的 set 设置为 undefined,具体怎么设置属性的描述符对象下文会有提及,以上只是稍微说一下基础的知识,下面回归正题"}]},{"type":"element","tag":"h3","props":{"id":"触发-set-拦截的行为"},"children":[{"type":"text","value":"触发 set 拦截的行为"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"defaultProxy 是一个默认的代理对象,没有设置任何拦截行为,接着设置了一个 customProxy 对象并设置了 set 拦截行为,这个方法具有 4 个参数,比较有疑惑的可能是 receiver 参数,下面通过例子就可以知道该参数的作用了。set 方法内部的代码就是要实现 set 拦截的默认行为,如果不用 Reflect 对象,实现其默认行为要遇到多少问题,就是下面要详细说明的内容。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在开始前先根据文档列出了能触发 set 拦截行为的操作"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Property assignment: proxy"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"foo"}]},{"type":"text","value":" = bar and proxy.foo = bar"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Inherited property assignment: Object.create(proxy)"},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"foo"}]},{"type":"text","value":" = bar 代理对象位于原型链上,在这种情况下拦截函数的 receiver 指向子类实例对象"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Reflect.set() 准确来说是 Reflect.set(proxy, key, value, receiver?) 注意第一个参数是代理对象不是目标对象,receiver 是可选值,不存在时指向第一个参数"}]}]},{"type":"element","tag":"h3","props":{"id":"基础实现的问题"},"children":[{"type":"text","value":"基础实现的问题"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"先从最容易的实现开始"}]},{"type":"element","tag":"code","props":{"code":"target[key] = value;\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"] = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"先看默认行为,这里是控制台输出"}]},{"type":"element","tag":"code","props":{"code":"defaultProxy.name = 'hello world';\n('hello world');\ntarget.name;\n('hello world');\ndefaultProxy.age = 3;\n3;\ntarget.age;\n3;\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"再看实现的默认行为"}]},{"type":"element","tag":"code","props":{"code":"customProxy.name = 'hello world';\n('hello world');\ncustomProxy.name;\n('hello world');\ncustomProxy.age = 3;\n3;\ncustomProxy.age;\n3;\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"看似都一样,是不是就已经成功了?下面我们把 set name 修改一下,让其读出 this"}]},{"type":"element","tag":"code","props":{"code":"set name(name) {\n  console.log(this)\n  this._name = name\n},\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"},"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"设置 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"defaultProxy.name = 'hello world'"}]},{"type":"text","value":" this 的输出是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Proxy {_name: \"hello world\", age: 18}"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n设置 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"customProxy.name = 'hello world'"}]},{"type":"text","value":" this 的输出是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"{_name: \"目标对象\", age: 18}"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n设置 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"defaultProxy.name = 'hello world'"}]},{"type":"text","value":" this 的输出是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Proxy {_name: \"hello world\", age: 18}"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n设置 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Reflect.set(defaultProxy, 'name', 'hello world')"}]},{"type":"text","value":" this 的输出是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Proxy {_name: \"hello world\", age: 18}"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n设置 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Reflect.set(defaultProxy, 'name', 'hello world', { a: 1})"}]},{"type":"text","value":" this 的输出是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"{a: 1}"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n设置 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Reflect.set(customProxy, 'name', 'hello world', { a: 1})"}]},{"type":"text","value":" this 的输出是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"{_name: \"hello world\", age: 18}"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n可以看出使用 cunstomProxy 其 this 值总是指向目标对象,因为我们的实现就是简单的对象属性赋值,this 自然就指向目标对象。而默认行为中,this 是指向代理对象的,而通过 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Reflect.set(defaultProxy, 'name', 'hello world', { a: 1})"}]},{"type":"text","value":"可以看出 this 更严格来说是指向 receiver 参数,在没有传入时就取第一个参数的值。"}]},{"type":"element","tag":"h3","props":{"id":"修复存取器属性"},"children":[{"type":"text","value":"修复存取器属性"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"很明显这里实现的默认行为是有问题的,针对这类问题可以修复为"}]},{"type":"element","tag":"code","props":{"code":"set(target, key, value, receiver) {\n  const descriptor = Object.getOwnPropertyDescriptor(target, key)\n  if(descriptor.hasOwnProperty('set')) {\n    const setter = descriptor.set\n    if(typeof setter === 'function' ) {\n      setter.call(receiver, value)\n    }\n  } else {\n    target[key] = value\n  }\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"getOwnPropertyDescriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'set'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"set\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"typeof"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'function'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"] = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"然后按上面的测试方法,测试了一番,发现都满足默认行为了,但是到这步只解决了存取器属性的问题,还有数据属性的还没有解决,下面看看数据属性你会遇到什么问题。"}]},{"type":"element","tag":"h2","props":{"id":"隐匿的-defineproperty-陷阱拦截"},"children":[{"type":"text","value":"隐匿的 defineProperty 陷阱拦截"}]},{"type":"element","tag":"h3","props":{"id":"增加-defineproperty-拦截"},"children":[{"type":"text","value":"增加 defineProperty 拦截"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在开始介绍这个问题前,先增加默认代理对象和实现代理对象一个 defineProperty 拦截,由于是针对 set 拦截实现默认行为,为了不引入其他问题,直接就使用 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"return Reflect.defineProperty(target, property, descriptor)"}]},{"type":"text","value":" 实现 defineProperty 拦截的默认行为"}]},{"type":"element","tag":"code","props":{"code":"const defaultProxy = new Proxy(target, {\n  defineProperty(target, property, descriptor) {\n    console.log(`defaultProxy defineProperty 拦截触发`, target, property, descriptor);\n    return Reflect.defineProperty(target, property, descriptor);\n  }\n});\nconst customProxy = new Proxy(target, {\n  set(target, key, value, receiver) {\n    const descriptor = Object.getOwnPropertyDescriptor(target, key);\n    if (descriptor.hasOwnProperty('set')) {\n      const setter = descriptor.set;\n      if (typeof setter === 'function') {\n        setter.call(receiver, value);\n      }\n    } else {\n      target[key] = value;\n    }\n  },\n  defineProperty(target, property, descriptor) {\n    console.log(`cunstomProxy defineProperty 拦截触发`, target, property, descriptor);\n    return Reflect.defineProperty(target, property, descriptor);\n  }\n});\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"property"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"`defaultProxy defineProperty 拦截触发`"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"property"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Reflect"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"property"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"});\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"getOwnPropertyDescriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'set'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"typeof"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'function'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    } "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"] = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"property"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"`cunstomProxy defineProperty 拦截触发`"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"property"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Reflect"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"property"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"});"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"分析拦截逻辑"},"children":[{"type":"text","value":"分析拦截逻辑"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下面执行默认行为"}]},{"type":"element","tag":"code","props":{"code":"defaultProxy.name = 'hello world'\nProxy {_name: \"目标对象\", age: 18}\ndefaultProxy defineProperty 拦截触发 {_name: \"目标对象\", age: 18} _name {value: \"hello world\"}\n\"hello world\"\ndefaultProxy.age = 3\ndefaultProxy defineProperty 拦截触发 {_name: \"hello world\", age: 18} age {value: 3}\n3\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"目标对象\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"18"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"拦截触发"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"目标对象\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"18"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"} "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"hello world\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"hello world\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"拦截触发"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"hello world\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"18"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"} "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下面执行实现行为"}]},{"type":"element","tag":"code","props":{"code":"customProxy.name = 'hello world'\nProxy {_name: \"目标对象\", age: 18}\n\"hello world\"\ncustomProxy.age = 3\n3\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"目标对象\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"18"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"hello world\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以看出默认的代理行为在设置属性时会触发 defineProperty 拦截,而查看文档你会发现,触发 defineProperty 拦截的行为有"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Object.defineProperty()"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Reflect.defineProperty()"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n这里没有提到对象属性赋值也会触发 defineProperty 拦截,那这个触发行为应该是 set 默认行为所触发,如果要实现该默认行为也需要在 set 拦截中去实现。\n仔细分析以上的输出可以发现,触发 defineProperty 拦截的属性是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"_name"}]},{"type":"text","value":" 和 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"age"}]},{"type":"text","value":",并没有 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"name"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"_name"}]},{"type":"text","value":" 是因为在设置 name 属性时在对应的 setter 函数执行时进行赋值的,从而执行对应的拦截函数,也就是在设置数据属性时会触发 defineProperty 拦截,而设置存取性属性时并不会触发 defineProperty 拦截。"}]}]},{"type":"element","tag":"h3","props":{"id":"修复数据属性"},"children":[{"type":"text","value":"修复数据属性"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"基于上面的分析,让 set 拦截触发 defineProperty 拦截"}]},{"type":"element","tag":"code","props":{"code":"set(target, key, value, receiver) {\n  const descriptor = Object.getOwnPropertyDescriptor(target, key)\n  if(descriptor.hasOwnProperty('set')) {\n    const setter = descriptor.set\n    if(typeof setter === 'function' ) {\n      setter.call(receiver, value)\n    }\n  } else {\n    Object.defineProperty(receiver, key, {\n      value: value\n    })\n  }\n},\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"getOwnPropertyDescriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'set'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"set\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"typeof"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'function'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"},"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"再次运行测试"}]},{"type":"element","tag":"code","props":{"code":"customProxy.name = 'hello world'\nProxy {_name: \"目标对象\", age: 18}\ncunstomProxy defineProperty 拦截触发 {_name: \"目标对象\", age: 18} _name {value: \"hello world\"}\n\"hello world\"\ncustomProxy.age = 3\ncunstomProxy defineProperty 拦截触发 {_name: \"hello world\", age: 18} age {value: 3}\n3\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"目标对象\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"18"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"cunstomProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"拦截触发"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"目标对象\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"18"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"} "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"hello world\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"hello world\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"cunstomProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"拦截触发"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"hello world\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"18"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"} "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"以上的测试都是在修改已经存在的属性,如果增加属性, "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Object.getOwnPropertyDescriptor(target, key)"}]},{"type":"text","value":" 会返回 undefined,执行 hasOwnProperty 方法是会报错的。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n当一个属性使用对象属性赋值的方式设置时,会默认设置为数据属性,而且是可枚举可配置和可写的。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n而且还有一点 Object.defineProperty 这个方法设置属性时,如果属性是新属性,那些忽略设置的描述属性都默认为 false 或者是 undefined,如果是已经存在的属性,忽略设置的描述属性取原来的值,例如"}]},{"type":"element","tag":"code","props":{"code":"let o = {}\nObject.defineProperty(o, 'value', { value: '2'})\n{value: \"2\"}\nObject.getOwnPropertyDescriptor(o, 'value')\n{value: \"2\", writable: false, enumerable: false, configurable: false}\no.name = 'hh'\n\"hh\"\nObject.getOwnPropertyDescriptor(o, 'name')\n{value: \"hh\", writable: true, enumerable: true, configurable: true}configurable: trueenumerable: truevalue: \"hh\"writable: true__proto__: Object\nObject.defineProperty(o, 'name', { value: '3', enumerable: false})\n{value: \"2\", name: \"3\"}\nObject.getOwnPropertyDescriptor(o, 'name')\n{value: \"3\", writable: true, enumerable: false, configurable: true}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = {}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'value'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", { "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'2'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"})\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"2\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"getOwnPropertyDescriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'value'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"2\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"writable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"enumerable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"configurable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hh'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"hh\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"getOwnPropertyDescriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'name'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"hh\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"writable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"enumerable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"configurable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"configurable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"trueenumerable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"truevalue"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"hh\""}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"writable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"true__proto__"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'name'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", { "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'3'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"enumerable:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"})\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"2\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"3\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"getOwnPropertyDescriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'name'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"3\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"writable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"enumerable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"configurable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"基于这些要求重新修改 set 实现"}]},{"type":"element","tag":"code","props":{"code":"set(target, key, value, receiver) {\n  const descriptor = Object.getOwnPropertyDescriptor(target, key)\n  if(descriptor && descriptor.hasOwnProperty('set')) {\n    const setter = descriptor.set\n    if(typeof setter === 'function' ) {\n      setter.call(receiver, value)\n    }\n  } else {\n    Object.defineProperty(receiver, key, descriptor ? {\n      value: value, // 为保持和默认行为一致,不能修改 descriptor.value 后把 descriptor 返回\n    } : {\n      value: value,\n      writable: true,\n      enumerable: true,\n      configurable: true\n    })\n  }\n},\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"getOwnPropertyDescriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" && "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'set'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"set\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"typeof"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'function'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ? {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 为保持和默认行为一致,不能修改 descriptor.value 后把 descriptor 返回\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    } : {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"writable:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"enumerable:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"configurable:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"},"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"defineproperty-拦截的作用"},"children":[{"type":"text","value":"defineProperty 拦截的作用"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"基于上面的实现,也实现了在代理对象作用原型对象时,把数据属性设置在子类实例身上。\n看下面的例子"}]},{"type":"element","tag":"code","props":{"code":"const children = Object.create(target);\nchildren.name = 'hello world';\nconsole.log(children.hasOwnProperty('name')); // false\nconsole.log(children.hasOwnProperty('_name')); // true\nchildren.age = 3;\nconsole.log(children.hasOwnProperty('age')); // true\nconsole.log(children.age); // 3\nconsole.log(target.age); // 18\n\nconst children2 = Object.create(defaultProxy);\nchildren.name = 'hello world';\nconsole.log(children.hasOwnProperty('name')); // false\nconsole.log(children.hasOwnProperty('_name')); // true\nchildren.age = 3;\nconsole.log(children.hasOwnProperty('age')); // true\nconsole.log(children.age); // 3\nconsole.log(target.age); // 18\n\nconst children3 = Object.create(customProxy);\nchildren.name = 'hello world';\nconsole.log(children.hasOwnProperty('name')); // false\nconsole.log(children.hasOwnProperty('_name')); // true\nchildren.age = 3;\nconsole.log(children.hasOwnProperty('age')); // true\nconsole.log(children.age); // 3\nconsole.log(target.age); // 18\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'name'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// false\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'_name'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'age'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 18\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"children2"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'name'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// false\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'_name'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'age'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 18\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"children3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'hello world'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'name'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// false\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'_name'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'age'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"children"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 18"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"当代理对象在原型链上时,子类实例设置属性时,一样会触发代理的拦截行为,这个时候 receiver 参数的值表示的是子类实例,也就是这里的 children,如果 children 设置的属性是存取器属性默认会调用原型链对象中对应属性的 getter setter 函数,而并不会设置在 children 身上。如果是新属性或者是数据属性,那么会设置在自身身上,并不会修改原型链上的属性。如果不采用 defineProperty 进行设置,直接通过 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":" receiver[key] = value"}]},{"type":"text","value":" 来实现,就会出现无限递归。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n数据属性和存取器属性都修复了,还有什么问题吗"}]},{"type":"element","tag":"h2","props":{"id":"invariants"},"children":[{"type":"text","value":"Invariants"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你有看文档,你会发现每一个拦截操作中都有一个 Invariants,中文翻译为不变式。我的理解就是对拦截行为的限制,如果你的拦截行为超出了限制,就会报 TypeError"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n先来看看 set 拦截的限制"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Cannot change the value of a property to be different from the value of the corresponding target object property if the corresponding target object property is a non-writable, non-configurable data property.\n这条限制是针对数据属性的,如果设置的对象属性是非可配置和非可读的,那么拦截函数不能返回 true"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Cannot set the value of a property if the corresponding target object property is a non-configurable accessor property that has undefined as its [[Set]] attribute\n这条限制是针对存取器属性的,如果设置的对象属性是非可配置且 set 为 undefined,,那么拦截函数不能返回 true"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"In strict mode, a false return value from the set() handler will throw a TypeError exception.\n前两条都表明该属性如果是只读属性,就应该是不能修改的,最后一条就是在严格模式下如果返回 false 会触发报错"}]}]},{"type":"element","tag":"code","props":{"code":"const o = {};\nObject.defineProperty(o, 'level', {\n  value: 5 // 没有设置的描述属性均为 false\n});\nObject.defineProperty(o, 'grade', {\n  set: undefined // 没有设置的描述属性均为 false, get 为 undefined\n});\nconst proxy = new Proxy(o, {\n  set() {\n    return true; // 强行认为可以修改,就会触发拦截行为限制错误\n  }\n});\n// proxy.level = 666 // Uncaught TypeError: 'set' on proxy: trap returned truish for property 'level' which exists in the proxy target as a non-configurable and non-writable data property with a different value\n// proxy.grade = 666 // Uncaught TypeError: 'set' on proxy: trap returned truish for property 'grade' which exists in the proxy target as a non-configurable and non-writable accessor property without a setter\n\nvoid (function () {\n  'use strict';\n  const proxy2 = new Proxy(o, {\n    set() {\n      return false;\n    }\n  });\n  proxy2.a = 1;\n  console.log(o); // Uncaught TypeError: 'set' on proxy: trap returned falsish for property 'a'\n})();\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = {};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'level'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 没有设置的描述属性均为 false\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"});\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'grade'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"set:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"undefined"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 没有设置的描述属性均为 false, get 为 undefined\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"});\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 强行认为可以修改,就会触发拦截行为限制错误\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"});\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// proxy.level = 666 // Uncaught TypeError: 'set' on proxy: trap returned truish for property 'level' which exists in the proxy target as a non-configurable and non-writable data property with a different value\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// proxy.grade = 666 // Uncaught TypeError: 'set' on proxy: trap returned truish for property 'grade' which exists in the proxy target as a non-configurable and non-writable accessor property without a setter\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'use strict'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"proxy2"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"proxy2"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// Uncaught TypeError: 'set' on proxy: trap returned falsish for property 'a'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"})();"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果要正确触发这类默认行为,那么在实现中需要正确 return 设置是否成功的信息,这里可能有点难理解,可以看看这个例子"}]},{"type":"element","tag":"code","props":{"code":"const o = {};\nObject.defineProperty(o, 'level', {\n  value: 5 // 没有设置的描述属性均为 false\n});\nconst proxy = new Proxy(o, {});\nproxy.level = 6;\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = {};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'level'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 没有设置的描述属性均为 false\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"});\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"Proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"o"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {});\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"proxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"level"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"6"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这个并不会报错,因为默认行为知道了这个是不能设置的,因此默认拦截函数就返回了 false,因此你如果要实现默认行为,也需要返回一个正确设置与否的信息。不能设置就应该返回 false,可以设置就应该返回 true。"}]},{"type":"element","tag":"h3","props":{"id":"返回设置信息"},"children":[{"type":"text","value":"返回设置信息"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"基于这点我们再来看看有返回时的实现"}]},{"type":"element","tag":"code","props":{"code":"set(target, key, value, receiver) {\nconst descriptor = Object.getOwnPropertyDescriptor(target, key)\nif (typeof descriptor === 'object') {\n  if(descriptor.configurable === 'false' && (descriptor.writable === 'false' || descriptor.set === 'undefined')) {\n    return false\n  }\n}\nif(descriptor && descriptor.hasOwnProperty('set')) {\n  const setter = descriptor.set\n  if(typeof setter === 'function' ) {\n    setter.call(receiver, value)\n    return true\n  }\n} else {\n  Object.defineProperty(receiver, key, descriptor ? {\n  value: value, // 为保持和默认行为一致,不能修改 descriptor.value 后把 descriptor 返回\n  } : {\n    value: value,\n    writable: true,\n    enumerable: true,\n    configurable: true\n  })\n  return true\n}\n},\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"getOwnPropertyDescriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"typeof"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'object'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"configurable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'false'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" && ("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"writable"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'false'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" || "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'undefined'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"false\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" && "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"hasOwnProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'set'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ddbae2"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"set\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"typeof"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'function'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"setter"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"} "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"descriptor"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ? {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// 为保持和默认行为一致,不能修改 descriptor.value 后把 descriptor 返回\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  } : {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"writable:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"enumerable:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"configurable:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"},"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下面测试一下"}]},{"type":"element","tag":"code","props":{"code":"Object.defineProperty(target, 'level', {\n  value: 5\n});\nvoid (function () {\n  'use strict';\n  defaultProxy.level = 6; //Uncaught TypeError: Cannot assign to read only property 'level' of object '[object Object]'\n})();\nvoid (function () {\n  'use strict';\n  customProxy.level = 6; // Uncaught TypeError: 'set' on proxy: trap returned falsish for property 'level'\n})();\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'level'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value:"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"5\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"});\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'use strict'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"level"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"6"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"//Uncaught TypeError: Cannot assign to read only property 'level' of object '[object Object]'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"})();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'use strict'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"customProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"level"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"6"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-29c80c"},"children":[{"type":"text","value":"// Uncaught TypeError: 'set' on proxy: trap returned falsish for property 'level'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"})();"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"虽然都按期望那样报错了,但是报错的内容不同,很明显默认行为还执行了其他的操作。"}]},{"type":"element","tag":"h2","props":{"id":"总结"},"children":[{"type":"text","value":"总结"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最后,其实还是没有实现 set 的真实默认行为,但是通过这个例子,也可以清楚了解到,要模拟真实的默认拦截行为是很复杂的,而 Reflect 设计出来就是为了解决这样的难题。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n下面就是正确的实现"}]},{"type":"element","tag":"code","props":{"code":"set(target, key, value, receiver) {\n  return Reflect.set(target, key, value, receiver)\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-6f9c00"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Reflect"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"receiver"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果使用了拦截函数,并需要执行默认行为,如果要保持代码的健壮性,传入的参数都需要全部传入到 Reflect 对象内,如果漏掉 receiver, receiver 会被当做第一个参数,这样就不会触发 defineProperty 拦截,这个就违背了默认行为"}]},{"type":"element","tag":"code","props":{"code":"Reflect.set(target, 'age', 3)\ntrue\nReflect.set(target, 'age', 3, defaultProxy)\ndefaultProxy defineProperty 拦截触发 {_name: \"目标对象\", age: 3} age {value: 3}\ntrue\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Reflect"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'age'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"Reflect"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-eaf0dd"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"target"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"'age'"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defaultProxy"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"defineProperty"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"拦截触发"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"_name"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-89c091"},"children":[{"type":"text","value":"\"目标对象\""}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"} "}]},{"type":"element","tag":"span","props":{"class":"ct-beff6d"},"children":[{"type":"text","value":"age"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"class":"ct-52b592"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-0f5cdb"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-81ba8d"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a7f3d"},"children":[{"type":"text","value":"true"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"还需要注意的是需要 return 该返回值,不然不会正确触发 Invariants 的限制行为"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这里举的是 set 拦截的例子,其他的拦截例子,如果需要调用默认行为也都是同样的操作,注意两点"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Reflect 中传入全部参数"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"return Reflect 的执行结果"}]}]},{"type":"element","tag":"h2","props":{"id":"参考"},"children":[{"type":"text","value":"参考"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set","rel":["nofollow"]},"children":[{"type":"text","value":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/set","rel":["nofollow"]},"children":[{"type":"text","value":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/set"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-29c80c{color:#6A9955}\n.ct-52b592{color:#C8C8C8}\n.ct-0f5cdb{color:#B5CEA8}\n.ct-6f9c00{color:#C586C0}\n.ct-eaf0dd{color:#DCDCAA}\n.ct-89c091{color:#CE9178}\n.ct-beff6d{color:#9CDCFE}\n.ct-ddbae2{color:#4FC1FF}\n.ct-81ba8d{color:#D4D4D4}\n.ct-2a7f3d{color:#569CD6}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"前言","depth":2,"text":"前言"},{"id":"存取器属性搭上-receiver-参数","depth":2,"text":"存取器属性搭上 receiver 参数","children":[{"id":"基础实现","depth":3,"text":"基础实现"},{"id":"存取器属性","depth":3,"text":"存取器属性"},{"id":"触发-set-拦截的行为","depth":3,"text":"触发 set 拦截的行为"},{"id":"基础实现的问题","depth":3,"text":"基础实现的问题"},{"id":"修复存取器属性","depth":3,"text":"修复存取器属性"}]},{"id":"隐匿的-defineproperty-陷阱拦截","depth":2,"text":"隐匿的 defineProperty 陷阱拦截","children":[{"id":"增加-defineproperty-拦截","depth":3,"text":"增加 defineProperty 拦截"},{"id":"分析拦截逻辑","depth":3,"text":"分析拦截逻辑"},{"id":"修复数据属性","depth":3,"text":"修复数据属性"},{"id":"defineproperty-拦截的作用","depth":3,"text":"defineProperty 拦截的作用"}]},{"id":"invariants","depth":2,"text":"Invariants","children":[{"id":"返回设置信息","depth":3,"text":"返回设置信息"}]},{"id":"总结","depth":2,"text":"总结"},{"id":"参考","depth":2,"text":"参考"}]}},"_type":"markdown","_id":"content:articles:javaScript:ProxyAndReflect.md","_source":"content","_file":"articles/javaScript/ProxyAndReflect.md","_extension":"md"}