<!DOCTYPE html>
<html >
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<title>柯里化在异步编程的应用</title>
<script src="/blog/js/theme.js"></script>
<link rel="icon" href="/blog/favicon.ico">
<meta property="og:title" content="柯里化在异步编程的应用"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/entry.8fdf76cc.js"><link rel="preload" as="style" href="/blog/_nuxt/entry.5dc11e77.css"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ArticleSearch.d6f7f739.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/AsideNav.eb4e1f53.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/_...slug_.05a42231.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentDoc.1f9d7f0a.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentRenderer.aa1034a1.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentRendererMarkdown.d26ca0bf.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/index.0cc3f389.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentQuery.291e75ff.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ClientOnlyIcon.201a84fc.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseH2.33230a00.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseP.9d14936e.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseEm.21359ac6.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseCode.c841e5a6.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/use-global-config.af0e161a.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseA.89ecb759.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/Link.852b0aba.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseCodeInline.e4d0f085.js"><link rel="prefetch" as="image" type="image/jpeg" href="/blog/_nuxt/changlishe.0913a958.jpg"><link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/client-db.2952e394.js"><link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/error-component.15c3a574.js"><link rel="stylesheet" href="/blog/_nuxt/entry.5dc11e77.css"><style>.header{background-color:var(--blog-bg);display:-webkit-box;display:-ms-flexbox;display:flex;position:sticky;top:0;z-index:100;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-image:linear-gradient(0deg,var(--blog-divider-light),var(--blog-divider-light) 1px,transparent 1px,transparent);height:var(--navigation-bar-height)}.header .item{cursor:pointer;margin-right:12px}.header .search{margin-right:auto}.header .avatar-home{-ms-flex-negative:0;flex-shrink:0}@supports ((-webkit-backdrop-filter:blur(1px)) or (backdrop-filter:blur(1px))){.header{-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);background-color:transparent}}.container{display:-webkit-box;display:-ms-flexbox;display:flex;margin:auto;max-width:1360px;min-height:calc(100% - var(--window-top))}.aside{background-color:var(--blog-bg-regular);min-width:var(--aside-min-width)}.aside-stick{max-height:calc(100vh - var(--navigation-bar-height));overflow:auto;padding-bottom:50px;position:sticky;top:var(--window-top)}.aside-stick,.main{-webkit-box-sizing:border-box;box-sizing:border-box}.main{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;min-height:calc(100vh - var(--navigation-bar-height));min-width:0;padding:1.5em;padding-bottom:var(--safe-bottom-area)}.fade-enter-active,.fade-leave-active{-webkit-transition:all .2s;transition:all .2s}.fade-enter-from,.fade-leave-to{opacity:0}.slide-enter-active{-webkit-transition:all .4s;transition:all .4s}.slide-leave-active{-webkit-transition:all .2s;transition:all .2s}.slide-enter-from,.slide-leave-to{-webkit-transform:translateY(100%);transform:translateY(100%)}#__nuxt{background-color:var(--blog-bg-soft)}.to-top{border:1px solid;border-radius:50%;bottom:1em;color:var(--blog-brand-light);cursor:pointer;line-height:1;opacity:.8;padding:.2em;position:fixed;right:2em}.to-top:hover{opacity:1}.article-outline{max-width:300px}@media screen and (max-width:900px){.article-outline{-webkit-box-shadow:1px 1px 5px 1px var(--blog-shadow-color);box-shadow:1px 1px 5px 1px var(--blog-shadow-color);-webkit-box-sizing:border-box;box-sizing:border-box;max-width:var(--aside-max-width);min-height:calc(100% - var(--navigation-bar-height));min-height:100%;position:fixed;right:0;top:var(--navigation-bar-height);-webkit-transform:translateX(calc(var(--aside-max-width) + 20px));transform:translateX(calc(var(--aside-max-width) + 20px));-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s;z-index:100}.article-outline.open{-webkit-transform:translateX(0);transform:translateX(0)}.article-outline .right-aside{position:static}}@media screen and (max-width:768px){.menu{-webkit-box-shadow:-2px 2px 5px 1px var(--blog-shadow-color);box-shadow:-2px 2px 5px 1px var(--blog-shadow-color);left:0;max-width:var(--aside-max-width);min-height:calc(100% - var(--navigation-bar-height));position:fixed;top:var(--navigation-bar-height);-webkit-transform:scale(0);transform:scale(0);-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s;z-index:100}.menu.open{-webkit-transform:scale(1);transform:scale(1)}.menu .left-aside{position:static}}@media screen and (max-width:500px){.search.is-focus{-webkit-box-flex:1;-ms-flex:1;flex:1}.search.is-focus .el-autocomplete{width:100%}.search.is-focus~.item{display:none}}.nuxt-loading-indicator{top:var(--navigation-bar-height)!important}</style><style>.article-search-wrapper .el-input{--el-input-focus-border-color:var(--blog-brand-light)}.article-search-wrapper .el-input__wrapper{background-color:transparent;border-radius:0;-webkit-box-shadow:0 1px 0 0 transparent;box-shadow:0 1px 0 0 transparent;padding:0}.article-search-wrapper .el-input__wrapper.is-focus{-webkit-box-shadow:0 1px 0 0 var(--el-input-focus-border-color);box-shadow:0 1px 0 0 var(--el-input-focus-border-color)}.article-search-wrapper .el-input__suffix .el-input__icon{color:var(--blog-brand-light)}.article-search-wrapper .el-input__suffix .el-input__icon:hover{color:var(--blog-brand-dark)}.article-search .el-autocomplete-suggestion{max-width:500px}.article-search .empty{font-size:12px}.article-search a{line-height:1.6;padding:0 .2em .2em;position:relative;text-decoration:none;vertical-align:baseline}.article-search a,.article-search a:visited{color:var(--blog-brand-light)}.article-search a:hover{color:var(--blog-brand-highlight)}.article-search a:active{color:var(--blog-brand-light)}.article-search-wrapper{padding:0 1em}@media screen and (max-width:500px){.article-search .el-autocomplete-suggestion{max-width:300px}.article-search .el-autocomplete-suggestion li{white-space:normal}}</style><style>.nav[data-v-9a6baa4a]{cursor:auto!important}.dropdown[data-v-9a6baa4a]{display:none;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;direction:ltr;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.dropdown .title[data-v-9a6baa4a]{font-size:14px;white-space:nowrap}.dropdown .arrow[data-v-9a6baa4a]{padding:0 .3em;-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s}.nav-list[data-v-9a6baa4a]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;list-style:none;margin:0;padding:0}.nav-list a[data-v-9a6baa4a]{color:var(--blog-text-1);font-size:14px;text-decoration:none;white-space:nowrap}.nav-item[data-v-9a6baa4a]{margin:0;padding:.1em .3em;position:relative}.nav-item.active[data-v-9a6baa4a],.nav-item[data-v-9a6baa4a]:hover{color:var(--blog-brand-light)}.nav-item .link[data-v-9a6baa4a]{color:inherit;padding:.4em 0}.nav-item[data-v-9a6baa4a]:before{border-bottom:2px solid var(--blog-brand-light);content:"";height:100%;left:100%;position:absolute;top:0;-webkit-transition:all .2s linear;transition:all .2s linear;width:0;z-index:-1}.nav-item[data-v-9a6baa4a]:hover:before{left:0;width:100%}.nav-item:hover~.nav-item[data-v-9a6baa4a]:before{left:0}@media screen and (max-width:500px){.nav[data-v-9a6baa4a]{direction:rtl}.dropdown[data-v-9a6baa4a]{display:-webkit-box;display:-ms-flexbox;display:flex}.dropdown.open .arrow[data-v-9a6baa4a]{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.dropdown .title.active[data-v-9a6baa4a]{color:var(--blog-brand-light)}.nav-list[data-v-9a6baa4a]{--top:auto;position:fixed;-webkit-box-orient:vertical;-webkit-box-direction:normal;direction:ltr;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;background-color:var(--blog-bg-regular);border:1px solid var(--blog-text-4);border-radius:.4em;-webkit-box-shadow:var(--blog-shadow-4);box-shadow:var(--blog-shadow-4);margin-top:.2em;padding:.5em .4em 1em;top:var(--top);-webkit-transform:scale(0);transform:scale(0);-webkit-transform-origin:50% 0;transform-origin:50% 0;-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s}.nav-list a[data-v-9a6baa4a]{font-size:13px}.nav-list[data-v-9a6baa4a]:after{border-bottom:1px solid transparent;border-left:1px solid var(--blog-text-4);border-right:1px solid transparent;border-top:1px solid var(--blog-text-4);height:.3em;right:calc(50% - .3em);top:calc(-.3em + 1px);-webkit-transform:rotate(45deg);transform:rotate(45deg);width:.3em;z-index:-1}.nav-list[data-v-9a6baa4a]:after,.nav-list[data-v-9a6baa4a]:before{background-color:var(--blog-bg-regular);content:"";position:absolute}.nav-list[data-v-9a6baa4a]:before{height:.5em;pointer-events:none;right:calc(50% - .5em);top:0;width:1em}.dropdown.open+.nav-list[data-v-9a6baa4a]{-webkit-transform:scale(1);transform:scale(1)}}</style><style>.theme-change[data-v-eea72278]{font-size:0}.theme-change .switch[data-v-eea72278]{background:var(--blog-bg-soft);border:1px solid var(--blog-border-color-1);border-radius:10px;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:inline-block;font-size:16px;height:20px;margin:0;outline:none;position:relative;-webkit-transition:border-color var(--transition-duration),background-color var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration)!important;width:40px}.theme-change .switch[data-v-eea72278]:hover{border-color:var(--blog-border-color-3)}.theme-change .switch__action[data-v-eea72278]{background-color:var(--blog-bg);border-radius:50%;color:var(--blog-text-1);left:1px;position:absolute;top:1px;-webkit-transform:translate(0);transform:translate(0);-webkit-transition:border-color var(--transition-duration),background-color var(--transition-duration),-webkit-transform var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration),-webkit-transform var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration),transform var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration),transform var(--transition-duration),-webkit-transform var(--transition-duration)!important}.theme-change .switch__action[data-v-eea72278],.theme-change .switch__icon[data-v-eea72278]{height:16px;width:16px}.theme-change .switch__icon[data-v-eea72278]{position:relative}.theme-change .icon[data-v-eea72278]{left:0;position:absolute;top:0;-webkit-transition:color var(--transition-duration),opacity var(--transition-duration)!important;transition:color var(--transition-duration),opacity var(--transition-duration)!important}.theme-change .dark-icon[data-v-eea72278]{opacity:0}.dark .switch__action[data-v-eea72278]{-webkit-transform:translate(20px);transform:translate(20px)}.dark .dark-icon[data-v-eea72278]{opacity:1}.dark .light-icon[data-v-eea72278]{opacity:0}</style><style>.icon[data-v-95f7ae78]{fill:currentColor;vertical-align:middle}</style><style>.icon[data-v-42e682c2]{fill:currentColor;vertical-align:middle}</style><style>.icon[data-v-7a55d05e]{fill:currentColor;vertical-align:middle}</style><style>.aside-nav{--el-menu-item-height:44px;--el-menu-base-level-padding:20px;--el-menu-level-padding:1em;--el-menu-sub-item-height:calc(var(--el-menu-item-height) - 6px);padding-top:1em}.aside-nav a{color:var(--blog-text-2);overflow:hidden;text-decoration:none;text-overflow:ellipsis;-webkit-box-flex:1;-ms-flex:1;flex:1}.aside-nav a:hover{color:var(--blog-text-1)}.aside-nav a.router-link-active{color:var(--blog-brand-light)}.aside-nav .el-menu-item{cursor:auto;display:-webkit-box;display:-ms-flexbox;display:flex;font-size:12px;margin:0}.aside-nav .el-divider--horizontal{margin:12px 0}.open-menu{color:var(--blog-brand-light);cursor:pointer;left:0;opacity:.9;padding:.1em .5em .5em;position:fixed;top:calc(var(--navigation-bar-height));-webkit-transition:opacity .3s;transition:opacity .3s;z-index:101}.open-menu .toggle-icon{-webkit-transform:rotate(45deg);transform:rotate(45deg);-webkit-transition:-webkit-transform .5s;transition:-webkit-transform .5s;transition:transform .5s;transition:transform .5s,-webkit-transform .5s}.open-menu.open .toggle-icon{-webkit-transform:rotate(215deg);transform:rotate(215deg)}.scrolling .open-menu{opacity:0}@media screen and (min-width:768px){.open-menu{display:none}}</style><style>.wrapper[data-v-1423ab59]{display:none;height:50px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.wrapper.loading[data-v-1423ab59]{display:-webkit-box;display:-ms-flexbox;display:flex}.snow[data-v-1423ab59]{-webkit-animation:rotating-1423ab59 2s linear infinite;animation:rotating-1423ab59 2s linear infinite;color:var(--blog-text-2);height:24px;width:24px}@-webkit-keyframes rotating-1423ab59{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotating-1423ab59{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.spinner[data-v-1423ab59]{height:24px;width:24px}.spinner .path[data-v-1423ab59]{-webkit-animation:loading-dash-1423ab59 1.5s ease-in-out infinite;animation:loading-dash-1423ab59 1.5s ease-in-out infinite;stroke-dasharray:90,150;stroke-dashoffset:0;stroke-width:2;stroke:var(--blog-text-2);stroke-linecap:round}.spinner .circular[data-v-1423ab59]{-webkit-animation:loading-rotate-1423ab59 2s linear infinite;animation:loading-rotate-1423ab59 2s linear infinite}@-webkit-keyframes loading-dash-1423ab59{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}@keyframes loading-dash-1423ab59{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}@-webkit-keyframes loading-rotate-1423ab59{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes loading-rotate-1423ab59{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}</style><style>.content-doc[data-v-58a2f6cb]{padding-bottom:2em}.content-doc[data-v-58a2f6cb] .content{min-height:400px}.content-doc .error[data-v-58a2f6cb]{color:var(--blog-text-1);font-size:2.66667vw;text-align:center}.content-doc .error[data-v-58a2f6cb] .refresh{color:var(--blog-brand-light);cursor:pointer}.nav[data-v-58a2f6cb]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.nav .link[data-v-58a2f6cb]{color:var(--blog-brand-light);font-weight:bolder;line-height:1.6;text-decoration:none;vertical-align:baseline;white-space:nowrap}.nav .link .title[data-v-58a2f6cb]{display:inline-block;vertical-align:middle;white-space:normal}.nav .link[data-v-58a2f6cb]:hover{color:var(--blog-brand-highlight)}.nav .link[data-v-58a2f6cb]:active{color:var(--blog-brand-light)}.nav .dir-title[data-v-58a2f6cb]{color:var(--blog-text-2);font-size:14px}.nav .nav-item[data-v-58a2f6cb]{min-width:0;word-break:break-all}.nav .nav-item-after .dir-title[data-v-58a2f6cb]{margin-right:1em;text-align:right}.nav .nav-item-before[data-v-58a2f6cb]{padding-right:2em}.nav .nav-item-before .dir-title[data-v-58a2f6cb]{margin-left:1em}</style><style>.icon[data-v-d5088638]{fill:currentColor;vertical-align:middle}</style><style>.title[data-v-924fdd6f]{color:var(--blog-text-h);font-size:var(--blog-font-size-h2);margin:.2em 0;padding-left:.2em}.link[data-v-924fdd6f]{color:inherit;text-decoration:none}.symbol[data-v-924fdd6f]{color:var(--blog-brand-light);opacity:0}.title:hover .symbol[data-v-924fdd6f]{opacity:1}</style><style>.prose-p[data-v-4aba2c1d]{padding:0}</style><style>.prose-code{background-color:var(--blog-gray-light-5);border:1px solid var(--blog-border-color-3);border-radius:var(--blog-radius-2);-webkit-box-sizing:border-box;box-sizing:border-box;margin:1em 0;padding:1em;position:relative}.prose-code.lang{background-color:var(--blog-black-regular);padding-bottom:0;padding-right:1.6em;padding-top:1.8em}.prose-code.lang .file-info{color:var(--blog-text-dark-2);font-size:12px;position:absolute;right:1em;top:.5em}.prose-code.lang pre code{white-space:pre;word-wrap:normal;color:hsla(0,0%,100%,.87);font-size:.9em;line-height:1.35}.prose-code.no-lang{padding-bottom:.2em;padding-top:1.2em}.prose-code.no-lang pre{font-family:inherit}.prose-code.no-lang pre code{font-family:inherit;padding-bottom:.8em;white-space:pre-wrap}.prose-code.no-lang a{padding:0 .2em;position:relative;text-decoration:none;vertical-align:baseline}.prose-code.no-lang a,.prose-code.no-lang a:visited{color:var(--blog-brand-light)}.prose-code.no-lang a:hover{color:var(--blog-brand-highlight)}.prose-code.no-lang a:active{color:var(--blog-brand-light)}.prose-code pre{margin:0}.prose-code pre code{display:inline-block;overflow:auto;padding-bottom:1.5em;white-space:normal;width:100%}.prose-code .copy{bottom:.5em;color:var(--blog-text-dark-1);cursor:pointer;opacity:.5;position:absolute;right:.2em}.prose-code:hover .copy{opacity:1}pre code .line{display:block;line-height:1.6;min-height:1rem}.dark .prose-code.no-lang{background-color:var(--blog-black-regular)}.el-message--success.copy{white-space:nowrap;width:auto;--el-message-bg-color:var(--blog-bg-soft);--el-message-border-color:var(--blog-border-color-2);--el-message-text-color:var(--blog-text-2)}.prose-code ::-webkit-scrollbar{height:8px;width:10px}.prose-code ::-webkit-scrollbar-track{background:var(--blog-black-soft);border-radius:10px}.prose-code ::-webkit-scrollbar-thumb{background:var(--blog-black-mute);border-radius:10px}.prose-code ::-webkit-scrollbar-thumb:hover{background:#646464;border-radius:10px}.prose-code ::-webkit-scrollbar-thumb:active{background:#444;border-radius:10px}@media screen and (max-width:768px){.prose-code ::-webkit-scrollbar{height:2px;width:2px}}</style><style>.prose-a{border-bottom:1px dashed;font-weight:bolder;line-height:1.6;padding:0 .2em .2em;position:relative;text-decoration:none;vertical-align:baseline}.prose-a,.prose-a:visited{color:var(--blog-brand-light)}.prose-a:hover{color:var(--blog-brand-highlight)}.prose-a:active{color:var(--blog-brand-light)}.prose-a .external-icon{margin-left:-.8em;opacity:0;-webkit-transform:translate(.8em,-.8em);transform:translate(.8em,-.8em)}.prose-a:hover .external-icon{opacity:1}</style><style>.icon[data-v-20b97dad]{fill:currentColor;vertical-align:middle}</style><style>.prose-code-inline[data-v-39cc8780]{background-color:var(--blog-black-regular);border-radius:var(--blog-radius-1);color:var(--blog-text-dark-1);padding:.3em .5em}</style></head>
<body ><div id="__nuxt"><!--[--><header class="header"><div class="search item"><div class="article-search-wrapper"><span></span></div></div><nav class="nav item" data-v-9a6baa4a><!--[--><div class="dropdown" data-v-9a6baa4a><span class="title" data-v-9a6baa4a>文章</span><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 1024 1024" class="icon arrow" data-v-9a6baa4a data-v-d5088638><path d="M831.872 340.864 512 652.672 192.128 340.864a30.592 30.592 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.592 30.592 0 0 0-42.752 0z" data-v-d5088638></path></svg></div><ul class="nav-list" data-v-9a6baa4a><!--[--><li class="active nav-item" data-v-9a6baa4a><a href="/blog/articles/css/bfcstackcascading" class="link" data-v-9a6baa4a>文章</a></li><li class="nav-item" data-v-9a6baa4a><a href="/blog/browser_plugins/modifyingwebdata/install" class="link" data-v-9a6baa4a>浏览器插件</a></li><li class="nav-item" data-v-9a6baa4a><a href="/blog/tools/unicodesearch" class="link" data-v-9a6baa4a>工具</a></li><!--]--></ul><!--]--></nav><div class="theme-change item" title="切换主题" data-v-eea72278><button role="switch" aria-label="切换暗色主题" aria-checked="false" class="switch" data-v-eea72278><div class="switch__action" data-v-eea72278><div class="switch__icon" data-v-eea72278><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon dark-icon icon" data-v-eea72278 data-v-95f7ae78><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z" data-v-95f7ae78></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon light-icon icon" data-v-eea72278 data-v-42e682c2><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z" data-v-42e682c2></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z" data-v-42e682c2></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z" data-v-42e682c2></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z" data-v-42e682c2></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z" data-v-42e682c2></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z" data-v-42e682c2></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z" data-v-42e682c2></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z" data-v-42e682c2></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z" data-v-42e682c2></path></svg></div></div></button></div><div title="github 仓库" class="item"><svg xmlns="http://www.w3.org/2000/svg" width="1.8em" height="1.8em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-7a55d05e><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z" data-v-7a55d05e></path></svg></div><span class="el-avatar el-avatar--circle avatar-home item" style="--el-avatar-size:26px;" title="首页"><img src="/blog/_nuxt/changlishe.0913a958.jpg" alt="首页" style="object-fit:cover;"></span></header><div class="container"><aside style="" class="open aside menu"><div class="aside-stick left-aside"><nav class="nav"><span></span><ul role="menubar" style="--el-menu-level:0;" class="el-menu el-menu--vertical aside-nav"><!--[--><!--]--><div class="wrapper loading" data-v-1423ab59><div class="spinner" data-v-1423ab59><svg class="circular" viewBox="0 0 50 50" data-v-1423ab59><circle class="path" cx="25" cy="25" r="20" fill="none" data-v-1423ab59></circle></svg></div><!----></div><div class="el-divider el-divider--horizontal" style="--el-border-style:solid;" role="separator"><!--v-if--></div><!--[--><li class="el-menu-item" role="menuitem" tabindex="-1"><!--[--><!--[--><a href="/blog/test" class="">markdown</a><!--]--><!--[--><!--]--><!--]--></li><!--]--></ul></nav></div></aside><main class="main"><div class="content-doc" data-v-58a2f6cb><!--[--><div class="content"><h2 class="title" id="柯里化" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/curryandasync#柯里化" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->柯里化<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->js 中函数作为一等公民,函数执行中既可以作为函数的参数也可以作为函数的返回值,而这类执行函数叫做高阶函数,利用高阶函数的特性很容易就可以实现柯里化(<em><!--[-->柯里化(Currying)是把接受多个参数的函数变换成接受一个单一参数(最初函数的第一个参数)的函数，并且返回接受余下的参数且返回结果的新函数的技术<!--]--></em>),根据百科的理解大概就是下面的例子。<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-5bda67">function</span><span class="ct-712218"> </span><span class="ct-d3acbd">add</span><span class="ct-712218">(</span><span class="ct-d8589a">x</span><span class="ct-712218">, </span><span class="ct-d8589a">y</span><span class="ct-712218">) {
</span></span><span class="line" line="2"><span class="ct-712218">  </span><span class="ct-223fba">return</span><span class="ct-712218"> </span><span class="ct-d8589a">x</span><span class="ct-712218"> + </span><span class="ct-d8589a">y</span><span class="ct-712218">;
</span></span><span class="line" line="3"><span class="ct-712218">}
</span></span><span class="line" line="4"><span class="ct-5bda67">function</span><span class="ct-712218"> </span><span class="ct-d3acbd">curryind_add</span><span class="ct-712218">(</span><span class="ct-d8589a">x</span><span class="ct-712218">) {
</span></span><span class="line" line="5"><span class="ct-712218">  </span><span class="ct-223fba">return</span><span class="ct-712218"> </span><span class="ct-5bda67">function</span><span class="ct-712218"> (</span><span class="ct-d8589a">y</span><span class="ct-712218">) {
</span></span><span class="line" line="6"><span class="ct-712218">    </span><span class="ct-223fba">return</span><span class="ct-712218"> </span><span class="ct-d8589a">x</span><span class="ct-712218"> + </span><span class="ct-d8589a">y</span><span class="ct-712218">;
</span></span><span class="line" line="7"><span class="ct-712218">  };
</span></span><span class="line" line="8"><span class="ct-712218">}
</span></span><span class="line" line="9"><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">curried_add</span><span class="ct-712218"> = </span><span class="ct-d3acbd">curryind_add</span><span class="ct-712218">(</span><span class="ct-a1c1b9">1</span><span class="ct-712218">);
</span></span><span class="line" line="10"><span class="ct-d3acbd">curried_add</span><span class="ct-712218">(</span><span class="ct-a1c1b9">2</span><span class="ct-712218">); </span><span class="ct-bd2f04">// 3
</span></span><span class="line" line="11"><span class="ct-d3acbd">curried_add</span><span class="ct-712218">(</span><span class="ct-a1c1b9">3</span><span class="ct-712218">); </span><span class="ct-bd2f04">// 4</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->从例子可以看出,柯里化有防止参数重复的作用,而且具有延迟执行的特征。下面利用柯里化的特征看看在异步编程的应用,在开始时先简单介绍一下 async/await 的原理。<!--]--></p><h2 class="title" id="generator-和-promise" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/curryandasync#generator-和-promise" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->Generator 和 promise<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->async/await 语法其实是 Generator 和 promise 的语法糖。<!--]--></p><p class="prose-p" data-v-4aba2c1d><!--[-->Generator 函数执行时会返回一个生成器对象,该对象是一个特殊的迭代器对象,而且本身也是一个可迭代对象(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#The_iterable_protocol" rel="nofollow" target="_blank" class="prose-a"><!--[-->迭代器对象和可迭代对象<!--]--><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon external-icon" data-v-20b97dad><path fill="currentColor" d="M10 6v2H5v11h11v-5h2v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm11-3v8h-2V6.413l-7.793 7.794l-1.414-1.414L17.585 5H13V3h8z" data-v-20b97dad></path></svg></a>),下面说说其特殊性。<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-5bda67">function*</span><span class="ct-712218"> </span><span class="ct-d3acbd">generator</span><span class="ct-712218">() {
</span></span><span class="line" line="2"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">value</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-a1c1b9">1</span><span class="ct-712218">;
</span></span><span class="line" line="3"><span class="ct-712218">  </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">value</span><span class="ct-712218">);
</span></span><span class="line" line="4"><span class="ct-712218">  </span><span class="ct-223fba">try</span><span class="ct-712218"> {
</span></span><span class="line" line="5"><span class="ct-712218">    </span><span class="ct-bd2f04">// 捕获错误
</span></span><span class="line" line="6"><span class="ct-712218">    </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-a1c1b9">2</span><span class="ct-712218">;
</span></span><span class="line" line="7"><span class="ct-712218">  } </span><span class="ct-223fba">catch</span><span class="ct-712218"> (</span><span class="ct-d8589a">e</span><span class="ct-712218">) {
</span></span><span class="line" line="8"><span class="ct-712218">    </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">e</span><span class="ct-712218">);
</span></span><span class="line" line="9"><span class="ct-712218">  }
</span></span><span class="line" line="10"><span class="ct-712218">}
</span></span><span class="line" line="11"><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">iterator</span><span class="ct-712218"> = </span><span class="ct-d3acbd">generator</span><span class="ct-712218">();
</span></span><span class="line" line="12"><span class="ct-d8589a">iterator</span><span class="ct-712218"> === </span><span class="ct-d8589a">iterator</span><span class="ct-712218">[</span><span class="ct-d8589a">Symbol</span><span class="ct-712218">.</span><span class="ct-d8589a">iterator</span><span class="ct-712218">](); </span><span class="ct-bd2f04">// true 自身部署了可迭代接口,该接口返回自身
</span></span><span class="line" line="13"><span class="ct-712218">[...</span><span class="ct-d8589a">iterator</span><span class="ct-712218">]; </span><span class="ct-bd2f04">// [1, 2]
</span></span><span class="line" line="14"><span>
</span></span><span class="line" line="15"><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">iterator2</span><span class="ct-712218"> = </span><span class="ct-d3acbd">generator</span><span class="ct-712218">(); </span><span class="ct-bd2f04">// 迭代器对象是一次消耗的,需要重新起一个迭代器
</span></span><span class="line" line="16"><span class="ct-d8589a">iterator2</span><span class="ct-712218">.</span><span class="ct-d3acbd">next</span><span class="ct-712218">(); </span><span class="ct-bd2f04">// {value: 1, done: false}
</span></span><span class="line" line="17"><span class="ct-d8589a">iterator2</span><span class="ct-712218">.</span><span class="ct-d3acbd">next</span><span class="ct-712218">(</span><span class="ct-999635">`value 的值`</span><span class="ct-712218">); </span><span class="ct-bd2f04">// 利用 next 向生成器函数发送数据
</span></span><span class="line" line="18"><span class="ct-d8589a">iterator2</span><span class="ct-712218">.</span><span class="ct-d3acbd">throw</span><span class="ct-712218">(</span><span class="ct-5bda67">new</span><span class="ct-712218"> </span><span class="ct-d3acbd">Error</span><span class="ct-712218">(</span><span class="ct-999635">&#39;error&#39;</span><span class="ct-712218">)); </span><span class="ct-bd2f04">// 利用 throw 向生成器函数抛出错误</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->从上面的例子可以看出,生成器对象,在迭代的过程中是可以和生成器函数进行通信的,如果用在 promise 中,只要把 promise 在状态改变后执行的回调结果回传到生成器函数内就可以实现类似 async/await 的效果。而迭代过程,可以实现一个执行器函数进行迭代,这个函数就类似于执行 async。<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-5bda67">function</span><span class="ct-712218"> </span><span class="ct-d3acbd">createDelayPromise</span><span class="ct-712218">(</span><span class="ct-d8589a">time</span><span class="ct-712218">) {
</span></span><span class="line" line="2"><span class="ct-712218">  </span><span class="ct-223fba">return</span><span class="ct-712218"> </span><span class="ct-5bda67">new</span><span class="ct-712218"> </span><span class="ct-dcbca7">Promise</span><span class="ct-712218">((</span><span class="ct-d8589a">resolve</span><span class="ct-712218">) </span><span class="ct-5bda67">=&gt;</span><span class="ct-712218"> {
</span></span><span class="line" line="3"><span class="ct-712218">    </span><span class="ct-d3acbd">setTimeout</span><span class="ct-712218">(() </span><span class="ct-5bda67">=&gt;</span><span class="ct-712218"> {
</span></span><span class="line" line="4"><span class="ct-712218">      </span><span class="ct-d3acbd">resolve</span><span class="ct-712218">(</span><span class="ct-d8589a">time</span><span class="ct-712218">);
</span></span><span class="line" line="5"><span class="ct-712218">    }, </span><span class="ct-d8589a">time</span><span class="ct-712218">);
</span></span><span class="line" line="6"><span class="ct-712218">  });
</span></span><span class="line" line="7"><span class="ct-712218">}
</span></span><span class="line" line="8"><span>
</span></span><span class="line" line="9"><span class="ct-5bda67">function*</span><span class="ct-712218"> </span><span class="ct-d3acbd">createIterator</span><span class="ct-712218">() {
</span></span><span class="line" line="10"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">time1</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-d3acbd">createDelayPromise</span><span class="ct-712218">(</span><span class="ct-a1c1b9">1000</span><span class="ct-712218">);
</span></span><span class="line" line="11"><span class="ct-712218">  </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">time1</span><span class="ct-712218">);
</span></span><span class="line" line="12"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">time2</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-d3acbd">createDelayPromise</span><span class="ct-712218">(</span><span class="ct-a1c1b9">2000</span><span class="ct-712218">);
</span></span><span class="line" line="13"><span class="ct-712218">  </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">time2</span><span class="ct-712218">);
</span></span><span class="line" line="14"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">time3</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-d3acbd">createDelayPromise</span><span class="ct-712218">(</span><span class="ct-a1c1b9">3000</span><span class="ct-712218">);
</span></span><span class="line" line="15"><span class="ct-712218">  </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">time3</span><span class="ct-712218">);
</span></span><span class="line" line="16"><span class="ct-712218">  </span><span class="ct-223fba">return</span><span class="ct-712218"> </span><span class="ct-d8589a">time1</span><span class="ct-712218"> + </span><span class="ct-d8589a">time2</span><span class="ct-712218"> + </span><span class="ct-d8589a">time3</span><span class="ct-712218">;
</span></span><span class="line" line="17"><span class="ct-712218">}
</span></span><span class="line" line="18"><span>
</span></span><span class="line" line="19"><span class="ct-5bda67">function</span><span class="ct-712218"> </span><span class="ct-d3acbd">run</span><span class="ct-712218">(</span><span class="ct-d8589a">createIterator</span><span class="ct-712218">) {
</span></span><span class="line" line="20"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">iterator</span><span class="ct-712218"> = </span><span class="ct-d3acbd">createIterator</span><span class="ct-712218">();
</span></span><span class="line" line="21"><span class="ct-712218">  </span><span class="ct-5bda67">let</span><span class="ct-712218"> </span><span class="ct-d8589a">result</span><span class="ct-712218"> = </span><span class="ct-d8589a">iterator</span><span class="ct-712218">.</span><span class="ct-d3acbd">next</span><span class="ct-712218">();
</span></span><span class="line" line="22"><span class="ct-712218">  </span><span class="ct-5bda67">let</span><span class="ct-712218"> </span><span class="ct-d8589a">r</span><span class="ct-712218">;
</span></span><span class="line" line="23"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">p</span><span class="ct-712218"> = </span><span class="ct-5bda67">new</span><span class="ct-712218"> </span><span class="ct-dcbca7">Promise</span><span class="ct-712218">((</span><span class="ct-d8589a">resolve</span><span class="ct-712218">) </span><span class="ct-5bda67">=&gt;</span><span class="ct-712218"> {
</span></span><span class="line" line="24"><span class="ct-712218">    </span><span class="ct-d8589a">r</span><span class="ct-712218"> = </span><span class="ct-d8589a">resolve</span><span class="ct-712218">;
</span></span><span class="line" line="25"><span class="ct-712218">  });
</span></span><span class="line" line="26"><span class="ct-712218">  </span><span class="ct-5bda67">function</span><span class="ct-712218"> </span><span class="ct-d3acbd">next</span><span class="ct-712218">() {
</span></span><span class="line" line="27"><span class="ct-712218">    </span><span class="ct-223fba">if</span><span class="ct-712218"> (</span><span class="ct-d8589a">result</span><span class="ct-712218">.</span><span class="ct-d8589a">done</span><span class="ct-712218">) {
</span></span><span class="line" line="28"><span class="ct-712218">      </span><span class="ct-d3acbd">r</span><span class="ct-712218">(</span><span class="ct-d8589a">result</span><span class="ct-712218">.</span><span class="ct-d8589a">value</span><span class="ct-712218">);
</span></span><span class="line" line="29"><span class="ct-712218">    } </span><span class="ct-223fba">else</span><span class="ct-712218"> {
</span></span><span class="line" line="30"><span class="ct-712218">      </span><span class="ct-dcbca7">Promise</span><span class="ct-712218">.</span><span class="ct-d3acbd">resolve</span><span class="ct-712218">(</span><span class="ct-d8589a">result</span><span class="ct-712218">.</span><span class="ct-d8589a">value</span><span class="ct-2967fd">)
</span></span><span class="line" line="31"><span class="ct-712218">        .</span><span class="ct-c5561f">then</span><span class="ct-2967fd">((</span><span class="ct-f38ff1">value</span><span class="ct-2967fd">) </span><span class="ct-b8db2f">=&gt;</span><span class="ct-2967fd"> {
</span></span><span class="line" line="32"><span class="ct-2967fd">          </span><span class="ct-f38ff1">result</span><span class="ct-2967fd"> = </span><span class="ct-f38ff1">iterator</span><span class="ct-2967fd">.</span><span class="ct-c5561f">next</span><span class="ct-2967fd">(</span><span class="ct-f38ff1">value</span><span class="ct-2967fd">);
</span></span><span class="line" line="33"><span class="ct-2967fd">          </span><span class="ct-c5561f">next</span><span class="ct-2967fd">();
</span></span><span class="line" line="34"><span class="ct-2967fd">        })
</span></span><span class="line" line="35"><span class="ct-2967fd">        .</span><span class="ct-c5561f">catch</span><span class="ct-2967fd">((</span><span class="ct-f38ff1">err</span><span class="ct-2967fd">) </span><span class="ct-b8db2f">=&gt;</span><span class="ct-2967fd"> {
</span></span><span class="line" line="36"><span class="ct-2967fd">          </span><span class="ct-f38ff1">result</span><span class="ct-2967fd"> = </span><span class="ct-f38ff1">iterator</span><span class="ct-2967fd">.</span><span class="ct-c5561f">throw</span><span class="ct-2967fd">(</span><span class="ct-f38ff1">err</span><span class="ct-2967fd">);
</span></span><span class="line" line="37"><span class="ct-2967fd">          </span><span class="ct-c5561f">next</span><span class="ct-2967fd">();
</span></span><span class="line" line="38"><span class="ct-2967fd">        });
</span></span><span class="line" line="39"><span class="ct-2967fd">    }
</span></span><span class="line" line="40"><span class="ct-2967fd">  }
</span></span><span class="line" line="41"><span class="ct-2967fd">  </span><span class="ct-c5561f">next</span><span class="ct-2967fd">();
</span></span><span class="line" line="42"><span class="ct-2967fd">  </span><span class="ct-bae029">return</span><span class="ct-2967fd"> </span><span class="ct-f38ff1">p</span><span class="ct-2967fd">;
</span></span><span class="line" line="43"><span class="ct-2967fd">}
</span></span><span class="line" line="44"><span>
</span></span><span class="line" line="45"><span class="ct-c5561f">run</span><span class="ct-2967fd">(</span><span class="ct-f38ff1">createIterator</span><span class="ct-2967fd">).</span><span class="ct-c5561f">then</span><span class="ct-2967fd">((</span><span class="ct-f38ff1">value</span><span class="ct-2967fd">) </span><span class="ct-b8db2f">=&gt;</span><span class="ct-2967fd"> {
</span></span><span class="line" line="46"><span class="ct-2967fd">  </span><span class="ct-f38ff1">console</span><span class="ct-2967fd">.</span><span class="ct-c5561f">log</span><span class="ct-2967fd">(</span><span class="ct-d8589a">value</span><span class="ct-712218">);
</span></span><span class="line" line="47"><span class="ct-712218">});</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->上面使用 createDelayPromise 封装了一个 promise 类型的异步任务,然后使用 next 方法去迭代这个迭代器对象。等待对应的异步任务有结果后就通过生成器对象的 next 和 throw 方法把结果回传到生成器函数中。<br>
上面是使用 promise 配合 generator 可以让异步代码以类似同步的形式写在生成器函数中,同样地对应柯里化后的函数,同样具有延迟执行的效果,也可以通过配合 generator 实现类似的效果。<!--]--></p><h2 class="title" id="generator-和-柯里化" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/curryandasync#generator-和-柯里化" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->Generator 和 柯里化<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->除了一些接口是实现了 promise 化外,有很多比较久的接口依然是使用 callback 类型的接口,像 node 中的很多接口会把 callback 参数放在参数列表的末尾,并把 err 放在回调执行的第一个位置,类似这样<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-5bda67">function</span><span class="ct-712218"> </span><span class="ct-d3acbd">createDelayCurry</span><span class="ct-712218">(</span><span class="ct-f38ff1">time</span><span class="ct-2967fd">, </span><span class="ct-f38ff1">callback</span><span class="ct-2967fd">) {
</span></span><span class="line" line="2"><span class="ct-2967fd">  </span><span class="ct-c5561f">setTimeout</span><span class="ct-712218">(() </span><span class="ct-5bda67">=&gt;</span><span class="ct-712218"> {
</span></span><span class="line" line="3"><span class="ct-712218">    </span><span class="ct-d3acbd">callback</span><span class="ct-712218">(</span><span class="ct-5bda67">null</span><span class="ct-712218">, </span><span class="ct-d8589a">time</span><span class="ct-712218">);
</span></span><span class="line" line="4"><span class="ct-712218">  }, </span><span class="ct-d8589a">time</span><span class="ct-712218">);
</span></span><span class="line" line="5"><span class="ct-712218">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->下面通过实现不同以上的 run 方法,结合柯里化实现以上的效果,这次 yield 后面不再是 promise 化后的对象,而是柯里化后的函数<br>
在开始之前先实现一个通用的 curry 函数<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-d3acbd">curry</span><span class="ct-712218"> = (</span><span class="ct-d8589a">fn</span><span class="ct-712218">, ...</span><span class="ct-d8589a">args</span><span class="ct-712218">) </span><span class="ct-5bda67">=&gt;
</span></span><span class="line" line="2"><span class="ct-712218">  </span><span class="ct-d8589a">fn</span><span class="ct-712218">.</span><span class="ct-d8589a">length</span><span class="ct-712218"> &lt;= </span><span class="ct-d8589a">args</span><span class="ct-712218">.</span><span class="ct-d8589a">length</span><span class="ct-712218"> ? </span><span class="ct-d3acbd">fn</span><span class="ct-712218">(...</span><span class="ct-d8589a">args</span><span class="ct-712218">) : </span><span class="ct-d8589a">curry</span><span class="ct-712218">.</span><span class="ct-d3acbd">bind</span><span class="ct-712218">(</span><span class="ct-5bda67">null</span><span class="ct-712218">, </span><span class="ct-d8589a">fn</span><span class="ct-712218">, ...</span><span class="ct-d8589a">args</span><span class="ct-712218">);</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->这个 curry 函数的作用是等初始存入的函数的参数收集够就执行,如果不够就继续收集,下面会在迭代中补上回调参数,这样异步任务才可以执行。<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-d3acbd">curry</span><span class="ct-712218"> = (</span><span class="ct-d8589a">fn</span><span class="ct-712218">, ...</span><span class="ct-d8589a">args</span><span class="ct-712218">) </span><span class="ct-5bda67">=&gt;
</span></span><span class="line" line="2"><span class="ct-712218">  </span><span class="ct-d8589a">fn</span><span class="ct-712218">.</span><span class="ct-d8589a">length</span><span class="ct-712218"> &lt;= </span><span class="ct-d8589a">args</span><span class="ct-712218">.</span><span class="ct-d8589a">length</span><span class="ct-712218"> ? </span><span class="ct-d3acbd">fn</span><span class="ct-712218">(...</span><span class="ct-d8589a">args</span><span class="ct-712218">) : </span><span class="ct-d8589a">curry</span><span class="ct-712218">.</span><span class="ct-d3acbd">bind</span><span class="ct-712218">(</span><span class="ct-5bda67">null</span><span class="ct-712218">, </span><span class="ct-d8589a">fn</span><span class="ct-712218">, ...</span><span class="ct-d8589a">args</span><span class="ct-712218">);
</span></span><span class="line" line="3"><span>
</span></span><span class="line" line="4"><span class="ct-5bda67">function</span><span class="ct-712218"> </span><span class="ct-d3acbd">createDelayCurry</span><span class="ct-712218">(</span><span class="ct-d8589a">time</span><span class="ct-712218">, </span><span class="ct-d8589a">callback</span><span class="ct-712218">) {
</span></span><span class="line" line="5"><span class="ct-712218">  </span><span class="ct-d3acbd">setTimeout</span><span class="ct-712218">(() </span><span class="ct-5bda67">=&gt;</span><span class="ct-712218"> {
</span></span><span class="line" line="6"><span class="ct-712218">    </span><span class="ct-d3acbd">callback</span><span class="ct-712218">(</span><span class="ct-5bda67">null</span><span class="ct-712218">, </span><span class="ct-d8589a">time</span><span class="ct-712218">);
</span></span><span class="line" line="7"><span class="ct-712218">  }, </span><span class="ct-d8589a">time</span><span class="ct-712218">);
</span></span><span class="line" line="8"><span class="ct-712218">}
</span></span><span class="line" line="9"><span>
</span></span><span class="line" line="10"><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">curringDelay</span><span class="ct-712218"> = </span><span class="ct-d3acbd">curry</span><span class="ct-712218">(</span><span class="ct-d8589a">createDelayCurry</span><span class="ct-712218">);
</span></span><span class="line" line="11"><span>
</span></span><span class="line" line="12"><span class="ct-5bda67">function*</span><span class="ct-712218"> </span><span class="ct-d3acbd">createIterator</span><span class="ct-712218">() {
</span></span><span class="line" line="13"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">time1</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-d3acbd">curringDelay</span><span class="ct-712218">(</span><span class="ct-a1c1b9">1000</span><span class="ct-712218">);
</span></span><span class="line" line="14"><span class="ct-712218">  </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">time1</span><span class="ct-712218">);
</span></span><span class="line" line="15"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">time2</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-d3acbd">curringDelay</span><span class="ct-712218">(</span><span class="ct-a1c1b9">2000</span><span class="ct-712218">);
</span></span><span class="line" line="16"><span class="ct-712218">  </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">time2</span><span class="ct-712218">);
</span></span><span class="line" line="17"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">time3</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-d3acbd">curringDelay</span><span class="ct-712218">(</span><span class="ct-a1c1b9">3000</span><span class="ct-712218">);
</span></span><span class="line" line="18"><span class="ct-712218">  </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">time3</span><span class="ct-712218">);
</span></span><span class="line" line="19"><span class="ct-712218">  </span><span class="ct-223fba">return</span><span class="ct-712218"> </span><span class="ct-d8589a">time1</span><span class="ct-712218"> + </span><span class="ct-d8589a">time2</span><span class="ct-712218"> + </span><span class="ct-d8589a">time3</span><span class="ct-712218">;
</span></span><span class="line" line="20"><span class="ct-712218">}
</span></span><span class="line" line="21"><span>
</span></span><span class="line" line="22"><span class="ct-5bda67">function</span><span class="ct-712218"> </span><span class="ct-d3acbd">run</span><span class="ct-712218">(</span><span class="ct-d8589a">createIterator</span><span class="ct-712218">, </span><span class="ct-d8589a">callback</span><span class="ct-712218">) {
</span></span><span class="line" line="23"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">iterator</span><span class="ct-712218"> = </span><span class="ct-d3acbd">createIterator</span><span class="ct-712218">();
</span></span><span class="line" line="24"><span class="ct-712218">  </span><span class="ct-5bda67">let</span><span class="ct-712218"> </span><span class="ct-d8589a">result</span><span class="ct-712218"> = </span><span class="ct-d8589a">iterator</span><span class="ct-712218">.</span><span class="ct-d3acbd">next</span><span class="ct-712218">();
</span></span><span class="line" line="25"><span class="ct-712218">  </span><span class="ct-5bda67">function</span><span class="ct-712218"> </span><span class="ct-d3acbd">next</span><span class="ct-712218">() {
</span></span><span class="line" line="26"><span class="ct-712218">    </span><span class="ct-223fba">if</span><span class="ct-712218"> (</span><span class="ct-d8589a">result</span><span class="ct-712218">.</span><span class="ct-d8589a">done</span><span class="ct-712218">) {
</span></span><span class="line" line="27"><span class="ct-712218">      </span><span class="ct-d3acbd">callback</span><span class="ct-712218">(</span><span class="ct-5bda67">null</span><span class="ct-712218">, </span><span class="ct-d8589a">result</span><span class="ct-712218">.</span><span class="ct-d8589a">value</span><span class="ct-712218">);
</span></span><span class="line" line="28"><span class="ct-712218">    } </span><span class="ct-223fba">else</span><span class="ct-712218"> {
</span></span><span class="line" line="29"><span class="ct-712218">      </span><span class="ct-d8589a">result</span><span class="ct-712218">.</span><span class="ct-d3acbd">value</span><span class="ct-712218">((</span><span class="ct-d8589a">err</span><span class="ct-712218">, </span><span class="ct-d8589a">value</span><span class="ct-712218">) </span><span class="ct-5bda67">=&gt;</span><span class="ct-712218"> {
</span></span><span class="line" line="30"><span class="ct-712218">        </span><span class="ct-bd2f04">// 补上最后 callback 参数启动任务
</span></span><span class="line" line="31"><span class="ct-712218">        </span><span class="ct-223fba">if</span><span class="ct-712218"> (</span><span class="ct-d8589a">err</span><span class="ct-712218">) {
</span></span><span class="line" line="32"><span class="ct-712218">          </span><span class="ct-d8589a">result</span><span class="ct-712218"> = </span><span class="ct-d8589a">iterator</span><span class="ct-712218">.</span><span class="ct-d3acbd">throw</span><span class="ct-712218">(</span><span class="ct-d8589a">err</span><span class="ct-712218">);
</span></span><span class="line" line="33"><span class="ct-712218">          </span><span class="ct-d3acbd">next</span><span class="ct-712218">();
</span></span><span class="line" line="34"><span class="ct-712218">        } </span><span class="ct-223fba">else</span><span class="ct-712218"> {
</span></span><span class="line" line="35"><span class="ct-712218">          </span><span class="ct-d8589a">result</span><span class="ct-712218"> = </span><span class="ct-d8589a">iterator</span><span class="ct-712218">.</span><span class="ct-d3acbd">next</span><span class="ct-712218">(</span><span class="ct-d8589a">value</span><span class="ct-712218">);
</span></span><span class="line" line="36"><span class="ct-712218">          </span><span class="ct-d3acbd">next</span><span class="ct-712218">();
</span></span><span class="line" line="37"><span class="ct-712218">        }
</span></span><span class="line" line="38"><span class="ct-712218">      });
</span></span><span class="line" line="39"><span class="ct-712218">    }
</span></span><span class="line" line="40"><span class="ct-712218">  }
</span></span><span class="line" line="41"><span class="ct-712218">  </span><span class="ct-d3acbd">next</span><span class="ct-712218">();
</span></span><span class="line" line="42"><span class="ct-712218">}
</span></span><span class="line" line="43"><span>
</span></span><span class="line" line="44"><span class="ct-d3acbd">run</span><span class="ct-712218">(</span><span class="ct-d8589a">createIterator</span><span class="ct-712218">, (</span><span class="ct-d8589a">err</span><span class="ct-712218">, </span><span class="ct-d8589a">value</span><span class="ct-712218">) </span><span class="ct-5bda67">=&gt;</span><span class="ct-712218"> {
</span></span><span class="line" line="45"><span class="ct-712218">  </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">err</span><span class="ct-712218">, </span><span class="ct-d8589a">value</span><span class="ct-712218">);
</span></span><span class="line" line="46"><span class="ct-712218">});</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->执行效果和 promise 版是差不多一样的。<!--]--></p><h2 class="title" id="并行" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/curryandasync#并行" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->并行<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->上面是串行的版本,下面看看并行的实现<br>
先看 promise 并行一般写法<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-5bda67">function*</span><span class="ct-712218"> </span><span class="ct-d3acbd">createIteratorParallel</span><span class="ct-712218">() {
</span></span><span class="line" line="2"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">times</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-dcbca7">Promise</span><span class="ct-712218">.</span><span class="ct-d3acbd">all</span><span class="ct-712218">([
</span></span><span class="line" line="3"><span class="ct-712218">    </span><span class="ct-d3acbd">createDelayPromise</span><span class="ct-712218">(</span><span class="ct-a1c1b9">1000</span><span class="ct-712218">),
</span></span><span class="line" line="4"><span class="ct-712218">    </span><span class="ct-d3acbd">createDelayPromise</span><span class="ct-712218">(</span><span class="ct-a1c1b9">2000</span><span class="ct-712218">),
</span></span><span class="line" line="5"><span class="ct-712218">    </span><span class="ct-d3acbd">createDelayPromise</span><span class="ct-712218">(</span><span class="ct-a1c1b9">3000</span><span class="ct-712218">)
</span></span><span class="line" line="6"><span class="ct-712218">  ]);
</span></span><span class="line" line="7"><span class="ct-712218">  </span><span class="ct-223fba">return</span><span class="ct-712218"> </span><span class="ct-d8589a">times</span><span class="ct-712218">;
</span></span><span class="line" line="8"><span class="ct-712218">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->相应的也实现一个 all 方法<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-5bda67">function</span><span class="ct-712218"> </span><span class="ct-d3acbd">curryAll</span><span class="ct-712218">(</span><span class="ct-d8589a">curries</span><span class="ct-712218">, </span><span class="ct-d8589a">callback</span><span class="ct-712218">) {
</span></span><span class="line" line="2"><span class="ct-712218">  </span><span class="ct-5bda67">let</span><span class="ct-712218"> </span><span class="ct-d8589a">len</span><span class="ct-712218"> = </span><span class="ct-d8589a">curries</span><span class="ct-712218">.</span><span class="ct-d8589a">length</span><span class="ct-712218">;
</span></span><span class="line" line="3"><span class="ct-712218">  </span><span class="ct-5bda67">let</span><span class="ct-712218"> </span><span class="ct-d8589a">result</span><span class="ct-712218"> = [];
</span></span><span class="line" line="4"><span class="ct-712218">  </span><span class="ct-5bda67">let</span><span class="ct-712218"> </span><span class="ct-d8589a">count</span><span class="ct-712218"> = </span><span class="ct-a1c1b9">0</span><span class="ct-712218">;
</span></span><span class="line" line="5"><span class="ct-712218">  </span><span class="ct-d8589a">curries</span><span class="ct-712218">.</span><span class="ct-d3acbd">forEach</span><span class="ct-712218">((</span><span class="ct-d8589a">curried</span><span class="ct-712218">, </span><span class="ct-d8589a">index</span><span class="ct-712218">) </span><span class="ct-5bda67">=&gt;</span><span class="ct-712218"> {
</span></span><span class="line" line="6"><span class="ct-712218">    </span><span class="ct-d3acbd">curried</span><span class="ct-712218">((</span><span class="ct-d8589a">err</span><span class="ct-712218">, </span><span class="ct-d8589a">value</span><span class="ct-712218">) </span><span class="ct-5bda67">=&gt;</span><span class="ct-712218"> {
</span></span><span class="line" line="7"><span class="ct-712218">      </span><span class="ct-223fba">if</span><span class="ct-712218"> (</span><span class="ct-d8589a">err</span><span class="ct-712218">) {
</span></span><span class="line" line="8"><span class="ct-712218">        </span><span class="ct-d3acbd">callback</span><span class="ct-712218">(</span><span class="ct-d8589a">err</span><span class="ct-712218">);
</span></span><span class="line" line="9"><span class="ct-712218">        </span><span class="ct-223fba">return</span><span class="ct-712218">;
</span></span><span class="line" line="10"><span class="ct-712218">      } </span><span class="ct-223fba">else</span><span class="ct-712218"> {
</span></span><span class="line" line="11"><span class="ct-712218">        </span><span class="ct-d8589a">count</span><span class="ct-712218">++;
</span></span><span class="line" line="12"><span class="ct-712218">        </span><span class="ct-d8589a">result</span><span class="ct-712218">[</span><span class="ct-d8589a">index</span><span class="ct-712218">] = </span><span class="ct-d8589a">value</span><span class="ct-712218">;
</span></span><span class="line" line="13"><span class="ct-712218">        </span><span class="ct-223fba">if</span><span class="ct-712218"> (</span><span class="ct-d8589a">count</span><span class="ct-712218"> == </span><span class="ct-d8589a">len</span><span class="ct-712218">) {
</span></span><span class="line" line="14"><span class="ct-712218">          </span><span class="ct-d3acbd">callback</span><span class="ct-712218">(</span><span class="ct-5bda67">null</span><span class="ct-712218">, </span><span class="ct-d8589a">result</span><span class="ct-712218">);
</span></span><span class="line" line="15"><span class="ct-712218">        }
</span></span><span class="line" line="16"><span class="ct-712218">      }
</span></span><span class="line" line="17"><span class="ct-712218">    });
</span></span><span class="line" line="18"><span class="ct-712218">  });
</span></span><span class="line" line="19"><span class="ct-712218">}
</span></span><span class="line" line="20"><span>
</span></span><span class="line" line="21"><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">curriedAll</span><span class="ct-712218"> = </span><span class="ct-d3acbd">curry</span><span class="ct-712218">(</span><span class="ct-d8589a">curryAll</span><span class="ct-712218">);
</span></span><span class="line" line="22"><span>
</span></span><span class="line" line="23"><span class="ct-5bda67">function*</span><span class="ct-712218"> </span><span class="ct-d3acbd">createIteratorParallel</span><span class="ct-712218">() {
</span></span><span class="line" line="24"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">times</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-d3acbd">curriedAll</span><span class="ct-712218">([</span><span class="ct-d3acbd">curringDelay</span><span class="ct-712218">(</span><span class="ct-a1c1b9">1000</span><span class="ct-712218">), </span><span class="ct-d3acbd">curringDelay</span><span class="ct-712218">(</span><span class="ct-a1c1b9">2000</span><span class="ct-712218">), </span><span class="ct-d3acbd">curringDelay</span><span class="ct-712218">(</span><span class="ct-a1c1b9">3000</span><span class="ct-712218">)]);
</span></span><span class="line" line="25"><span class="ct-712218">  </span><span class="ct-223fba">return</span><span class="ct-712218"> </span><span class="ct-d8589a">times</span><span class="ct-712218">;
</span></span><span class="line" line="26"><span class="ct-712218">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->yield 后面依然是柯里化后的函数<!--]--></p><h2 class="title" id="es-新语法" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/curryandasync#es-新语法" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->es 新语法<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->上面的方案要求异步任务的回调需要在参数的末尾位置,如果回调不在末尾,那么就需要修改 curry 函数的实现方式,但是有没有可能不用修改其实现方式,甚至不用写 curry 呢?<br>
curry 作为函数式编程的基本单元,最新的 es 规范实验性地从语法的角度提供了支持。<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-b8db2f">function</span><span class="ct-2967fd"> </span><span class="ct-c5561f">add</span><span class="ct-2967fd">(</span><span class="ct-f38ff1">x</span><span class="ct-2967fd">, </span><span class="ct-d8589a">y</span><span class="ct-712218">) {
</span></span><span class="line" line="2"><span class="ct-712218">  </span><span class="ct-223fba">return</span><span class="ct-712218"> </span><span class="ct-d8589a">x</span><span class="ct-712218"> + </span><span class="ct-d8589a">y</span><span class="ct-712218">;
</span></span><span class="line" line="3"><span class="ct-712218">}
</span></span><span class="line" line="4"><span>
</span></span><span class="line" line="5"><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">addOne</span><span class="ct-712218"> = </span><span class="ct-c5561f">add</span><span class="ct-2967fd">(</span><span class="ct-d46786">1</span><span class="ct-2967fd">, ?); </span><span class="ct-cae768">// apply from the left
</span></span><span class="line" line="6"><span class="ct-d3acbd">addOne</span><span class="ct-712218">(</span><span class="ct-a1c1b9">2</span><span class="ct-712218">); </span><span class="ct-bd2f04">// 3
</span></span><span class="line" line="7"><span>
</span></span><span class="line" line="8"><span class="ct-d8589a">const</span><span class="ct-712218"> </span><span class="ct-d8589a">addTen</span><span class="ct-712218"> = </span><span class="ct-d3acbd">add</span><span class="ct-712218">(?, </span><span class="ct-a1c1b9">10</span><span class="ct-712218">); </span><span class="ct-bd2f04">// apply from the right
</span></span><span class="line" line="9"><span class="ct-d3acbd">addTen</span><span class="ct-712218">(</span><span class="ct-a1c1b9">2</span><span class="ct-712218">); </span><span class="ct-bd2f04">// 12</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->以上的 addOne addTen 就是一个柯里化后的函数,这个语法大部分浏览器都没有支持,如果要使用也很简单,使用一个 babel 插件就可以了 <code class="prose-code-inline colored" lang="sh" data-v-39cc8780><!--[--><span class="ct-712218">babel </span><span class="ct-999635">--plugins</span><span class="ct-712218"> </span><span class="ct-999635">@babel/plugin-proposal-partial-application</span><span class="ct-712218"> </span><span class="ct-999635">script.js</span><!--]--></code>
如果使用了上面的语法,可以不用引入 curry 函数<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-5bda67">function*</span><span class="ct-712218"> </span><span class="ct-d3acbd">createIterator</span><span class="ct-712218">() {
</span></span><span class="line" line="2"><span class="ct-712218">  </span><span class="ct-5bda67">const</span><span class="ct-712218"> </span><span class="ct-6d00fb">time1</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-d3acbd">createDelayCurry</span><span class="ct-712218">(</span><span class="ct-a1c1b9">1000</span><span class="ct-712218">, ?);
</span></span><span class="line" line="3"><span class="ct-712218">  </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">time1</span><span class="ct-712218">);
</span></span><span class="line" line="4"><span class="ct-712218">  </span><span class="ct-d8589a">const</span><span class="ct-712218"> </span><span class="ct-d8589a">time2</span><span class="ct-712218"> = </span><span class="ct-223fba">yield</span><span class="ct-712218"> </span><span class="ct-d3acbd">createDelayCurry</span><span class="ct-712218">(</span><span class="ct-a1c1b9">2000</span><span class="ct-712218">, ?);
</span></span><span class="line" line="5"><span class="ct-712218">  </span><span class="ct-d8589a">console</span><span class="ct-712218">.</span><span class="ct-d3acbd">log</span><span class="ct-712218">(</span><span class="ct-d8589a">time2</span><span class="ct-712218">);
</span></span><span class="line" line="6"><span class="ct-712218">  </span><span class="ct-d8589a">const</span><span class="ct-712218"> </span><span class="ct-d8589a">time3</span><span class="ct-2967fd"> = </span><span class="ct-bae029">yield</span><span class="ct-2967fd"> </span><span class="ct-c5561f">createDelayCurry</span><span class="ct-2967fd">(</span><span class="ct-d46786">3000</span><span class="ct-2967fd">, ?);
</span></span><span class="line" line="7"><span class="ct-2967fd">  </span><span class="ct-f38ff1">console</span><span class="ct-2967fd">.</span><span class="ct-c5561f">log</span><span class="ct-2967fd">(</span><span class="ct-f38ff1">time3</span><span class="ct-2967fd">);
</span></span><span class="line" line="8"><span class="ct-2967fd">  </span><span class="ct-f38ff1">return</span><span class="ct-2967fd"> </span><span class="ct-f38ff1">time1</span><span class="ct-2967fd"> + </span><span class="ct-f38ff1">time2</span><span class="ct-2967fd"> + </span><span class="ct-f38ff1">time3</span><span class="ct-2967fd">;
</span></span><span class="line" line="9"><span class="ct-2967fd">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->如果 callback 在前面,那么就把问号放在前面,实际上可以放在任何参数位置上,主要看具体的接口要求。<!--]--></p><h2 class="title" id="总结" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/curryandasync#总结" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->总结<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->柯里化的应用非常广泛,上面只是举了一个简单的例子,通过这个例子,也了解了 async/await 基本实现原理,虽然 async/await 已经被广泛支持,promise 也被广泛使用,可能不再需要直接使用生成器函数了,但也不妨碍去简单地了解一下。<!--]--></p><style>.ct-1358fb{color:#4EC9B0}
.ct-753c1e{color:#CE9178}
.ct-cae768{color:#6A9955}
.ct-d46786{color:#B5CEA8}
.ct-50236c{color:#4FC1FF}
.ct-bae029{color:#C586C0}
.ct-f38ff1{color:#9CDCFE}
.ct-c5561f{color:#DCDCAA}
.ct-2967fd{color:#D4D4D4}
.ct-b8db2f{color:#569CD6}</style></div><!--]--><nav class="nav" data-v-58a2f6cb><div class="nav-item nav-item-before" data-v-58a2f6cb><div class="dir-title" data-v-58a2f6cb>JavaScript</div><a href="/blog/articles/javascript/asyncawaitscene" class="link" data-v-58a2f6cb><span style="transform:scale(-1, 1);" data-v-58a2f6cb></span><span class="title" data-v-58a2f6cb>async/await 异步应用的常用场景</span></a></div><div class="nav-item nav-item-after" data-v-58a2f6cb><div class="dir-title" data-v-58a2f6cb>JavaScript</div><a href="/blog/articles/javascript/floatingpointlossprecision" class="link" data-v-58a2f6cb><span class="title" data-v-58a2f6cb>js 浮点数存储精度丢失原理</span><span data-v-58a2f6cb></span></a></div></nav></div></main><aside style="display:none;" class="aside article-outline"><div class="aside-stick right-aside"><span></span></div></aside></div><footer><div class="to-top" style="display:none;"><span></span></div></footer><div class="nuxt-loading-indicator" style="position:fixed;top:0;right:0;left:0;pointer-events:none;width:auto;height:3px;opacity:0;background:repeating-linear-gradient(to right,#00dc82 0%,#34cdfe 50%,#0047e1 100%);background-size:Infinity% auto;transform:scaleX(0%);transform-origin:left;transition:transform 0.1s, height 0.4s, opacity 0.4s;z-index:999999;"></div><!--]--></div><script>window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c_,c$,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn,do0,dp,dq,dr,ds,dt,du,dv,dw,dx,dy){return {data:{"search-navigation":[{title:bI,_path:bJ,children:[{title:bK,_path:bL,children:[{title:bM,_path:bN},{title:bO,_path:bP},{title:bQ,_path:bR}]},{title:bS,_path:bT,children:[{title:bU,_path:bV},{title:bj,_path:bk},{title:bW,_path:bX},{title:bY,_path:bZ}]},{title:b_,_path:b$,children:[{title:ca,_path:cb}]}]},{title:cc,_path:cd,children:[{title:ce,_path:cf,children:[{title:aN,_path:cg},{title:aO,_path:ch}]},{title:ci,_path:cj,children:[{title:aN,_path:ck},{title:aO,_path:cl}]}]},{title:cm,_path:cn},{title:bl,_path:co},{title:cp,_path:cq,children:[{title:cr,_path:cs}]}],"content-navigation-8C37fagqQL":[{title:bI,_path:bJ,children:[{title:bK,_path:bL,children:[{title:bM,_path:bN},{title:bO,_path:bP},{title:bQ,_path:bR}]},{title:bS,_path:bT,children:[{title:bU,_path:bV},{title:bj,_path:bk},{title:bW,_path:bX},{title:bY,_path:bZ}]},{title:b_,_path:b$,children:[{title:ca,_path:cb}]}]},{title:cc,_path:cd,children:[{title:ce,_path:cf,children:[{title:aN,_path:cg},{title:aO,_path:ch}]},{title:ci,_path:cj,children:[{title:aN,_path:ck},{title:aO,_path:cl}]}]},{title:cm,_path:cn},{title:bl,_path:co},{title:cp,_path:cq,children:[{title:cr,_path:cs}]}],"content-query-lYXAcPmJaC":{_path:bk,_dir:"javascript",_draft:ah,_partial:ah,_locale:bm,_empty:ah,title:bj,description:C,body:{type:"root",children:[{type:a,tag:au,props:{id:aP},children:[{type:c,value:aP}]},{type:a,tag:u,props:{},children:[{type:c,value:"js 中函数作为一等公民,函数执行中既可以作为函数的参数也可以作为函数的返回值,而这类执行函数叫做高阶函数,利用高阶函数的特性很容易就可以实现柯里化("},{type:a,tag:"em",props:{},children:[{type:c,value:"柯里化(Currying)是把接受多个参数的函数变换成接受一个单一参数(最初函数的第一个参数)的函数，并且返回接受余下的参数且返回结果的新函数的技术"}]},{type:c,value:"),根据百科的理解大概就是下面的例子。"}]},{type:a,tag:t,props:{code:"function add(x, y) {\n  return x + y;\n}\nfunction curryind_add(x) {\n  return function (y) {\n    return x + y;\n  };\n}\nconst curried_add = curryind_add(1);\ncurried_add(2); \u002F\u002F 3\ncurried_add(3); \u002F\u002F 4\n",language:V,meta:H},children:[{type:a,tag:W,props:{},children:[{type:a,tag:t,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:R},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:av}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:w},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:av}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:_},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ct}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:av}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:av}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"  };\n"}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:aq},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:bn}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ct}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:bo}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:bn}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:cu}]}]},{type:a,tag:b,props:{class:e,line:aF},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:bn}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:"3"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F 4"}]}]}]}]}]},{type:a,tag:u,props:{},children:[{type:c,value:"从例子可以看出,柯里化有防止参数重复的作用,而且具有延迟执行的特征。下面利用柯里化的特征看看在异步编程的应用,在开始时先简单介绍一下 async\u002Fawait 的原理。"}]},{type:a,tag:au,props:{id:cv},children:[{type:c,value:cw}]},{type:a,tag:u,props:{},children:[{type:c,value:"async\u002Fawait 语法其实是 Generator 和 promise 的语法糖。"}]},{type:a,tag:u,props:{},children:[{type:c,value:"Generator 函数执行时会返回一个生成器对象,该对象是一个特殊的迭代器对象,而且本身也是一个可迭代对象("},{type:a,tag:"a",props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FIteration_protocols#The_iterable_protocol",rel:["nofollow"]},children:[{type:c,value:"迭代器对象和可迭代对象"}]},{type:c,value:"),下面说说其特殊性。"}]},{type:a,tag:t,props:{code:"function* generator() {\n  const value = yield 1;\n  console.log(value);\n  try {\n    \u002F\u002F 捕获错误\n    yield 2;\n  } catch (e) {\n    console.log(e);\n  }\n}\nconst iterator = generator();\niterator === iterator[Symbol.iterator](); \u002F\u002F true 自身部署了可迭代接口,该接口返回自身\n[...iterator]; \u002F\u002F [1, 2]\n\nconst iterator2 = generator(); \u002F\u002F 迭代器对象是一次消耗的,需要重新起一个迭代器\niterator2.next(); \u002F\u002F {value: 1, done: false}\niterator2.next(`value 的值`); \u002F\u002F 利用 next 向生成器函数发送数据\niterator2.throw(new Error('error')); \u002F\u002F 利用 throw 向生成器函数抛出错误\n",language:V,meta:H},children:[{type:a,tag:W,props:{},children:[{type:a,tag:t,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:R},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bp}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:w},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:bo}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:_},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:"try"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F 捕获错误\n"}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"  } "}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:cx}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cy}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cy}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aq},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bq}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:aF},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bp}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:aS},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" === "}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cz}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"Symbol"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"](); "}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F true 自身部署了可迭代接口,该接口返回自身\n"}]}]},{type:a,tag:b,props:{class:e,line:aT},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"[..."}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"]; "}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F [1, 2]\n"}]}]},{type:a,tag:b,props:{class:e,line:aU},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:aV},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:aW}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bp}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cA}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F 迭代器对象是一次消耗的,需要重新起一个迭代器\n"}]}]},{type:a,tag:b,props:{class:e,line:aX},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aW}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cA}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F {value: 1, done: false}\n"}]}]},{type:a,tag:b,props:{class:e,line:aY},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aW}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:aG},children:[{type:c,value:"`value 的值`"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F 利用 next 向生成器函数发送数据\n"}]}]},{type:a,tag:b,props:{class:e,line:aZ},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aW}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:br}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:bs}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:"Error"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:aG},children:[{type:c,value:"'error'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:")); "}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F 利用 throw 向生成器函数抛出错误"}]}]}]}]}]},{type:a,tag:u,props:{},children:[{type:c,value:"从上面的例子可以看出,生成器对象,在迭代的过程中是可以和生成器函数进行通信的,如果用在 promise 中,只要把 promise 在状态改变后执行的回调结果回传到生成器函数内就可以实现类似 async\u002Fawait 的效果。而迭代过程,可以实现一个执行器函数进行迭代,这个函数就类似于执行 async。"}]},{type:a,tag:t,props:{code:"function createDelayPromise(time) {\n  return new Promise((resolve) =\u003E {\n    setTimeout(() =\u003E {\n      resolve(time);\n    }, time);\n  });\n}\n\nfunction* createIterator() {\n  const time1 = yield createDelayPromise(1000);\n  console.log(time1);\n  const time2 = yield createDelayPromise(2000);\n  console.log(time2);\n  const time3 = yield createDelayPromise(3000);\n  console.log(time3);\n  return time1 + time2 + time3;\n}\n\nfunction run(createIterator) {\n  const iterator = createIterator();\n  let result = iterator.next();\n  let r;\n  const p = new Promise((resolve) =\u003E {\n    r = resolve;\n  });\n  function next() {\n    if (result.done) {\n      r(result.value);\n    } else {\n      Promise.resolve(result.value)\n        .then((value) =\u003E {\n          result = iterator.next(value);\n          next();\n        })\n        .catch((err) =\u003E {\n          result = iterator.throw(err);\n          next();\n        });\n    }\n  }\n  next();\n  return p;\n}\n\nrun(createIterator).then((value) =\u003E {\n  console.log(value);\n});\n",language:V,meta:H},children:[{type:a,tag:W,props:{},children:[{type:a,tag:t,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:R},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:w},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:bs}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:a_},children:[{type:c,value:a$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:_},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bt}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"    }, "}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bv}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:aq},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aF},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aS},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aT},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aU},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:ae}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aV},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ae}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aX},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ae}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:aY},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:aZ},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:bw},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ba}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:bx},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:by},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:bz},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:bB},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:bs}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:a_},children:[{type:c,value:a$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:bC},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:bD},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bv}]}]},{type:a,tag:b,props:{class:e,line:bE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:cB},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:cD},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:cE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:cF}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bb}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:cG},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:a_},children:[{type:c,value:a$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:cH}]}]},{type:a,tag:b,props:{class:e,line:cI},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:cJ}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:cK}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:bc},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:cL},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:cM},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:cN},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:"        })\n"}]}]},{type:a,tag:b,props:{class:e,line:cO},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:cJ}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:cx}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:bc},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:cP},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:br}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:cQ},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:cR},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:"        });\n"}]}]},{type:a,tag:b,props:{class:e,line:cS},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:cT}]}]},{type:a,tag:b,props:{class:e,line:cU},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:bq}]}]},{type:a,tag:b,props:{class:e,line:cV},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:cW},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:cX},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:cY},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:cZ},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:c_},children:[{type:a,tag:b,props:{class:E},children:[{type:c,value:ba}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:")."}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:cK}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:bc},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:c$},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:47},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:da}]}]}]}]}]},{type:a,tag:u,props:{},children:[{type:c,value:"上面使用 createDelayPromise 封装了一个 promise 类型的异步任务,然后使用 next 方法去迭代这个迭代器对象。等待对应的异步任务有结果后就通过生成器对象的 next 和 throw 方法把结果回传到生成器函数中。"},{type:a,tag:bd,props:{},children:[]},{type:c,value:"\n上面是使用 promise 配合 generator 可以让异步代码以类似同步的形式写在生成器函数中,同样地对应柯里化后的函数,同样具有延迟执行的效果,也可以通过配合 generator 实现类似的效果。"}]},{type:a,tag:au,props:{id:db},children:[{type:c,value:dc}]},{type:a,tag:u,props:{},children:[{type:c,value:"除了一些接口是实现了 promise 化外,有很多比较久的接口依然是使用 callback 类型的接口,像 node 中的很多接口会把 callback 参数放在参数列表的末尾,并把 err 放在回调执行的第一个位置,类似这样"}]},{type:a,tag:t,props:{code:"function createDelayCurry(time, callback) {\n  setTimeout(() =\u003E {\n    callback(null, time);\n  }, time);\n}\n",language:V,meta:H},children:[{type:a,tag:W,props:{},children:[{type:a,tag:t,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:R},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:ag}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:w},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:bt}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:_},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ag}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dd}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:be}]}]}]}]}]},{type:a,tag:u,props:{},children:[{type:c,value:"下面通过实现不同以上的 run 方法,结合柯里化实现以上的效果,这次 yield 后面不再是 promise 化后的对象,而是柯里化后的函数"},{type:a,tag:bd,props:{},children:[]},{type:c,value:"\n在开始之前先实现一个通用的 curry 函数"}]},{type:a,tag:t,props:{code:"const curry = (fn, ...args) =\u003E\n  fn.length \u003C= args.length ? fn(...args) : curry.bind(null, fn, ...args);\n",language:V,meta:H},children:[{type:a,tag:W,props:{},children:[{type:a,tag:t,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:R},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:de}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:df}]}]},{type:a,tag:b,props:{class:e,line:w},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aM}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dg}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aM}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dh}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:di}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dj}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:dk}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:");"}]}]}]}]}]},{type:a,tag:u,props:{},children:[{type:c,value:"这个 curry 函数的作用是等初始存入的函数的参数收集够就执行,如果不够就继续收集,下面会在迭代中补上回调参数,这样异步任务才可以执行。"}]},{type:a,tag:t,props:{code:"const curry = (fn, ...args) =\u003E\n  fn.length \u003C= args.length ? fn(...args) : curry.bind(null, fn, ...args);\n\nfunction createDelayCurry(time, callback) {\n  setTimeout(() =\u003E {\n    callback(null, time);\n  }, time);\n}\n\nconst curringDelay = curry(createDelayCurry);\n\nfunction* createIterator() {\n  const time1 = yield curringDelay(1000);\n  console.log(time1);\n  const time2 = yield curringDelay(2000);\n  console.log(time2);\n  const time3 = yield curringDelay(3000);\n  console.log(time3);\n  return time1 + time2 + time3;\n}\n\nfunction run(createIterator, callback) {\n  const iterator = createIterator();\n  let result = iterator.next();\n  function next() {\n    if (result.done) {\n      callback(null, result.value);\n    } else {\n      result.value((err, value) =\u003E {\n        \u002F\u002F 补上最后 callback 参数启动任务\n        if (err) {\n          result = iterator.throw(err);\n          next();\n        } else {\n          result = iterator.next(value);\n          next();\n        }\n      });\n    }\n  }\n  next();\n}\n\nrun(createIterator, (err, value) =\u003E {\n  console.log(err, value);\n});\n",language:V,meta:H},children:[{type:a,tag:W,props:{},children:[{type:a,tag:t,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:R},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:de}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:df}]}]},{type:a,tag:b,props:{class:e,line:w},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aM}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dg}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aM}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dh}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:di}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dj}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:dk}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:_},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ag}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bt}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ag}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dd}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:aq},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aF},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:aS},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:aT},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aU},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aV},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aX},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aY},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:ae}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aZ},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ae}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:bw},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ae}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:bx},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:by},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:bz},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ba}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ag}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:bB},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:bC},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:bD},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:bE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:cB},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ag}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:cD},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:cF}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bb}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:cE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:cG},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:at}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F 补上最后 callback 参数启动任务\n"}]}]},{type:a,tag:b,props:{class:e,line:cI},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:at}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:cL},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:br}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:cM},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:cN},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"        } "}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bb}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:cO},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:cP},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:cQ},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dl}]}]},{type:a,tag:b,props:{class:e,line:cR},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"      });\n"}]}]},{type:a,tag:b,props:{class:e,line:cS},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:cT}]}]},{type:a,tag:b,props:{class:e,line:cU},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bq}]}]},{type:a,tag:b,props:{class:e,line:cV},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:T}]}]},{type:a,tag:b,props:{class:e,line:cW},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:cY},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:cZ},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:ba}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:", ("}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:c_},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:c$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:da}]}]}]}]}]},{type:a,tag:u,props:{},children:[{type:c,value:"执行效果和 promise 版是差不多一样的。"}]},{type:a,tag:au,props:{id:bg},children:[{type:c,value:bg}]},{type:a,tag:u,props:{},children:[{type:c,value:"上面是串行的版本,下面看看并行的实现"},{type:a,tag:bd,props:{},children:[]},{type:c,value:"\n先看 promise 并行一般写法"}]},{type:a,tag:t,props:{code:"function* createIteratorParallel() {\n  const times = yield Promise.all([\n    createDelayPromise(1000),\n    createDelayPromise(2000),\n    createDelayPromise(3000)\n  ]);\n  return times;\n}\n",language:V,meta:H},children:[{type:a,tag:W,props:{},children:[{type:a,tag:t,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:R},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:dm}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:w},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:a_},children:[{type:c,value:a$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:"all"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"([\n"}]}]},{type:a,tag:b,props:{class:e,line:_},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dn}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dn}]}]},{type:a,tag:b,props:{class:e,line:$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cH}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"  ]);\n"}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:be}]}]}]}]}]},{type:a,tag:u,props:{},children:[{type:c,value:"相应的也实现一个 all 方法"}]},{type:a,tag:t,props:{code:"function curryAll(curries, callback) {\n  let len = curries.length;\n  let result = [];\n  let count = 0;\n  curries.forEach((curried, index) =\u003E {\n    curried((err, value) =\u003E {\n      if (err) {\n        callback(err);\n        return;\n      } else {\n        count++;\n        result[index] = value;\n        if (count == len) {\n          callback(null, result);\n        }\n      }\n    });\n  });\n}\n\nconst curriedAll = curry(curryAll);\n\nfunction* createIteratorParallel() {\n  const times = yield curriedAll([curringDelay(1000), curringDelay(2000), curringDelay(3000)]);\n  return times;\n}\n",language:V,meta:H},children:[{type:a,tag:W,props:{},children:[{type:a,tag:t,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:R},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:do0}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ag}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:w},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:dp}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aM}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:_},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" = [];\n"}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:"0"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:"forEach"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:dq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:dr}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:dq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:U}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:Q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:at}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ag}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aq},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:at}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"      } "}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bb}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:z}]}]},{type:a,tag:b,props:{class:e,line:aF},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:at}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"++;\n"}]}]},{type:a,tag:b,props:{class:e,line:aS},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:at}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cz}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:dr}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"] = "}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:B}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:aT},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:at}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" == "}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:dp}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:aU},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ag}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:aV},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dl}]}]},{type:a,tag:b,props:{class:e,line:aX},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"      }\n"}]}]},{type:a,tag:b,props:{class:e,line:aY},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"    });\n"}]}]},{type:a,tag:b,props:{class:e,line:aZ},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bv}]}]},{type:a,tag:b,props:{class:e,line:bw},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:bx},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:by},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:ds}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:do0}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:bz},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:bB},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:dm}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:bC},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ds}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"(["}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dt}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dt}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:")]);\n"}]}]},{type:a,tag:b,props:{class:e,line:bD},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:bE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:be}]}]}]}]}]},{type:a,tag:u,props:{},children:[{type:c,value:"yield 后面依然是柯里化后的函数"}]},{type:a,tag:au,props:{id:du},children:[{type:c,value:dv}]},{type:a,tag:u,props:{},children:[{type:c,value:"上面的方案要求异步任务的回调需要在参数的末尾位置,如果回调不在末尾,那么就需要修改 curry 函数的实现方式,但是有没有可能不用修改其实现方式,甚至不用写 curry 呢?"},{type:a,tag:bd,props:{},children:[]},{type:c,value:"\ncurry 作为函数式编程的基本单元,最新的 es 规范实验性地从语法的角度提供了支持。"}]},{type:a,tag:t,props:{code:"function add(x, y) {\n  return x + y;\n}\n\nconst addOne = add(1, ?); \u002F\u002F apply from the left\naddOne(2); \u002F\u002F 3\n\nconst addTen = add(?, 10); \u002F\u002F apply from the right\naddTen(2); \u002F\u002F 12\n",language:V,meta:H},children:[{type:a,tag:W,props:{},children:[{type:a,tag:t,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:R},children:[{type:a,tag:b,props:{class:bc},children:[{type:c,value:O}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:av}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:x}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:A}]}]},{type:a,tag:b,props:{class:e,line:w},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:av}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:_},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:S}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:$},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:dw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:dx},children:[{type:c,value:bo}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:", ?); "}]},{type:a,tag:b,props:{class:"ct-cae768"},children:[{type:c,value:"\u002F\u002F apply from the left\n"}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:dw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:cu}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{},children:[{type:c,value:N}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:dy}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"(?, "}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:"10"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F apply from the right\n"}]}]},{type:a,tag:b,props:{class:e,line:aq},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:dy}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]},{type:a,tag:b,props:{class:I},children:[{type:c,value:"\u002F\u002F 12"}]}]}]}]}]},{type:a,tag:u,props:{},children:[{type:c,value:"以上的 addOne addTen 就是一个柯里化后的函数,这个语法大部分浏览器都没有支持,如果要使用也很简单,使用一个 babel 插件就可以了 "},{type:a,tag:"code-inline",props:{lang:"sh",class:"colored"},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"babel "}]},{type:a,tag:b,props:{class:aG},children:[{type:c,value:"--plugins"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:aG},children:[{type:c,value:"@babel\u002Fplugin-proposal-partial-application"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:aG},children:[{type:c,value:"script.js"}]}]},{type:c,value:"\n如果使用了上面的语法,可以不用引入 curry 函数"}]},{type:a,tag:t,props:{code:"function* createIterator() {\n  const time1 = yield createDelayCurry(1000, ?);\n  console.log(time1);\n  const time2 = yield createDelayCurry(2000, ?);\n  console.log(time2);\n  const time3 = yield createDelayCurry(3000, ?);\n  console.log(time3);\n  return time1 + time2 + time3;\n}\n",language:V,meta:H},children:[{type:a,tag:W,props:{},children:[{type:a,tag:t,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:R},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:w},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:v},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bH}]}]},{type:a,tag:b,props:{class:e,line:_},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:r},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bH}]}]},{type:a,tag:b,props:{class:e,line:$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ae}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:p}]},{type:a,tag:b,props:{class:cX},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:dx},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:bH}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:ae}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:n}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:s},children:[{type:c,value:ae}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:aq},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:be}]}]}]}]}]},{type:a,tag:u,props:{},children:[{type:c,value:"如果 callback 在前面,那么就把问号放在前面,实际上可以放在任何参数位置上,主要看具体的接口要求。"}]},{type:a,tag:au,props:{id:bi},children:[{type:c,value:bi}]},{type:a,tag:u,props:{},children:[{type:c,value:"柯里化的应用非常广泛,上面只是举了一个简单的例子,通过这个例子,也了解了 async\u002Fawait 基本实现原理,虽然 async\u002Fawait 已经被广泛支持,promise 也被广泛使用,可能不再需要直接使用生成器函数了,但也不妨碍去简单地了解一下。"}]},{type:a,tag:"style",children:[{type:c,value:".ct-1358fb{color:#4EC9B0}\n.ct-753c1e{color:#CE9178}\n.ct-cae768{color:#6A9955}\n.ct-d46786{color:#B5CEA8}\n.ct-50236c{color:#4FC1FF}\n.ct-bae029{color:#C586C0}\n.ct-f38ff1{color:#9CDCFE}\n.ct-c5561f{color:#DCDCAA}\n.ct-2967fd{color:#D4D4D4}\n.ct-b8db2f{color:#569CD6}"}]}],toc:{title:C,searchDepth:w,depth:w,links:[{id:aP,depth:w,text:aP},{id:cv,depth:w,text:cw},{id:db,depth:w,text:dc},{id:bg,depth:w,text:bg},{id:du,depth:w,text:dv},{id:bi,depth:w,text:bi}]}},_type:bl,_id:"content:articles:javaScript:CurryAndAsync.md",_source:"content",_file:"articles\u002FjavaScript\u002FCurryAndAsync.md",_extension:"md"}},state:{},_errors:{"search-navigation":H,"content-navigation-8C37fagqQL":H,"content-query-lYXAcPmJaC":H},serverRendered:true,prerenderedAt:1717110086773,config:{public:{content:{locales:[bm],defaultLocale:bm,integrity:1717110059297,experimental:{stripQueryParameters:ah,clientDB:ah,advancedIgnoresPattern:ah},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{theme:"dark-plus"},wsUrl:C,documentDriven:ah,host:C,trailingSlash:ah,anchorLinks:{depth:X,exclude:[R]}}},app:{baseURL:"\u002Fblog\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:C}}}}("element","span","text","ct-712218","line","ct-d8589a","ct-d3acbd"," ","ct-5bda67","(","ct-2967fd","  ",".",");\n","ct-223fba"," = ","const","ct-a1c1b9","ct-f38ff1","code","p","ct-6d00fb",2,", ",";\n"," {\n",") {\n","value","","result","ct-c5561f","    ","next",null,"ct-bd2f04","yield","console","log","iterator","\n","function","return","=\u003E",1,"}\n","();\n",") ","js","pre",4,"err"," + ",3,5,"time","createIterator","time1","time2","time3","          ","callback",false,6,7,8,"() {\n","((","fn","args"," (",9,"createDelayPromise","curringDelay","        ","h2","x","y","); ","function*","      ","let","createDelayCurry","null","curry",10,11,"ct-999635","resolve","1000","2000","3000","if","length","安装","使用说明","柯里化","add","2",12,13,14,15,"iterator2",16,17,18,"ct-dcbca7","Promise","run","else","ct-b8db2f","br","}",", ...","并行","times","总结","柯里化在异步编程的应用","\u002Farticles\u002Fjavascript\u002Fcurryandasync","markdown","zh-Hans","curried_add","1","generator","  }\n","throw","new","setTimeout","(() ","  });\n",19,20,21,22,"r",23,24,25,26,"curries","count",", ?);\n","文章","\u002Farticles","Css","\u002Farticles\u002Fcss","BFC,层叠上下文,级联层","\u002Farticles\u002Fcss\u002Fbfcstackcascading","css 各种居中方法总结","\u002Farticles\u002Fcss\u002Fcsscenter","纯 css 实现数字自增的动画效果","\u002Farticles\u002Fcss\u002Fcsspropertyatrule","JavaScript","\u002Farticles\u002Fjavascript","async\u002Fawait 异步应用的常用场景","\u002Farticles\u002Fjavascript\u002Fasyncawaitscene","js 浮点数存储精度丢失原理","\u002Farticles\u002Fjavascript\u002Ffloatingpointlossprecision","es6 深入理解 Proxy 和 Reflect 这对影子兄弟","\u002Farticles\u002Fjavascript\u002Fproxyandreflect","移动端","\u002Farticles\u002Fmobile","真的，移动端尺寸自适应与 dpr 无关","\u002Farticles\u002Fmobile\u002Fselfadaptiveanddpr","浏览器插件","\u002Fbrowser_plugins","修改网页信息","\u002Fbrowser_plugins\u002Fmodifyingwebdata","\u002Fbrowser_plugins\u002Fmodifyingwebdata\u002Finstall","\u002Fbrowser_plugins\u002Fmodifyingwebdata\u002Freadme","通用文字识别","\u002Fbrowser_plugins\u002Funiversaltextrecognition","\u002Fbrowser_plugins\u002Funiversaltextrecognition\u002Finstall","\u002Fbrowser_plugins\u002Funiversaltextrecognition\u002Freadme","首页","\u002F","\u002Ftest","工具","\u002Ftools","unicode 字符查询","\u002Ftools\u002Funicodesearch","curryind_add","\u002F\u002F 3\n","generator-和-promise","Generator 和 promise","catch","e","[","(); ",27,"done",28,29,"    } ",30,")\n",31,"        .","then",32,33,34,35,36,37,38,39,"    }\n",40,41,42,"ct-bae029",43,44,45,46,"});","generator-和-柯里化","Generator 和 柯里化","  }, "," = (","=\u003E\n"," \u003C= "," ? ","(...",") : ","bind","        }\n","createIteratorParallel","),\n","curryAll","len","curried","index","curriedAll","), ","es-新语法","es 新语法","addOne","ct-d46786","addTen"))</script><script type="module" src="/blog/_nuxt/entry.8fdf76cc.js" crossorigin></script></body>
</html>