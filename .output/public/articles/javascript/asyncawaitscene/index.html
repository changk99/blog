<!DOCTYPE html>
<html >
<head><meta charset="utf-8">
<title>async&#x2F;await 异步应用的常用场景</title>
<script src="/blog/js/theme.js"></script>
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<link rel="icon" href="/blog/favicon.ico">
<meta property="og:title" content="async/await 异步应用的常用场景"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/entry.c460ab73.js"><link rel="preload" as="style" href="/blog/_nuxt/entry.00bb0547.css"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ArticleSearch.65836448.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/AsideNav.b64431bf.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/_...slug_.8479a609.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentDoc.371274ed.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentRenderer.6c7b8035.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentRendererMarkdown.44fc2a67.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/index.a6ef77ff.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentQuery.7b04af6e.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ClientOnlyIcon.ac0af041.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseH2.a0c3d3e9.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseP.505d65b0.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseCode.04672372.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/use-global-config.544cbc6e.js"><link rel="prefetch" as="image" type="image/jpeg" href="/blog/_nuxt/changlishe.0913a958.jpg"><link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/client-db.f2708fd0.js"><link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/error-component.1a159d9f.js"><link rel="stylesheet" href="/blog/_nuxt/entry.00bb0547.css"><style>.header{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:var(--blog-bg);background-image:linear-gradient(0deg,var(--blog-divider-light),var(--blog-divider-light) 1px,transparent 1px,transparent);display:-webkit-box;display:-ms-flexbox;display:flex;height:var(--navigation-bar-height);justify-content:flex-end;position:sticky;top:0;z-index:100}.header .item{cursor:pointer;margin-right:12px}.header .search{margin-right:auto}.header .avatar-home{-ms-flex-negative:0;flex-shrink:0}@supports ((-webkit-backdrop-filter:blur(1px)) or (backdrop-filter:blur(1px))){.header{-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);background-color:transparent}}.container{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:calc(100% - var(--window-top))}.aside{background-color:var(--blog-bg-regular);min-width:var(--aside-min-width)}.aside-stick{max-height:calc(100vh - var(--navigation-bar-height));overflow:auto;padding-bottom:50px;position:sticky;top:var(--window-top)}.aside-stick,.main{-webkit-box-sizing:border-box;box-sizing:border-box}.main{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;min-height:calc(100vh - var(--navigation-bar-height));min-width:0;padding:1.5em;padding-bottom:var(--safe-bottom-area)}.fade-enter-active,.fade-leave-active{-webkit-transition:all .2s;transition:all .2s}.fade-enter-from,.fade-leave-to{opacity:0}.slide-enter-active{-webkit-transition:all .4s;transition:all .4s}.slide-leave-active{-webkit-transition:all .2s;transition:all .2s}.slide-enter-from,.slide-leave-to{-webkit-transform:translateY(100%);transform:translateY(100%)}#__nuxt{background-color:var(--blog-bg-soft)}.to-top{border:1px solid;border-radius:50%;bottom:1em;color:var(--blog-brand-light);cursor:pointer;line-height:1;opacity:.8;padding:.2em;position:fixed;right:2em}.to-top:hover{opacity:1}.article-outline{max-width:300px}@media screen and (max-width:900px){.article-outline{-webkit-box-shadow:1px 1px 5px 1px var(--blog-shadow-color);box-shadow:1px 1px 5px 1px var(--blog-shadow-color);-webkit-box-sizing:border-box;box-sizing:border-box;max-width:var(--aside-max-width);min-height:calc(100% - var(--navigation-bar-height));min-height:100%;position:fixed;right:0;top:var(--navigation-bar-height);-webkit-transform:translateX(calc(var(--aside-max-width) + 20px));transform:translateX(calc(var(--aside-max-width) + 20px));-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s;z-index:100}.article-outline.open{-webkit-transform:translateX(0);transform:translateX(0)}.article-outline .right-aside{position:static}}@media screen and (max-width:768px){.menu{-webkit-box-shadow:-2px 2px 5px 1px var(--blog-shadow-color);box-shadow:-2px 2px 5px 1px var(--blog-shadow-color);left:0;max-width:var(--aside-max-width);min-height:calc(100% - var(--navigation-bar-height));position:fixed;top:var(--navigation-bar-height);-webkit-transform:scale(0);transform:scale(0);-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s;z-index:100}.menu.open{-webkit-transform:scale(1);transform:scale(1)}.menu .left-aside{position:static}}@media screen and (max-width:500px){.search.is-focus{-webkit-box-flex:1;-ms-flex:1;flex:1}.search.is-focus .el-autocomplete{width:100%}.search.is-focus~.item{display:none}}.nuxt-loading-indicator{top:var(--navigation-bar-height)!important}</style><style>.article-search-wrapper .el-input{--el-input-focus-border-color:var(--blog-brand-light)}.article-search-wrapper .el-input__wrapper{background-color:transparent;border-radius:0;-webkit-box-shadow:0 1px 0 0 transparent;box-shadow:0 1px 0 0 transparent;padding:0}.article-search-wrapper .el-input__wrapper.is-focus{-webkit-box-shadow:0 1px 0 0 var(--el-input-focus-border-color);box-shadow:0 1px 0 0 var(--el-input-focus-border-color)}.article-search-wrapper .el-input__suffix .el-input__icon{color:var(--blog-brand-light)}.article-search-wrapper .el-input__suffix .el-input__icon:hover{color:var(--blog-brand-dark)}.article-search .el-autocomplete-suggestion{max-width:500px}.article-search .empty{font-size:12px}.article-search a{line-height:1.6;padding:0 .2em .2em;position:relative;text-decoration:none;vertical-align:baseline}.article-search a,.article-search a:visited{color:var(--blog-brand-light)}.article-search a:hover{color:var(--blog-brand-highlight)}.article-search a:active{color:var(--blog-brand-light)}.article-search-wrapper{padding:0 1em}@media screen and (max-width:500px){.article-search .el-autocomplete-suggestion{max-width:300px}.article-search .el-autocomplete-suggestion li{white-space:normal}}</style><style>.nav[data-v-9a6baa4a]{cursor:auto!important}.dropdown[data-v-9a6baa4a]{-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;direction:ltr;display:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.dropdown .title[data-v-9a6baa4a]{font-size:14px;white-space:nowrap}.dropdown .arrow[data-v-9a6baa4a]{padding:0 .3em;-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s}.nav-list[data-v-9a6baa4a]{-webkit-box-pack:center;-ms-flex-pack:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;justify-content:center;list-style:none;margin:0;padding:0}.nav-list a[data-v-9a6baa4a]{color:var(--blog-text-1);font-size:14px;text-decoration:none;white-space:nowrap}.nav-item[data-v-9a6baa4a]{margin:0;padding:.1em .3em;position:relative}.nav-item.active[data-v-9a6baa4a],.nav-item[data-v-9a6baa4a]:hover{color:var(--blog-brand-light)}.nav-item .link[data-v-9a6baa4a]{color:inherit;padding:.4em 0}.nav-item[data-v-9a6baa4a]:before{border-bottom:2px solid var(--blog-brand-light);content:"";height:100%;left:100%;position:absolute;top:0;-webkit-transition:all .2s linear;transition:all .2s linear;width:0;z-index:-1}.nav-item[data-v-9a6baa4a]:hover:before{left:0;width:100%}.nav-item:hover~.nav-item[data-v-9a6baa4a]:before{left:0}@media screen and (max-width:500px){.nav[data-v-9a6baa4a]{direction:rtl}.dropdown[data-v-9a6baa4a]{display:-webkit-box;display:-ms-flexbox;display:flex}.dropdown.open .arrow[data-v-9a6baa4a]{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.dropdown .title.active[data-v-9a6baa4a]{color:var(--blog-brand-light)}.nav-list[data-v-9a6baa4a]{--top:auto;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;background-color:var(--blog-bg-regular);border:1px solid var(--blog-text-4);border-radius:.4em;-webkit-box-shadow:var(--blog-shadow-4);box-shadow:var(--blog-shadow-4);direction:ltr;-ms-flex-direction:column;flex-direction:column;margin-top:.2em;padding:.5em .4em 1em;position:fixed;top:var(--top);-webkit-transform:scale(0);transform:scale(0);-webkit-transform-origin:50% 0;transform-origin:50% 0;-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s}.nav-list a[data-v-9a6baa4a]{font-size:13px}.nav-list[data-v-9a6baa4a]:after{border-bottom:1px solid transparent;border-left:1px solid var(--blog-text-4);border-right:1px solid transparent;border-top:1px solid var(--blog-text-4);height:.3em;right:calc(50% - .3em);top:calc(-.3em + 1px);-webkit-transform:rotate(45deg);transform:rotate(45deg);width:.3em;z-index:-1}.nav-list[data-v-9a6baa4a]:after,.nav-list[data-v-9a6baa4a]:before{background-color:var(--blog-bg-regular);content:"";position:absolute}.nav-list[data-v-9a6baa4a]:before{height:.5em;pointer-events:none;right:calc(50% - .5em);top:0;width:1em}.dropdown.open+.nav-list[data-v-9a6baa4a]{-webkit-transform:scale(1);transform:scale(1)}}</style><style>.theme-change[data-v-eea72278]{font-size:0}.theme-change .switch[data-v-eea72278]{background:var(--blog-bg-soft);border:1px solid var(--blog-border-color-1);border-radius:10px;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:inline-block;font-size:16px;height:20px;margin:0;outline:none;position:relative;-webkit-transition:border-color var(--transition-duration),background-color var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration)!important;width:40px}.theme-change .switch[data-v-eea72278]:hover{border-color:var(--blog-border-color-3)}.theme-change .switch__action[data-v-eea72278]{background-color:var(--blog-bg);border-radius:50%;color:var(--blog-text-1);left:1px;position:absolute;top:1px;-webkit-transform:translate(0);transform:translate(0);-webkit-transition:border-color var(--transition-duration),background-color var(--transition-duration),-webkit-transform var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration),-webkit-transform var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration),transform var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration),transform var(--transition-duration),-webkit-transform var(--transition-duration)!important}.theme-change .switch__action[data-v-eea72278],.theme-change .switch__icon[data-v-eea72278]{height:16px;width:16px}.theme-change .switch__icon[data-v-eea72278]{position:relative}.theme-change .icon[data-v-eea72278]{left:0;position:absolute;top:0;-webkit-transition:color var(--transition-duration),opacity var(--transition-duration)!important;transition:color var(--transition-duration),opacity var(--transition-duration)!important}.theme-change .dark-icon[data-v-eea72278]{opacity:0}.dark .switch__action[data-v-eea72278]{-webkit-transform:translate(20px);transform:translate(20px)}.dark .dark-icon[data-v-eea72278]{opacity:1}.dark .light-icon[data-v-eea72278]{opacity:0}</style><style>.icon[data-v-95f7ae78]{fill:currentColor;vertical-align:middle}</style><style>.icon[data-v-42e682c2]{fill:currentColor;vertical-align:middle}</style><style>.icon[data-v-7a55d05e]{fill:currentColor;vertical-align:middle}</style><style>.aside-nav{--el-menu-item-height:44px;--el-menu-base-level-padding:20px;--el-menu-level-padding:1em;--el-menu-sub-item-height:calc(var(--el-menu-item-height) - 6px);padding-top:1em}.aside-nav a{-webkit-box-flex:1;color:var(--blog-text-2);-ms-flex:1;flex:1;overflow:hidden;text-decoration:none;text-overflow:ellipsis}.aside-nav a:hover{color:var(--blog-text-1)}.aside-nav a.router-link-active{color:var(--blog-brand-light)}.aside-nav .el-menu-item{cursor:auto;display:-webkit-box;display:-ms-flexbox;display:flex;font-size:12px;margin:0}.aside-nav .el-divider--horizontal{margin:12px 0}.open-menu{color:var(--blog-brand-light);cursor:pointer;left:0;opacity:.9;padding:.1em .5em .5em;position:fixed;top:calc(var(--navigation-bar-height));-webkit-transition:opacity .3s;transition:opacity .3s;z-index:101}.open-menu .toggle-icon{-webkit-transform:rotate(45deg);transform:rotate(45deg);-webkit-transition:-webkit-transform .5s;transition:-webkit-transform .5s;transition:transform .5s;transition:transform .5s,-webkit-transform .5s}.open-menu.open .toggle-icon{-webkit-transform:rotate(215deg);transform:rotate(215deg)}.scrolling .open-menu{opacity:0}@media screen and (min-width:768px){.open-menu{display:none}}</style><style>.wrapper[data-v-1423ab59]{-webkit-box-pack:center;-ms-flex-pack:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:none;height:50px;justify-content:center}.wrapper.loading[data-v-1423ab59]{display:-webkit-box;display:-ms-flexbox;display:flex}.snow[data-v-1423ab59]{-webkit-animation:rotating-1423ab59 2s linear infinite;animation:rotating-1423ab59 2s linear infinite;color:var(--blog-text-2);height:24px;width:24px}@-webkit-keyframes rotating-1423ab59{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotating-1423ab59{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.spinner[data-v-1423ab59]{height:24px;width:24px}.spinner .path[data-v-1423ab59]{stroke-dasharray:90,150;stroke-dashoffset:0;stroke-width:2;stroke:var(--blog-text-2);stroke-linecap:round;-webkit-animation:loading-dash-1423ab59 1.5s ease-in-out infinite;animation:loading-dash-1423ab59 1.5s ease-in-out infinite}.spinner .circular[data-v-1423ab59]{-webkit-animation:loading-rotate-1423ab59 2s linear infinite;animation:loading-rotate-1423ab59 2s linear infinite}@-webkit-keyframes loading-dash-1423ab59{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}@keyframes loading-dash-1423ab59{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}@-webkit-keyframes loading-rotate-1423ab59{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes loading-rotate-1423ab59{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}</style><style>.content-doc[data-v-58a2f6cb]{padding-bottom:2em}.content-doc[data-v-58a2f6cb] .content{min-height:400px}.content-doc .error[data-v-58a2f6cb]{color:var(--blog-text-1);font-size:2.66667vw;text-align:center}.content-doc .error[data-v-58a2f6cb] .refresh{color:var(--blog-brand-light);cursor:pointer}.nav[data-v-58a2f6cb]{-webkit-box-pack:justify;-ms-flex-pack:justify;display:-webkit-box;display:-ms-flexbox;display:flex;justify-content:space-between}.nav .link[data-v-58a2f6cb]{color:var(--blog-brand-light);font-weight:bolder;line-height:1.6;text-decoration:none;vertical-align:baseline;white-space:nowrap}.nav .link .title[data-v-58a2f6cb]{display:inline-block;vertical-align:middle;white-space:normal}.nav .link[data-v-58a2f6cb]:hover{color:var(--blog-brand-highlight)}.nav .link[data-v-58a2f6cb]:active{color:var(--blog-brand-light)}.nav .dir-title[data-v-58a2f6cb]{color:var(--blog-text-2);font-size:14px}.nav .nav-item[data-v-58a2f6cb]{min-width:0;word-break:break-all}.nav .nav-item-after .dir-title[data-v-58a2f6cb]{margin-right:1em;text-align:right}.nav .nav-item-before[data-v-58a2f6cb]{padding-right:2em}.nav .nav-item-before .dir-title[data-v-58a2f6cb]{margin-left:1em}</style><style>.icon[data-v-bfbb85d1]{fill:currentColor;vertical-align:middle}</style><style>.icon[data-v-d5088638]{fill:currentColor;vertical-align:middle}</style><style>.title[data-v-924fdd6f]{color:var(--blog-text-h);font-size:var(--blog-font-size-h2);margin:.2em 0;padding-left:.2em}.link[data-v-924fdd6f]{color:inherit;text-decoration:none}.symbol[data-v-924fdd6f]{color:var(--blog-brand-light);opacity:0}.title:hover .symbol[data-v-924fdd6f]{opacity:1}</style><style>.prose-p[data-v-4aba2c1d]{padding:0}</style><style>.prose-code{background-color:var(--blog-gray-light-5);border:1px solid var(--blog-border-color-3);border-radius:var(--blog-radius-2);-webkit-box-sizing:border-box;box-sizing:border-box;margin:1em 0;padding:1em;position:relative}.prose-code.lang{background-color:var(--blog-black-regular);padding-bottom:0;padding-right:1.6em;padding-top:1.8em}.prose-code.lang .file-info{color:var(--blog-text-dark-2);font-size:12px;position:absolute;right:1em;top:.5em}.prose-code.lang pre code{word-wrap:normal;color:hsla(0,0%,100%,.87);font-size:.9em;line-height:1.35;white-space:pre}.prose-code.no-lang{padding-bottom:.2em;padding-top:1.2em}.prose-code.no-lang pre{font-family:inherit}.prose-code.no-lang pre code{font-family:inherit;padding-bottom:.8em;white-space:pre-wrap}.prose-code.no-lang a{padding:0 .2em;position:relative;text-decoration:none;vertical-align:baseline}.prose-code.no-lang a,.prose-code.no-lang a:visited{color:var(--blog-brand-light)}.prose-code.no-lang a:hover{color:var(--blog-brand-highlight)}.prose-code.no-lang a:active{color:var(--blog-brand-light)}.prose-code pre{margin:0}.prose-code pre code{display:inline-block;overflow:auto;padding-bottom:1.5em;white-space:normal;width:100%}.prose-code .copy{bottom:.5em;color:var(--blog-text-dark-1);cursor:pointer;opacity:.5;position:absolute;right:.2em}.prose-code:hover .copy{opacity:1}pre code .line{display:block;line-height:1.6;min-height:1rem}.dark .prose-code.no-lang{background-color:var(--blog-black-regular)}.el-message--success.copy{--el-message-bg-color:var(--blog-bg-soft);--el-message-border-color:var(--blog-border-color-2);--el-message-text-color:var(--blog-text-2);white-space:nowrap;width:auto}.prose-code ::-webkit-scrollbar{height:8px;width:10px}.prose-code ::-webkit-scrollbar-track{background:var(--blog-black-soft);border-radius:10px}.prose-code ::-webkit-scrollbar-thumb{background:var(--blog-black-mute);border-radius:10px}.prose-code ::-webkit-scrollbar-thumb:hover{background:#646464;border-radius:10px}.prose-code ::-webkit-scrollbar-thumb:active{background:#444;border-radius:10px}@media screen and (max-width:768px){.prose-code ::-webkit-scrollbar{height:2px;width:2px}}</style></head>
<body ><div id="el-popper-container-1024"><div style="z-index:2014;position:absolute;left:0;top:0;display:none;" class="el-popper is-pure is-light el-autocomplete__popper article-search" tabindex="-1" aria-hidden="true"><!--[--><!--[--><!--[--><!--[--><div class="el-autocomplete-suggestion" style="min-width:;outline:none;" role="region"><div class="el-scrollbar" id="el-autocomplete-2586" role="listbox"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default" style=""><ul class="el-scrollbar__view el-autocomplete-suggestion__list" style=""><!--[--><!--]--></ul></div><!--[--><div class="el-scrollbar__bar is-horizontal" style="display:none;"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical" style="display:none;"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);"></div></div><!--]--></div></div><!--]--><span class="el-popper__arrow" style="position:absolute;" data-popper-arrow></span><!--]--><!--]--><!--]--></div><!--teleport anchor--></div><div id="__nuxt"><!--[--><header class="header"><div class="search item"><div class="article-search-wrapper"><!--[--><div class="el-autocomplete search el-tooltip__trigger el-tooltip__trigger" style="" role="combobox" aria-owns="el-autocomplete-2586"><div class="el-input el-input--prefix el-input--suffix" style=""><!-- input --><!--[--><!-- prepend slot --><!--v-if--><div class="el-input__wrapper"><!-- prefix slot --><span class="el-input__prefix"><span class="el-input__prefix-inner"><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 20 20" class="icon search-icon" data-v-bfbb85d1><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-bfbb85d1></path></svg><!--]--><!--]--><!--v-if--></span></span><input class="el-input__inner" type="text" autocomplete="off" tabindex="0" placeholder="搜索" style=""><!-- suffix slot --><!--v-if--></div><!-- append slot --><!--v-if--><!--]--></div></div><!--teleport start--><!--teleport end--><!--]--></div></div><nav class="nav item" data-v-9a6baa4a><!--[--><div class="dropdown" data-v-9a6baa4a><span class="title" data-v-9a6baa4a>文章</span><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 1024 1024" class="icon arrow" data-v-9a6baa4a data-v-d5088638><path d="M831.872 340.864 512 652.672 192.128 340.864a30.592 30.592 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.592 30.592 0 0 0-42.752 0z" data-v-d5088638></path></svg></div><ul class="nav-list" data-v-9a6baa4a><!--[--><li class="active nav-item" data-v-9a6baa4a><a href="/blog/articles/css/bfcstackcascading" class="link" data-v-9a6baa4a>文章</a></li><li class="nav-item" data-v-9a6baa4a><a href="/blog/browser_plugins/modifyingwebdata/install" class="link" data-v-9a6baa4a>浏览器插件</a></li><li class="nav-item" data-v-9a6baa4a><a href="/blog/tools/douyin" class="link" data-v-9a6baa4a>工具</a></li><!--]--></ul><!--]--></nav><div class="theme-change item" title="切换主题" data-v-eea72278><button role="switch" aria-label="切换暗色主题" aria-checked="false" class="switch" data-v-eea72278><div class="switch__action" data-v-eea72278><div class="switch__icon" data-v-eea72278><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon dark-icon icon" data-v-eea72278 data-v-95f7ae78><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z" data-v-95f7ae78></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon light-icon icon" data-v-eea72278 data-v-42e682c2><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z" data-v-42e682c2></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z" data-v-42e682c2></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z" data-v-42e682c2></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z" data-v-42e682c2></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z" data-v-42e682c2></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z" data-v-42e682c2></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z" data-v-42e682c2></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z" data-v-42e682c2></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z" data-v-42e682c2></path></svg></div></div></button></div><div title="github 仓库" class="item"><svg xmlns="http://www.w3.org/2000/svg" width="1.8em" height="1.8em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-7a55d05e><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z" data-v-7a55d05e></path></svg></div><span class="el-avatar el-avatar--circle avatar-home item" style="--el-avatar-size:26px;" title="首页"><img src="/blog/_nuxt/changlishe.0913a958.jpg" alt="首页" style="object-fit:cover;"></span></header><div class="container"><aside style="" class="open aside menu"><div class="aside-stick left-aside"><nav class="nav"><span></span><ul role="menubar" style="--el-menu-level:0;" class="el-menu el-menu--vertical aside-nav"><!--[--><!--]--><div class="wrapper loading" data-v-1423ab59><div class="spinner" data-v-1423ab59><svg class="circular" viewBox="0 0 50 50" data-v-1423ab59><circle class="path" cx="25" cy="25" r="20" fill="none" data-v-1423ab59></circle></svg></div><!----></div><div class="el-divider el-divider--horizontal" style="--el-border-style:solid;" role="separator"><!--v-if--></div><!--[--><li class="el-menu-item" role="menuitem" tabindex="-1"><!--[--><!--[--><a href="/blog/test" class="">markdown</a><!--]--><!--[--><!--]--><!--]--></li><!--]--></ul></nav></div></aside><main class="main"><div class="content-doc" data-v-58a2f6cb><!--[--><div class="content"><h2 class="title" id="前言" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/asyncawaitscene#前言" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->前言<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->async/await 语法用看起来像写同步代码的方式来优雅地处理异步操作,但是我们也要明白一点,异步操作本来带有复杂性,像写同步代码的方式并不能降低本质上的复杂性,所以在处理上我们要更加谨慎, 稍有不慎就可能写出不是预期执行的代码,从而影响执行效率。下面将简单地描述一下一些日常常用场景,加深对 async/await 认识<!--]--></p><p class="prose-p" data-v-4aba2c1d><!--[-->最普遍的异步操作就是请求,我们也可以用 setTimeOut 来简单模拟异步请求。<!--]--></p><h2 class="title" id="场景-1-一个请求接着一个请求" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/asyncawaitscene#场景-1-一个请求接着一个请求" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->场景 1. 一个请求接着一个请求<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->相信这个场景是最常遇到,后一个请求依赖前一个请求,下面以爬取一个网页内的图片为例子进行描述,使用了 superagent 请求模块, cheerio 页面分析模块,图片的地址需要分析网页内容得出,所以必须按顺序进行请求。<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">const</span><span class="ct-53cb43"> </span><span class="ct-7094fa">request</span><span class="ct-53cb43"> = </span><span class="ct-6faf40">require</span><span class="ct-53cb43">(</span><span class="ct-7bec6a">&#39;superagent&#39;</span><span class="ct-53cb43">)
</span></span><span class="line" line="2"><span class="ct-57f199">const</span><span class="ct-53cb43"> </span><span class="ct-7094fa">cheerio</span><span class="ct-53cb43"> = </span><span class="ct-6faf40">require</span><span class="ct-53cb43">(</span><span class="ct-7bec6a">&#39;cheerio&#39;</span><span class="ct-53cb43">)
</span></span><span class="line" line="3"><span class="ct-a7bb81">// 简单封装下请求,其他的类似
</span></span><span class="line" line="4"><span>
</span></span><span class="line" line="5"><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">getHTML</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">) {
</span></span><span class="line" line="6"><span class="ct-a7bb81">// 一些操作,比如设置一下请求头信息
</span></span><span class="line" line="7"><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-89b320">superagent</span><span class="ct-53cb43">.</span><span class="ct-6faf40">get</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">).</span><span class="ct-6faf40">set</span><span class="ct-53cb43">(</span><span class="ct-7bec6a">&#39;referer&#39;</span><span class="ct-53cb43">, </span><span class="ct-89b320">referer</span><span class="ct-53cb43">).</span><span class="ct-6faf40">set</span><span class="ct-53cb43">(</span><span class="ct-7bec6a">&#39;user-agent&#39;</span><span class="ct-53cb43">, </span><span class="ct-89b320">userAgent</span><span class="ct-53cb43">)
</span></span><span class="line" line="8"><span class="ct-53cb43">}
</span></span><span class="line" line="9"><span class="ct-a7bb81">// 下面就请求一张图片
</span></span><span class="line" line="10"><span class="ct-57f199">async</span><span class="ct-53cb43"> </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">imageCrawler</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">) {
</span></span><span class="line" line="11"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">res</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">getHTML</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">)
</span></span><span class="line" line="12"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">html</span><span class="ct-53cb43"> = </span><span class="ct-89b320">res</span><span class="ct-53cb43">.</span><span class="ct-89b320">text
</span></span><span class="line" line="13"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">$</span><span class="ct-53cb43"> = </span><span class="ct-89b320">cheerio</span><span class="ct-53cb43">.</span><span class="ct-6faf40">load</span><span class="ct-53cb43">(</span><span class="ct-89b320">html</span><span class="ct-53cb43">)
</span></span><span class="line" line="14"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">$img</span><span class="ct-53cb43"> = </span><span class="ct-6faf40">$</span><span class="ct-53cb43">(</span><span class="ct-89b320">selector</span><span class="ct-53cb43">)[</span><span class="ct-cccbd6">0</span><span class="ct-53cb43">]
</span></span><span class="line" line="15"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">href</span><span class="ct-53cb43"> = </span><span class="ct-89b320">$img</span><span class="ct-53cb43">.</span><span class="ct-89b320">attribs</span><span class="ct-53cb43">.</span><span class="ct-89b320">src
</span></span><span class="line" line="16"><span class="ct-53cb43">  </span><span class="ct-89b320">res</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">getImage</span><span class="ct-53cb43">(</span><span class="ct-89b320">href</span><span class="ct-53cb43">)
</span></span><span class="line" line="17"><span class="ct-53cb43">  </span><span class="ct-89b320">retrun</span><span class="ct-53cb43"> </span><span class="ct-89b320">res</span><span class="ct-53cb43">.</span><span class="ct-89b320">body
</span></span><span class="line" line="18"><span class="ct-53cb43">}
</span></span><span class="line" line="19"><span class="ct-57f199">async</span><span class="ct-53cb43"> </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">handler</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">) {
</span></span><span class="line" line="20"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">img</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">imageCrawler</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">)
</span></span><span class="line" line="21"><span class="ct-53cb43">  </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">img</span><span class="ct-53cb43">) </span><span class="ct-a7bb81">// buffer 格式的数据
</span></span><span class="line" line="22"><span class="ct-53cb43">  </span><span class="ct-a7bb81">// 处理图片
</span></span><span class="line" line="23"><span class="ct-53cb43">}
</span></span><span class="line" line="24"><span class="ct-6faf40">handler</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">)</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->上面就是一个简单的获取图片数据的场景,图片数据是加载进内存中,如果只是简单的存储数据,可以用流的形式进行存储,以防止消耗太多内存。<!--]--></p><p class="prose-p" data-v-4aba2c1d><!--[-->其中 await getHTML 是必须的,如果省略了 await 程序就不能按预期得到结果。执行流程会先执行 await 后面的表达式,其实际返回的是一个处于 pending 状态的 promise,等到这个 promise 处于已决议状态后才会执行 await 后面的操作,其中的代码执行会跳出 async 函数,继续执行函数外面的其他代码,所以并不会阻塞后续代码的执行。<!--]--></p><h2 class="title" id="场景-2并发请求" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/asyncawaitscene#场景-2并发请求" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->场景 2.并发请求<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->有的时候我们并不需要等待一个请求回来才发出另一个请求,这样效率是很低的,所以这个时候就需要并发执行请求任务。下面以一个查询为例,先获取一个人的学校地址和家庭住址,再由这些信息获取详细的个人信息,学校地址和家庭住址是没有依赖关系的,后面的获取个人信息依赖于两者<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">async</span><span class="ct-53cb43"> </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">infoCrawler</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">, </span><span class="ct-89b320">name</span><span class="ct-53cb43">) {
</span></span><span class="line" line="2"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> [</span><span class="ct-89b320">schoolAdr</span><span class="ct-53cb43">, </span><span class="ct-89b320">homeAdr</span><span class="ct-53cb43">] = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43">.</span><span class="ct-6faf40">all</span><span class="ct-53cb43">([</span><span class="ct-6faf40">getSchoolAdr</span><span class="ct-53cb43">(</span><span class="ct-89b320">name</span><span class="ct-53cb43">), </span><span class="ct-6faf40">getHomeAdr</span><span class="ct-53cb43">(</span><span class="ct-89b320">name</span><span class="ct-53cb43">)]);
</span></span><span class="line" line="3"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">info</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">getInfo</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43"> + </span><span class="ct-7bec6a">`?schoolAdr=</span><span class="ct-57f199">${</span><span class="ct-89b320">schoolAdr</span><span class="ct-57f199">}</span><span class="ct-7bec6a">&amp;homeAdr=</span><span class="ct-57f199">${</span><span class="ct-89b320">homeAdr</span><span class="ct-57f199">}</span><span class="ct-7bec6a">`</span><span class="ct-53cb43">);
</span></span><span class="line" line="4"><span class="ct-53cb43">  </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-89b320">info</span><span class="ct-53cb43">;
</span></span><span class="line" line="5"><span class="ct-53cb43">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->上面使用的 Promise.all 里面的异步请求都会并发执行,并等到数据都准备后返回相应的按数据顺序返回的数组,这里最后处理获取信息的时间,由并发请求中最慢的请求决定,例如 getSchoolAdr 迟迟不返回数据,那么后续操作只能等待,就算 getHomeAdr 已经提前返回了,当然以上场景必须是这么做,但是有的时候我们并不需要这么做。<!--]--></p><p class="prose-p" data-v-4aba2c1d><!--[-->上面第一个场景中,我们只获取到一张图片,但是可能一个网页中不止一张图片,如果我们要把这些图片存储起来,其实是没有必要等待图片都并发请求回来后再处理,哪张图片早回来就存储哪张就行了<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">imageUrls</span><span class="ct-53cb43"> = [</span><span class="ct-7bec6a">&#39;href1&#39;</span><span class="ct-53cb43">, </span><span class="ct-7bec6a">&#39;href2&#39;</span><span class="ct-53cb43">, </span><span class="ct-7bec6a">&#39;href3&#39;</span><span class="ct-53cb43">];
</span></span><span class="line" line="2"><span class="ct-57f199">async</span><span class="ct-53cb43"> </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">saveImages</span><span class="ct-53cb43">(</span><span class="ct-89b320">imageUrls</span><span class="ct-53cb43">) {
</span></span><span class="line" line="3"><span class="ct-53cb43">  </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43">.</span><span class="ct-6faf40">all</span><span class="ct-53cb43">(
</span></span><span class="line" line="4"><span class="ct-53cb43">    </span><span class="ct-89b320">imageUrls</span><span class="ct-53cb43">.</span><span class="ct-6faf40">map</span><span class="ct-53cb43">(</span><span class="ct-57f199">async</span><span class="ct-53cb43"> (</span><span class="ct-89b320">imageUrl</span><span class="ct-53cb43">) </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="5"><span class="ct-53cb43">      </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">img</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">getImage</span><span class="ct-53cb43">(</span><span class="ct-89b320">imageUrl</span><span class="ct-53cb43">);
</span></span><span class="line" line="6"><span class="ct-53cb43">      </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">saveImage</span><span class="ct-53cb43">(</span><span class="ct-89b320">img</span><span class="ct-53cb43">);
</span></span><span class="line" line="7"><span class="ct-53cb43">    })
</span></span><span class="line" line="8"><span class="ct-53cb43">  );
</span></span><span class="line" line="9"><span class="ct-53cb43">  </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-7bec6a">&#39;done&#39;</span><span class="ct-53cb43">);
</span></span><span class="line" line="10"><span class="ct-53cb43">}
</span></span><span class="line" line="11"><span class="ct-a7bb81">// 如果我们连存储是否全部完成也不关心,也可以这么写
</span></span><span class="line" line="12"><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">imageUrls</span><span class="ct-53cb43"> = [</span><span class="ct-7bec6a">&#39;href1&#39;</span><span class="ct-53cb43">, </span><span class="ct-7bec6a">&#39;href2&#39;</span><span class="ct-53cb43">, </span><span class="ct-7bec6a">&#39;href3&#39;</span><span class="ct-53cb43">];
</span></span><span class="line" line="13"><span class="ct-a7bb81">// saveImages() 连 async 都省了
</span></span><span class="line" line="14"><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">saveImages</span><span class="ct-53cb43">(</span><span class="ct-89b320">imageUrls</span><span class="ct-53cb43">) {
</span></span><span class="line" line="15"><span class="ct-53cb43">  </span><span class="ct-89b320">imageUrls</span><span class="ct-53cb43">.</span><span class="ct-6faf40">forEach</span><span class="ct-53cb43">(</span><span class="ct-57f199">async</span><span class="ct-53cb43"> (</span><span class="ct-89b320">imageUrl</span><span class="ct-53cb43">) </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="16"><span class="ct-53cb43">    </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">img</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">getImage</span><span class="ct-53cb43">(</span><span class="ct-89b320">imageUrl</span><span class="ct-53cb43">);
</span></span><span class="line" line="17"><span class="ct-53cb43">    </span><span class="ct-6faf40">saveImage</span><span class="ct-53cb43">(</span><span class="ct-89b320">img</span><span class="ct-53cb43">);
</span></span><span class="line" line="18"><span class="ct-53cb43">  });
</span></span><span class="line" line="19"><span class="ct-53cb43">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->可能有人会疑问 forEach 不是不能用于异步吗,这个说法我也在刚接触这个语法的时候就听说过,很明显 forEach 是可以处理异步的,只是是并发处理,map 也是并发处理,这个怎么用主要看你的实际场景,还要看你是否对结果感兴趣<!--]--></p><h2 class="title" id="场景-3错误处理" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/asyncawaitscene#场景-3错误处理" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->场景 3.错误处理<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->一个请求发出,可以会遇到各种问题,我们是无法保证一定成功的,报错是常有的事,所以处理错误有时很有必要, async/await 处理错误也非常直观, 使用 try/catch 直接捕获就可以了<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">async</span><span class="ct-53cb43"> </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">imageCrawler</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">) {
</span></span><span class="line" line="2"><span class="ct-53cb43">  </span><span class="ct-17f2ac">try</span><span class="ct-53cb43"> {
</span></span><span class="line" line="3"><span class="ct-53cb43">    </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">img</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">getImage</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">);
</span></span><span class="line" line="4"><span class="ct-53cb43">    </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-89b320">img</span><span class="ct-53cb43">;
</span></span><span class="line" line="5"><span class="ct-53cb43">  } </span><span class="ct-17f2ac">catch</span><span class="ct-53cb43"> (</span><span class="ct-89b320">error</span><span class="ct-53cb43">) {
</span></span><span class="line" line="6"><span class="ct-53cb43">    </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">error</span><span class="ct-53cb43">);
</span></span><span class="line" line="7"><span class="ct-53cb43">  }
</span></span><span class="line" line="8"><span class="ct-53cb43">}
</span></span><span class="line" line="9"><span class="ct-a7bb81">// imageCrawler 返回的是一个 promise 可以这样处理
</span></span><span class="line" line="10"><span class="ct-57f199">async</span><span class="ct-53cb43"> </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">imageCrawler</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">) {
</span></span><span class="line" line="11"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">img</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">getImage</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">);
</span></span><span class="line" line="12"><span class="ct-53cb43">  </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-89b320">img</span><span class="ct-53cb43">;
</span></span><span class="line" line="13"><span class="ct-53cb43">}
</span></span><span class="line" line="14"><span class="ct-6faf40">imageCrawler</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">).</span><span class="ct-6faf40">catch</span><span class="ct-53cb43">((</span><span class="ct-89b320">err</span><span class="ct-53cb43">) </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="15"><span class="ct-53cb43">  </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">err</span><span class="ct-53cb43">);
</span></span><span class="line" line="16"><span class="ct-53cb43">});</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->可能有人会有疑问,是不是要在每个请求中都 try/catch 一下,这个其实你在最外层 catch 一下就可以了,一些基于中间件的设计就喜欢在最外层捕获错误<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">async</span><span class="ct-53cb43"> </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">ctx</span><span class="ct-53cb43">(</span><span class="ct-89b320">next</span><span class="ct-53cb43">) {
</span></span><span class="line" line="2"><span class="ct-53cb43">  </span><span class="ct-17f2ac">try</span><span class="ct-53cb43"> {
</span></span><span class="line" line="3"><span class="ct-53cb43">    </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">next</span><span class="ct-53cb43">();
</span></span><span class="line" line="4"><span class="ct-53cb43">  } </span><span class="ct-17f2ac">catch</span><span class="ct-53cb43"> (</span><span class="ct-89b320">error</span><span class="ct-53cb43">) {
</span></span><span class="line" line="5"><span class="ct-53cb43">    </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">error</span><span class="ct-53cb43">);
</span></span><span class="line" line="6"><span class="ct-53cb43">  }
</span></span><span class="line" line="7"><span class="ct-53cb43">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><h2 class="title" id="场景-4-超时处理" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/asyncawaitscene#场景-4-超时处理" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->场景 4. 超时处理<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->一个请求发出,我们是无法确定什么时候返回的,也总不能一直傻傻的等,设置超时处理有时是很有必要的<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">timeOut</span><span class="ct-53cb43">(</span><span class="ct-89b320">delay</span><span class="ct-53cb43">) {
</span></span><span class="line" line="2"><span class="ct-53cb43">  </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-57f199">new</span><span class="ct-53cb43"> </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43">((</span><span class="ct-89b320">resolve</span><span class="ct-53cb43">, </span><span class="ct-89b320">reject</span><span class="ct-53cb43">) </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="3"><span class="ct-53cb43">    </span><span class="ct-6faf40">setTimeout</span><span class="ct-53cb43">(() </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="4"><span class="ct-53cb43">      </span><span class="ct-6faf40">reject</span><span class="ct-53cb43">(</span><span class="ct-57f199">new</span><span class="ct-53cb43"> </span><span class="ct-6faf40">Error</span><span class="ct-53cb43">(</span><span class="ct-7bec6a">&#39;不用等了,别傻了&#39;</span><span class="ct-53cb43">));
</span></span><span class="line" line="5"><span class="ct-53cb43">    }, </span><span class="ct-89b320">delay</span><span class="ct-53cb43">);
</span></span><span class="line" line="6"><span class="ct-53cb43">  });
</span></span><span class="line" line="7"><span class="ct-53cb43">}
</span></span><span class="line" line="8"><span>
</span></span><span class="line" line="9"><span class="ct-57f199">async</span><span class="ct-53cb43"> </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">imageCrawler</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">, </span><span class="ct-89b320">delay</span><span class="ct-53cb43">) {
</span></span><span class="line" line="10"><span class="ct-53cb43">  </span><span class="ct-17f2ac">try</span><span class="ct-53cb43"> {
</span></span><span class="line" line="11"><span class="ct-53cb43">    </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">img</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43">.</span><span class="ct-6faf40">race</span><span class="ct-53cb43">([</span><span class="ct-6faf40">getImage</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">), </span><span class="ct-6faf40">timeOut</span><span class="ct-53cb43">(</span><span class="ct-89b320">delay</span><span class="ct-53cb43">)]);
</span></span><span class="line" line="12"><span class="ct-53cb43">    </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-89b320">img</span><span class="ct-53cb43">;
</span></span><span class="line" line="13"><span class="ct-53cb43">  } </span><span class="ct-17f2ac">catch</span><span class="ct-53cb43"> (</span><span class="ct-89b320">error</span><span class="ct-53cb43">) {
</span></span><span class="line" line="14"><span class="ct-53cb43">    </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">error</span><span class="ct-53cb43">);
</span></span><span class="line" line="15"><span class="ct-53cb43">  }
</span></span><span class="line" line="16"><span class="ct-53cb43">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->这里使用 Promise.race 处理超时,要注意的是,如果超时了,请求还是没有终止的,只是不再进行后续处理。当然也不用担心,后续处理会报错而导致重新处理出错信息, 因为 promise 的状态一经改变是不会再改变的<!--]--></p><h2 class="title" id="场景-5-并发限制" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/asyncawaitscene#场景-5-并发限制" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->场景 5. 并发限制<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->在并发请求的场景中,如果需要大量并发,必须要进行并发限制,不然会被网站屏蔽或者造成进程崩溃<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">async</span><span class="ct-53cb43"> </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">getImages</span><span class="ct-53cb43">(</span><span class="ct-89b320">urls</span><span class="ct-53cb43">, </span><span class="ct-89b320">limit</span><span class="ct-53cb43">) {
</span></span><span class="line" line="2"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">running</span><span class="ct-53cb43"> = </span><span class="ct-cccbd6">0</span><span class="ct-53cb43">;
</span></span><span class="line" line="3"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">r</span><span class="ct-53cb43">;
</span></span><span class="line" line="4"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">p</span><span class="ct-53cb43"> = </span><span class="ct-57f199">new</span><span class="ct-53cb43"> </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43">((</span><span class="ct-89b320">resolve</span><span class="ct-53cb43">, </span><span class="ct-89b320">reject</span><span class="ct-53cb43">) </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="5"><span class="ct-53cb43">    </span><span class="ct-89b320">r</span><span class="ct-53cb43"> = </span><span class="ct-89b320">resolve</span><span class="ct-53cb43">;
</span></span><span class="line" line="6"><span class="ct-53cb43">  });
</span></span><span class="line" line="7"><span class="ct-53cb43">  </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">run</span><span class="ct-53cb43">() {
</span></span><span class="line" line="8"><span class="ct-53cb43">    </span><span class="ct-17f2ac">if</span><span class="ct-53cb43"> (</span><span class="ct-89b320">running</span><span class="ct-53cb43"> &lt; </span><span class="ct-89b320">limit</span><span class="ct-53cb43"> &amp;&amp; </span><span class="ct-89b320">urls</span><span class="ct-53cb43">.</span><span class="ct-89b320">length</span><span class="ct-53cb43"> &gt; </span><span class="ct-cccbd6">0</span><span class="ct-53cb43">) {
</span></span><span class="line" line="9"><span class="ct-53cb43">      </span><span class="ct-89b320">running</span><span class="ct-53cb43">++;
</span></span><span class="line" line="10"><span class="ct-53cb43">      </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">url</span><span class="ct-53cb43"> = </span><span class="ct-89b320">urls</span><span class="ct-53cb43">.</span><span class="ct-6faf40">shift</span><span class="ct-53cb43">();
</span></span><span class="line" line="11"><span class="ct-53cb43">      (</span><span class="ct-57f199">async</span><span class="ct-53cb43"> () </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="12"><span class="ct-53cb43">        </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">img</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">getImage</span><span class="ct-53cb43">(</span><span class="ct-89b320">url</span><span class="ct-53cb43">);
</span></span><span class="line" line="13"><span class="ct-53cb43">        </span><span class="ct-89b320">running</span><span class="ct-53cb43">--;
</span></span><span class="line" line="14"><span class="ct-53cb43">        </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">img</span><span class="ct-53cb43">);
</span></span><span class="line" line="15"><span class="ct-53cb43">        </span><span class="ct-17f2ac">if</span><span class="ct-53cb43"> (</span><span class="ct-89b320">urls</span><span class="ct-53cb43">.</span><span class="ct-89b320">length</span><span class="ct-53cb43"> === </span><span class="ct-cccbd6">0</span><span class="ct-53cb43"> &amp;&amp; </span><span class="ct-89b320">running</span><span class="ct-53cb43"> === </span><span class="ct-cccbd6">0</span><span class="ct-53cb43">) {
</span></span><span class="line" line="16"><span class="ct-53cb43">          </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-7bec6a">&#39;done&#39;</span><span class="ct-53cb43">);
</span></span><span class="line" line="17"><span class="ct-53cb43">          </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-6faf40">r</span><span class="ct-53cb43">(</span><span class="ct-7bec6a">&#39;done&#39;</span><span class="ct-53cb43">);
</span></span><span class="line" line="18"><span class="ct-53cb43">        } </span><span class="ct-17f2ac">else</span><span class="ct-53cb43"> {
</span></span><span class="line" line="19"><span class="ct-53cb43">          </span><span class="ct-6faf40">run</span><span class="ct-53cb43">();
</span></span><span class="line" line="20"><span class="ct-53cb43">        }
</span></span><span class="line" line="21"><span class="ct-53cb43">      })();
</span></span><span class="line" line="22"><span class="ct-53cb43">      </span><span class="ct-6faf40">run</span><span class="ct-53cb43">(); </span><span class="ct-a7bb81">// 立即到并发上限
</span></span><span class="line" line="23"><span class="ct-53cb43">    }
</span></span><span class="line" line="24"><span class="ct-53cb43">  }
</span></span><span class="line" line="25"><span class="ct-53cb43">  </span><span class="ct-6faf40">run</span><span class="ct-53cb43">();
</span></span><span class="line" line="26"><span class="ct-53cb43">  </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-89b320">p</span><span class="ct-53cb43">;
</span></span><span class="line" line="27"><span class="ct-53cb43">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><h2 class="title" id="总结" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/asyncawaitscene#总结" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->总结<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->以上列举了一些日常场景处理的代码片段,在遇到比较复杂场景时,可以结合以上的场景进行组合使用,如果场景过于复杂,最好的办法是使用相关的异步代码控制库。如果想更好地了解 async/await 可以先去了解 promise 和 generator, async/await 基本上是 generator 函数的语法糖,下面简单的描述了一下内部的原理。<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-89b320">time</span><span class="ct-53cb43">) {
</span></span><span class="line" line="2"><span class="ct-53cb43">  </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-57f199">new</span><span class="ct-53cb43"> </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43">((</span><span class="ct-89b320">resolve</span><span class="ct-53cb43">, </span><span class="ct-89b320">reject</span><span class="ct-53cb43">) </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="3"><span class="ct-53cb43">    </span><span class="ct-6faf40">setTimeout</span><span class="ct-53cb43">(() </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="4"><span class="ct-53cb43">        </span><span class="ct-6faf40">resolve</span><span class="ct-53cb43">(</span><span class="ct-89b320">time</span><span class="ct-53cb43">)
</span></span><span class="line" line="5"><span class="ct-53cb43">    }, </span><span class="ct-89b320">time</span><span class="ct-53cb43">)
</span></span><span class="line" line="6"><span class="ct-53cb43">  })
</span></span><span class="line" line="7"><span class="ct-53cb43">}
</span></span><span class="line" line="8"><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-57f199">*</span><span class="ct-6faf40">createTime</span><span class="ct-53cb43">() {
</span></span><span class="line" line="9"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">time1</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">yield</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">1000</span><span class="ct-53cb43">)
</span></span><span class="line" line="10"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">time2</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">yield</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">2000</span><span class="ct-53cb43">)
</span></span><span class="line" line="11"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">time3</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">yield</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">3000</span><span class="ct-53cb43">)
</span></span><span class="line" line="12"><span class="ct-53cb43">  </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">time1</span><span class="ct-53cb43">, </span><span class="ct-89b320">time2</span><span class="ct-53cb43">, </span><span class="ct-89b320">time3</span><span class="ct-53cb43">)
</span></span><span class="line" line="13"><span class="ct-53cb43">}
</span></span><span class="line" line="14"><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">iterator</span><span class="ct-53cb43"> = </span><span class="ct-6faf40">createTime</span><span class="ct-53cb43">()
</span></span><span class="line" line="15"><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">iterator</span><span class="ct-53cb43">.</span><span class="ct-6faf40">next</span><span class="ct-53cb43">())
</span></span><span class="line" line="16"><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">iterator</span><span class="ct-53cb43">.</span><span class="ct-6faf40">next</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">1000</span><span class="ct-53cb43">))
</span></span><span class="line" line="17"><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">iterator</span><span class="ct-53cb43">.</span><span class="ct-6faf40">next</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">2000</span><span class="ct-53cb43">))
</span></span><span class="line" line="18"><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">iterator</span><span class="ct-53cb43">.</span><span class="ct-6faf40">next</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">3000</span><span class="ct-53cb43">))
</span></span><span class="line" line="19"><span class="ct-a7bb81">// 输出
</span></span><span class="line" line="20"><span>
</span></span><span class="line" line="21"><span class="ct-53cb43">{ </span><span class="ct-df1edd">value</span><span class="ct-53cb43">: </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43"> { </span><span class="ct-77fae4">&lt;</span><span class="ct-57f199">pending</span><span class="ct-77fae4">&gt;</span><span class="ct-53cb43"> }, done: false }
</span></span><span class="line" line="22"><span>
</span></span><span class="line" line="23"><span class="ct-57f199">{</span><span class="ct-53cb43"> </span><span class="ct-89b320">value</span><span class="ct-53cb43">: </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43"> { &lt;pending&gt; }, </span><span class="ct-89b320">done</span><span class="ct-53cb43">: </span><span class="ct-57f199">false</span><span class="ct-53cb43"> </span><span class="ct-57f199">}
</span></span><span class="line" line="24"><span>
</span></span><span class="line" line="25"><span class="ct-57f199">{</span><span class="ct-53cb43"> </span><span class="ct-89b320">value</span><span class="ct-53cb43">: </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43"> { &lt;pending&gt; }, </span><span class="ct-89b320">done</span><span class="ct-53cb43">: </span><span class="ct-57f199">false</span><span class="ct-53cb43"> </span><span class="ct-57f199">}
</span></span><span class="line" line="26"><span>
</span></span><span class="line" line="27"><span class="ct-53cb43">1000 2000 3000
</span></span><span class="line" line="28"><span>
</span></span><span class="line" line="29"><span class="ct-57f199">{</span><span class="ct-53cb43"> </span><span class="ct-89b320">value</span><span class="ct-53cb43">: </span><span class="ct-57f199">undefined</span><span class="ct-53cb43">, </span><span class="ct-89b320">done</span><span class="ct-53cb43">: </span><span class="ct-57f199">true</span><span class="ct-53cb43"> </span><span class="ct-57f199">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->可以看出每个 value 都是 Promise,并且通过手动传入参数到 next 就可以设置生成器内部的值,这里是手动传入,我只要写一个递归函数让其自动添进去就可以了<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">run</span><span class="ct-53cb43">(</span><span class="ct-89b320">createTime</span><span class="ct-53cb43">) {
</span></span><span class="line" line="2"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">iterator</span><span class="ct-53cb43"> = </span><span class="ct-6faf40">createTime</span><span class="ct-53cb43">();
</span></span><span class="line" line="3"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">result</span><span class="ct-53cb43"> = </span><span class="ct-89b320">iterator</span><span class="ct-53cb43">.</span><span class="ct-6faf40">next</span><span class="ct-53cb43">();
</span></span><span class="line" line="4"><span class="ct-53cb43">  </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">autoRun</span><span class="ct-53cb43">() {
</span></span><span class="line" line="5"><span class="ct-53cb43">    </span><span class="ct-17f2ac">if</span><span class="ct-53cb43"> (!</span><span class="ct-89b320">result</span><span class="ct-53cb43">.</span><span class="ct-89b320">done</span><span class="ct-53cb43">) {
</span></span><span class="line" line="6"><span class="ct-53cb43">      </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43">.</span><span class="ct-6faf40">resolve</span><span class="ct-53cb43">(</span><span class="ct-89b320">result</span><span class="ct-53cb43">.</span><span class="ct-89b320">value</span><span class="ct-53cb43">)
</span></span><span class="line" line="7"><span class="ct-53cb43">        .</span><span class="ct-6faf40">then</span><span class="ct-53cb43">((</span><span class="ct-89b320">time</span><span class="ct-53cb43">) </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="8"><span class="ct-53cb43">          </span><span class="ct-89b320">result</span><span class="ct-53cb43"> = </span><span class="ct-89b320">iterator</span><span class="ct-53cb43">.</span><span class="ct-6faf40">next</span><span class="ct-53cb43">(</span><span class="ct-89b320">time</span><span class="ct-53cb43">);
</span></span><span class="line" line="9"><span class="ct-53cb43">          </span><span class="ct-6faf40">autoRun</span><span class="ct-53cb43">();
</span></span><span class="line" line="10"><span class="ct-53cb43">        })
</span></span><span class="line" line="11"><span class="ct-53cb43">        .</span><span class="ct-6faf40">catch</span><span class="ct-53cb43">((</span><span class="ct-89b320">err</span><span class="ct-53cb43">) </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="12"><span class="ct-53cb43">          </span><span class="ct-89b320">result</span><span class="ct-53cb43"> = </span><span class="ct-89b320">iterator</span><span class="ct-53cb43">.</span><span class="ct-6faf40">throw</span><span class="ct-53cb43">(</span><span class="ct-89b320">err</span><span class="ct-53cb43">);
</span></span><span class="line" line="13"><span class="ct-53cb43">          </span><span class="ct-6faf40">autoRun</span><span class="ct-53cb43">();
</span></span><span class="line" line="14"><span class="ct-53cb43">        });
</span></span><span class="line" line="15"><span class="ct-53cb43">    }
</span></span><span class="line" line="16"><span class="ct-53cb43">  }
</span></span><span class="line" line="17"><span class="ct-53cb43">  </span><span class="ct-6faf40">autoRun</span><span class="ct-53cb43">();
</span></span><span class="line" line="18"><span class="ct-53cb43">}
</span></span><span class="line" line="19"><span class="ct-6faf40">run</span><span class="ct-53cb43">(</span><span class="ct-89b320">createTime</span><span class="ct-53cb43">);</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->promise.resove 保证返回的是一个 promise 对象 可迭代对象除了有 next 方法还有 throw 方法用于往生成器内部传入错误,只要生成内部能捕获该对象,生成器就可以继承运行,类似下面的代码<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-89b320">time</span><span class="ct-53cb43">) {
</span></span><span class="line" line="2"><span class="ct-53cb43">  </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-57f199">new</span><span class="ct-53cb43"> </span><span class="ct-c609fc">Promise</span><span class="ct-53cb43">((</span><span class="ct-89b320">resolve</span><span class="ct-53cb43">, </span><span class="ct-89b320">reject</span><span class="ct-53cb43">) </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="3"><span class="ct-53cb43">    </span><span class="ct-6faf40">setTimeout</span><span class="ct-53cb43">(() </span><span class="ct-57f199">=&gt;</span><span class="ct-53cb43"> {
</span></span><span class="line" line="4"><span class="ct-53cb43">      </span><span class="ct-17f2ac">if</span><span class="ct-53cb43"> (</span><span class="ct-89b320">time</span><span class="ct-53cb43"> == </span><span class="ct-cccbd6">2000</span><span class="ct-53cb43">) {
</span></span><span class="line" line="5"><span class="ct-53cb43">        </span><span class="ct-6faf40">reject</span><span class="ct-53cb43">(</span><span class="ct-7bec6a">&#39;2000错误&#39;</span><span class="ct-53cb43">);
</span></span><span class="line" line="6"><span class="ct-53cb43">      }
</span></span><span class="line" line="7"><span class="ct-53cb43">      </span><span class="ct-6faf40">resolve</span><span class="ct-53cb43">(</span><span class="ct-89b320">time</span><span class="ct-53cb43">);
</span></span><span class="line" line="8"><span class="ct-53cb43">    }, </span><span class="ct-89b320">time</span><span class="ct-53cb43">);
</span></span><span class="line" line="9"><span class="ct-53cb43">  });
</span></span><span class="line" line="10"><span class="ct-53cb43">}
</span></span><span class="line" line="11"><span class="ct-57f199">function*</span><span class="ct-53cb43"> </span><span class="ct-6faf40">createTime</span><span class="ct-53cb43">() {
</span></span><span class="line" line="12"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">time1</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">yield</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">1000</span><span class="ct-53cb43">);
</span></span><span class="line" line="13"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">time2</span><span class="ct-53cb43">;
</span></span><span class="line" line="14"><span class="ct-53cb43">  </span><span class="ct-17f2ac">try</span><span class="ct-53cb43"> {
</span></span><span class="line" line="15"><span class="ct-53cb43">    </span><span class="ct-89b320">time2</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">yield</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">2000</span><span class="ct-53cb43">);
</span></span><span class="line" line="16"><span class="ct-53cb43">  } </span><span class="ct-17f2ac">catch</span><span class="ct-53cb43"> (</span><span class="ct-89b320">error</span><span class="ct-53cb43">) {
</span></span><span class="line" line="17"><span class="ct-53cb43">    </span><span class="ct-89b320">time2</span><span class="ct-53cb43"> = </span><span class="ct-89b320">error</span><span class="ct-53cb43">;
</span></span><span class="line" line="18"><span class="ct-53cb43">  }
</span></span><span class="line" line="19"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">time3</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">yield</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">3000</span><span class="ct-53cb43">);
</span></span><span class="line" line="20"><span class="ct-53cb43">  </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">time1</span><span class="ct-53cb43">, </span><span class="ct-89b320">time2</span><span class="ct-53cb43">, </span><span class="ct-89b320">time3</span><span class="ct-53cb43">);
</span></span><span class="line" line="21"><span class="ct-53cb43">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->可以看出生成器函数其实和 async/await 语法长得很像,只要改一下 async/await 代码片段就是生成器函数了<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-57f199">async</span><span class="ct-53cb43"> </span><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">createTime</span><span class="ct-53cb43">() {
</span></span><span class="line" line="2"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">time1</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">1000</span><span class="ct-53cb43">);
</span></span><span class="line" line="3"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">time2</span><span class="ct-53cb43">;
</span></span><span class="line" line="4"><span class="ct-53cb43">  </span><span class="ct-17f2ac">try</span><span class="ct-53cb43"> {
</span></span><span class="line" line="5"><span class="ct-53cb43">    </span><span class="ct-89b320">time2</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">2000</span><span class="ct-53cb43">);
</span></span><span class="line" line="6"><span class="ct-53cb43">  } </span><span class="ct-17f2ac">catch</span><span class="ct-53cb43"> (</span><span class="ct-89b320">error</span><span class="ct-53cb43">) {
</span></span><span class="line" line="7"><span class="ct-53cb43">    </span><span class="ct-89b320">time2</span><span class="ct-53cb43"> = </span><span class="ct-89b320">error</span><span class="ct-53cb43">;
</span></span><span class="line" line="8"><span class="ct-53cb43">  }
</span></span><span class="line" line="9"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">time3</span><span class="ct-53cb43"> = </span><span class="ct-17f2ac">await</span><span class="ct-53cb43"> </span><span class="ct-6faf40">delay</span><span class="ct-53cb43">(</span><span class="ct-cccbd6">3000</span><span class="ct-53cb43">);
</span></span><span class="line" line="10"><span class="ct-53cb43">  </span><span class="ct-89b320">console</span><span class="ct-53cb43">.</span><span class="ct-6faf40">log</span><span class="ct-53cb43">(</span><span class="ct-89b320">time1</span><span class="ct-53cb43">, </span><span class="ct-89b320">time2</span><span class="ct-53cb43">, </span><span class="ct-89b320">time3</span><span class="ct-53cb43">);
</span></span><span class="line" line="11"><span class="ct-53cb43">}
</span></span><span class="line" line="12"><span>
</span></span><span class="line" line="13"><span class="ct-57f199">function</span><span class="ct-53cb43"> </span><span class="ct-6faf40">transform</span><span class="ct-53cb43">(</span><span class="ct-89b320">async</span><span class="ct-53cb43">) {
</span></span><span class="line" line="14"><span class="ct-53cb43">  </span><span class="ct-57f199">let</span><span class="ct-53cb43"> </span><span class="ct-89b320">str</span><span class="ct-53cb43"> = </span><span class="ct-89b320">async</span><span class="ct-53cb43">.</span><span class="ct-6faf40">toString</span><span class="ct-53cb43">();
</span></span><span class="line" line="15"><span class="ct-53cb43">  </span><span class="ct-89b320">str</span><span class="ct-53cb43"> = </span><span class="ct-89b320">str</span><span class="ct-53cb43">.</span><span class="ct-6faf40">replace</span><span class="ct-53cb43">(</span><span class="ct-96a10c">/async\s</span><span class="ct-5e105b">+</span><span class="ct-7bec6a">(</span><span class="ct-96a10c">function</span><span class="ct-7bec6a">)</span><span class="ct-96a10c">\s</span><span class="ct-5e105b">+</span><span class="ct-96a10c">/</span><span class="ct-53cb43">, </span><span class="ct-7bec6a">&#39;$1 *&#39;</span><span class="ct-53cb43">).</span><span class="ct-6faf40">replace</span><span class="ct-53cb43">(</span><span class="ct-96a10c">/await/</span><span class="ct-57f199">g</span><span class="ct-53cb43">, </span><span class="ct-7bec6a">&#39;yield&#39;</span><span class="ct-53cb43">);
</span></span><span class="line" line="16"><span class="ct-53cb43">  </span><span class="ct-17f2ac">return</span><span class="ct-53cb43"> </span><span class="ct-89b320">str</span><span class="ct-53cb43">;
</span></span><span class="line" line="17"><span class="ct-53cb43">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><style>.ct-5e105b{color:#D7BA7D}
.ct-96a10c{color:#D16969}
.ct-77fae4{color:#808080}
.ct-df1edd{color:#C8C8C8}
.ct-c609fc{color:#4EC9B0}
.ct-cccbd6{color:#B5CEA8}
.ct-17f2ac{color:#C586C0}
.ct-89b320{color:#9CDCFE}
.ct-a7bb81{color:#6A9955}
.ct-7bec6a{color:#CE9178}
.ct-6faf40{color:#DCDCAA}
.ct-7094fa{color:#4FC1FF}
.ct-53cb43{color:#D4D4D4}
.ct-57f199{color:#569CD6}</style></div><!--]--><nav class="nav" data-v-58a2f6cb><div class="nav-item nav-item-before" data-v-58a2f6cb><div class="dir-title" data-v-58a2f6cb>Css</div><a href="/blog/articles/css/csspropertyatrule" class="link" data-v-58a2f6cb><span style="transform:scale(-1, 1);" data-v-58a2f6cb></span><span class="title" data-v-58a2f6cb>纯 css 实现数字自增的动画效果</span></a></div><div class="nav-item nav-item-after" data-v-58a2f6cb><div class="dir-title" data-v-58a2f6cb>JavaScript</div><a href="/blog/articles/javascript/curryandasync" class="link" data-v-58a2f6cb><span class="title" data-v-58a2f6cb>柯里化在异步编程的应用</span><span data-v-58a2f6cb></span></a></div></nav></div></main><aside style="display:none;" class="aside article-outline"><div class="aside-stick right-aside"><span></span></div></aside></div><footer><div class="to-top" style="display:none;"><span></span></div></footer><div class="nuxt-loading-indicator" style="position:fixed;top:0;right:0;left:0;pointer-events:none;width:auto;height:3px;opacity:0;background:repeating-linear-gradient(to right,#00dc82 0%,#34cdfe 50%,#0047e1 100%);background-size:Infinity% auto;transform:scaleX(0%);transform-origin:left;transition:transform 0.1s, height 0.4s, opacity 0.4s;z-index:999999;"></div><!--]--></div><script>window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c_,c$,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm){return {data:{"search-navigation":[{title:bC,_path:bD,children:[{title:bE,_path:bF,children:[{title:bG,_path:bH},{title:bI,_path:bJ},{title:bK,_path:bL}]},{title:bM,_path:bN,children:[{title:bm,_path:bn},{title:bO,_path:bP},{title:bQ,_path:bR},{title:bS,_path:bT}]},{title:bU,_path:bV,children:[{title:bW,_path:bX}]}]},{title:bY,_path:bZ,children:[{title:b_,_path:b$,children:[{title:aW,_path:ca},{title:aX,_path:cb}]},{title:cc,_path:cd,children:[{title:aW,_path:ce},{title:aX,_path:cf}]}]},{title:cg,_path:bo},{title:bp,_path:ch},{title:ci,_path:cj,children:[{title:ck,_path:cl},{title:cm,_path:cn}]}],"content-navigation-8C37fagqQL":[{title:bC,_path:bD,children:[{title:bE,_path:bF,children:[{title:bG,_path:bH},{title:bI,_path:bJ},{title:bK,_path:bL}]},{title:bM,_path:bN,children:[{title:bm,_path:bn},{title:bO,_path:bP},{title:bQ,_path:bR},{title:bS,_path:bT}]},{title:bU,_path:bV,children:[{title:bW,_path:bX}]}]},{title:bY,_path:bZ,children:[{title:b_,_path:b$,children:[{title:aW,_path:ca},{title:aX,_path:cb}]},{title:cc,_path:cd,children:[{title:aW,_path:ce},{title:aX,_path:cf}]}]},{title:cg,_path:bo},{title:bp,_path:ch},{title:ci,_path:cj,children:[{title:ck,_path:cl},{title:cm,_path:cn}]}],"content-query-DFIETUu7RI":{_path:bn,_dir:"javascript",_draft:ap,_partial:ap,_locale:bq,_empty:ap,title:bm,description:C,body:{type:"root",children:[{type:a,tag:at,props:{id:aY},children:[{type:c,value:aY}]},{type:a,tag:w,props:{},children:[{type:c,value:"async\u002Fawait 语法用看起来像写同步代码的方式来优雅地处理异步操作,但是我们也要明白一点,异步操作本来带有复杂性,像写同步代码的方式并不能降低本质上的复杂性,所以在处理上我们要更加谨慎, 稍有不慎就可能写出不是预期执行的代码,从而影响执行效率。下面将简单地描述一下一些日常常用场景,加深对 async\u002Fawait 认识"}]},{type:a,tag:w,props:{},children:[{type:c,value:"最普遍的异步操作就是请求,我们也可以用 setTimeOut 来简单模拟异步请求。"}]},{type:a,tag:at,props:{id:co},children:[{type:c,value:cp}]},{type:a,tag:w,props:{},children:[{type:c,value:"相信这个场景是最常遇到,后一个请求依赖前一个请求,下面以爬取一个网页内的图片为例子进行描述,使用了 superagent 请求模块, cheerio 页面分析模块,图片的地址需要分析网页内容得出,所以必须按顺序进行请求。"}]},{type:a,tag:s,props:{code:"const request = require('superagent')\nconst cheerio = require('cheerio')\n\u002F\u002F 简单封装下请求,其他的类似\n\nfunction getHTML(url) {\n\u002F\u002F 一些操作,比如设置一下请求头信息\nreturn superagent.get(url).set('referer', referer).set('user-agent', userAgent)\n}\n\u002F\u002F 下面就请求一张图片\nasync function imageCrawler(url) {\n  let res = await getHTML(url)\n  let html = res.text\n  let $ = cheerio.load(html)\n  let $img = $(selector)[0]\n  let href = $img.attribs.src\n  res = await getImage(href)\n  retrun res.body\n}\nasync function handler(url) {\n  let img = await imageCrawler(url)\n  console.log(img) \u002F\u002F buffer 格式的数据\n  \u002F\u002F 处理图片\n}\nhandler(url)\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:cq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:cr},children:[{type:c,value:"request"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cs}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"'superagent'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:cq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:cr},children:[{type:c,value:ct}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cs}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"'cheerio'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:W},children:[{type:c,value:"\u002F\u002F 简单封装下请求,其他的类似\n"}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{},children:[{type:c,value:aq}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cu}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:W},children:[{type:c,value:"\u002F\u002F 一些操作,比如设置一下请求头信息\n"}]}]},{type:a,tag:b,props:{class:e,line:Y},children:[{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"superagent"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"get"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aZ}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cv}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"'referer'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"referer"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aZ}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cv}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"'user-agent'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"userAgent"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:ad},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:W},children:[{type:c,value:"\u002F\u002F 下面就请求一张图片\n"}]}]},{type:a,tag:b,props:{class:e,line:af},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:a_}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cu}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:ah},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:a_}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"text\n"}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cx}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ct}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"load"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cy}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cx}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"selector"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:")["}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aM}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"]\n"}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cz}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cy}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"attribs"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"src\n"}]}]},{type:a,tag:b,props:{class:e,line:al},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:a_}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:au}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cz}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:av},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"retrun"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:a_}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"body\n"}]}]},{type:a,tag:b,props:{class:e,line:aD},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:a$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:ba},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:W},children:[{type:c,value:"\u002F\u002F buffer 格式的数据\n"}]}]},{type:a,tag:b,props:{class:e,line:br},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:W},children:[{type:c,value:"\u002F\u002F 处理图片\n"}]}]},{type:a,tag:b,props:{class:e,line:bs},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:bt},children:[{type:a,tag:b,props:{class:h},children:[{type:c,value:cA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cB}]}]}]}]}]},{type:a,tag:w,props:{},children:[{type:c,value:"上面就是一个简单的获取图片数据的场景,图片数据是加载进内存中,如果只是简单的存储数据,可以用流的形式进行存储,以防止消耗太多内存。"}]},{type:a,tag:w,props:{},children:[{type:c,value:"其中 await getHTML 是必须的,如果省略了 await 程序就不能按预期得到结果。执行流程会先执行 await 后面的表达式,其实际返回的是一个处于 pending 状态的 promise,等到这个 promise 处于已决议状态后才会执行 await 后面的操作,其中的代码执行会跳出 async 函数,继续执行函数外面的其他代码,所以并不会阻塞后续代码的执行。"}]},{type:a,tag:at,props:{id:cC},children:[{type:c,value:cD}]},{type:a,tag:w,props:{},children:[{type:c,value:"有的时候我们并不需要等待一个请求回来才发出另一个请求,这样效率是很低的,所以这个时候就需要并发执行请求任务。下面以一个查询为例,先获取一个人的学校地址和家庭住址,再由这些信息获取详细的个人信息,学校地址和家庭住址是没有依赖关系的,后面的获取个人信息依赖于两者"}]},{type:a,tag:s,props:{code:"async function infoCrawler(url, name) {\n  let [schoolAdr, homeAdr] = await Promise.all([getSchoolAdr(name), getHomeAdr(name)]);\n  let info = await getInfo(url + `?schoolAdr=${schoolAdr}&homeAdr=${homeAdr}`);\n  return info;\n}\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"infoCrawler"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" ["}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cE}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"] = "}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cH}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"getSchoolAdr"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cI}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"getHomeAdr"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cJ}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"getInfo"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" + "}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"`?schoolAdr="}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:cL}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cE}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:_}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"&homeAdr="}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:cL}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cF}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:_}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"`"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:_}]}]}]}]}]},{type:a,tag:w,props:{},children:[{type:c,value:"上面使用的 Promise.all 里面的异步请求都会并发执行,并等到数据都准备后返回相应的按数据顺序返回的数组,这里最后处理获取信息的时间,由并发请求中最慢的请求决定,例如 getSchoolAdr 迟迟不返回数据,那么后续操作只能等待,就算 getHomeAdr 已经提前返回了,当然以上场景必须是这么做,但是有的时候我们并不需要这么做。"}]},{type:a,tag:w,props:{},children:[{type:c,value:"上面第一个场景中,我们只获取到一张图片,但是可能一个网页中不止一张图片,如果我们要把这些图片存储起来,其实是没有必要等待图片都并发请求回来后再处理,哪张图片早回来就存储哪张就行了"}]},{type:a,tag:s,props:{code:"let imageUrls = ['href1', 'href2', 'href3'];\nasync function saveImages(imageUrls) {\n  await Promise.all(\n    imageUrls.map(async (imageUrl) =\u003E {\n      let img = await getImage(imageUrl);\n      return await saveImage(img);\n    })\n  );\n  console.log('done');\n}\n\u002F\u002F 如果我们连存储是否全部完成也不关心,也可以这么写\nlet imageUrls = ['href1', 'href2', 'href3'];\n\u002F\u002F saveImages() 连 async 都省了\nfunction saveImages(imageUrls) {\n  imageUrls.forEach(async (imageUrl) =\u003E {\n    let img = await getImage(imageUrl);\n    saveImage(img);\n  });\n}\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cM}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:cN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:cO}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:cP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cQ}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cR}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"(\n"}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"map"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bb}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:au}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bb}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:Y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"    })\n"}]}]},{type:a,tag:b,props:{class:e,line:ad},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"  );\n"}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:bv}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:af},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:W},children:[{type:c,value:"\u002F\u002F 如果我们连存储是否全部完成也不关心,也可以这么写\n"}]}]},{type:a,tag:b,props:{class:e,line:ah},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cM}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:cN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:cO}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:cP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cQ}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:W},children:[{type:c,value:"\u002F\u002F saveImages() 连 async 都省了\n"}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cR}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"forEach"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bb}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:al},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:au}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bb}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:av},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:aD},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bc}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:_}]}]}]}]}]},{type:a,tag:w,props:{},children:[{type:c,value:"可能有人会疑问 forEach 不是不能用于异步吗,这个说法我也在刚接触这个语法的时候就听说过,很明显 forEach 是可以处理异步的,只是是并发处理,map 也是并发处理,这个怎么用主要看你的实际场景,还要看你是否对结果感兴趣"}]},{type:a,tag:at,props:{id:cT},children:[{type:c,value:cU}]},{type:a,tag:w,props:{},children:[{type:c,value:"一个请求发出,可以会遇到各种问题,我们是无法保证一定成功的,报错是常有的事,所以处理错误有时很有必要, async\u002Fawait 处理错误也非常直观, 使用 try\u002Fcatch 直接捕获就可以了"}]},{type:a,tag:s,props:{code:"async function imageCrawler(url) {\n  try {\n    let img = await getImage(url);\n    return img;\n  } catch (error) {\n    console.log(error);\n  }\n}\n\u002F\u002F imageCrawler 返回的是一个 promise 可以这样处理\nasync function imageCrawler(url) {\n  let img = await getImage(url);\n  return img;\n}\nimageCrawler(url).catch((err) =\u003E {\n  console.log(err);\n});\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:au}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aO}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:Y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]}]},{type:a,tag:b,props:{class:e,line:ad},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:W},children:[{type:c,value:"\u002F\u002F imageCrawler 返回的是一个 promise 可以这样处理\n"}]}]},{type:a,tag:b,props:{class:e,line:af},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:au}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ah},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:h},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aZ}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bd}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bd}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:al},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"});"}]}]}]}]}]},{type:a,tag:w,props:{},children:[{type:c,value:"可能有人会有疑问,是不是要在每个请求中都 try\u002Fcatch 一下,这个其实你在最外层 catch 一下就可以了,一些基于中间件的设计就喜欢在最外层捕获错误"}]},{type:a,tag:s,props:{code:"async function ctx(next) {\n  try {\n    await next();\n  } catch (error) {\n    console.log(error);\n  }\n}\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"ctx"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ab}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aO}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]}]},{type:a,tag:b,props:{class:e,line:Y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:_}]}]}]}]}]},{type:a,tag:at,props:{id:cV},children:[{type:c,value:cW}]},{type:a,tag:w,props:{},children:[{type:c,value:"一个请求发出,我们是无法确定什么时候返回的,也总不能一直傻傻的等,设置超时处理有时是很有必要的"}]},{type:a,tag:s,props:{code:"function timeOut(delay) {\n  return new Promise((resolve, reject) =\u003E {\n    setTimeout(() =\u003E {\n      reject(new Error('不用等了,别傻了'));\n    }, delay);\n  });\n}\n\nasync function imageCrawler(url, delay) {\n  try {\n    let img = await Promise.race([getImage(url), timeOut(delay)]);\n    return img;\n  } catch (error) {\n    console.log(error);\n  }\n}\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cX}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:bw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bx}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"Error"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"'不用等了,别傻了'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"));\n"}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:by}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bc}]}]},{type:a,tag:b,props:{class:e,line:Y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:ad},children:[{type:a,tag:b,props:{},children:[{type:c,value:aq}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:af},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"race"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cH}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:au}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cI}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:cX}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cJ}]}]},{type:a,tag:b,props:{class:e,line:ah},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aO}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]}]},{type:a,tag:b,props:{class:e,line:al},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:_}]}]}]}]}]},{type:a,tag:w,props:{},children:[{type:c,value:"这里使用 Promise.race 处理超时,要注意的是,如果超时了,请求还是没有终止的,只是不再进行后续处理。当然也不用担心,后续处理会报错而导致重新处理出错信息, 因为 promise 的状态一经改变是不会再改变的"}]},{type:a,tag:at,props:{id:cY},children:[{type:c,value:cZ}]},{type:a,tag:w,props:{},children:[{type:c,value:"在并发请求的场景中,如果需要大量并发,必须要进行并发限制,不然会被网站屏蔽或者造成进程崩溃"}]},{type:a,tag:s,props:{code:"async function getImages(urls, limit) {\n  let running = 0;\n  let r;\n  let p = new Promise((resolve, reject) =\u003E {\n    r = resolve;\n  });\n  function run() {\n    if (running \u003C limit && urls.length \u003E 0) {\n      running++;\n      let url = urls.shift();\n      (async () =\u003E {\n        let img = await getImage(url);\n        running--;\n        console.log(img);\n        if (urls.length === 0 && running === 0) {\n          console.log('done');\n          return r('done');\n        } else {\n          run();\n        }\n      })();\n      run(); \u002F\u002F 立即到并发上限\n    }\n  }\n  run();\n  return await p;\n}\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"getImages"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:be}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:c_}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aM}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bz}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bz}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bc}]}]},{type:a,tag:b,props:{class:e,line:Y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]}]},{type:a,tag:b,props:{class:e,line:ad},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" \u003C "}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:c_}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:c$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:be}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:da}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" \u003E "}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aM}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"++;\n"}]}]},{type:a,tag:b,props:{class:e,line:af},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:be}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"shift"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ab}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"      ("}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" () "}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:ah},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:au}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"--;\n"}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:K}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:be}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:da}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:db}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aM}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:c$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:db}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aM}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:al},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:bv}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:av},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:bz}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:bv}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:aD},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"        } "}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:"else"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ab}]}]},{type:a,tag:b,props:{class:e,line:a$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"        }\n"}]}]},{type:a,tag:b,props:{class:e,line:ba},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"      })();\n"}]}]},{type:a,tag:b,props:{class:e,line:br},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"(); "}]},{type:a,tag:b,props:{class:W},children:[{type:c,value:"\u002F\u002F 立即到并发上限\n"}]}]},{type:a,tag:b,props:{class:e,line:bs},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dc}]}]},{type:a,tag:b,props:{class:e,line:bt},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]}]},{type:a,tag:b,props:{class:e,line:dd},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ab}]}]},{type:a,tag:b,props:{class:e,line:de},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:df},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:_}]}]}]}]}]},{type:a,tag:at,props:{id:bg},children:[{type:c,value:bg}]},{type:a,tag:w,props:{},children:[{type:c,value:"以上列举了一些日常场景处理的代码片段,在遇到比较复杂场景时,可以结合以上的场景进行组合使用,如果场景过于复杂,最好的办法是使用相关的异步代码控制库。如果想更好地了解 async\u002Fawait 可以先去了解 promise 和 generator, async\u002Fawait 基本上是 generator 函数的语法糖,下面简单的描述了一下内部的原理。"}]},{type:a,tag:s,props:{code:"function delay(time) {\n  return new Promise((resolve, reject) =\u003E {\n    setTimeout(() =\u003E {\n        resolve(time)\n    }, time)\n  })\n}\nfunction *createTime() {\n  let time1 = yield delay(1000)\n  let time2 = yield delay(2000)\n  let time3 = yield delay(3000)\n  console.log(time1, time2, time3)\n}\nlet iterator = createTime()\nconsole.log(iterator.next())\nconsole.log(iterator.next(1000))\nconsole.log(iterator.next(2000))\nconsole.log(iterator.next(3000))\n\u002F\u002F 输出\n\n{ value: Promise { \u003Cpending\u003E }, done: false }\n\n{ value: Promise { \u003Cpending\u003E }, done: false }\n\n{ value: Promise { \u003Cpending\u003E }, done: false }\n\n1000 2000 3000\n\n{ value: undefined, done: true }\n\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:bw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bx}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:by}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"  })\n"}]}]},{type:a,tag:b,props:{class:e,line:Y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:ad},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:"*"}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:af},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bi}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:ah},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"()\n"}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:"())\n"}]}]},{type:a,tag:b,props:{class:e,line:al},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bA}]}]},{type:a,tag:b,props:{class:e,line:av},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bA}]}]},{type:a,tag:b,props:{class:e,line:aD},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bi}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bA}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:W},children:[{type:c,value:"\u002F\u002F 输出\n"}]}]},{type:a,tag:b,props:{class:e,line:a$},children:[{type:a,tag:b,props:{},children:[{type:c,value:aq}]}]},{type:a,tag:b,props:{class:e,line:ba},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"{ "}]},{type:a,tag:b,props:{class:"ct-df1edd"},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" { "}]},{type:a,tag:b,props:{class:dg},children:[{type:c,value:"\u003C"}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:"pending"}]},{type:a,tag:b,props:{class:dg},children:[{type:c,value:"\u003E"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" }, done: false }\n"}]}]},{type:a,tag:b,props:{class:e,line:br},children:[{type:a,tag:b,props:{},children:[{type:c,value:aq}]}]},{type:a,tag:b,props:{class:e,line:bs},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:bB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dh}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bj}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:di}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:bt},children:[{type:a,tag:b,props:{},children:[{type:c,value:aq}]}]},{type:a,tag:b,props:{class:e,line:dd},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:bB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dh}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bj}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:di}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:de},children:[{type:a,tag:b,props:{},children:[{type:c,value:aq}]}]},{type:a,tag:b,props:{class:e,line:df},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"1000 2000 3000\n"}]}]},{type:a,tag:b,props:{class:e,line:28},children:[{type:a,tag:b,props:{},children:[{type:c,value:aq}]}]},{type:a,tag:b,props:{class:e,line:29},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:bB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:"undefined"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bj}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:"true"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:_}]}]}]}]}]},{type:a,tag:w,props:{},children:[{type:c,value:"可以看出每个 value 都是 Promise,并且通过手动传入参数到 next 就可以设置生成器内部的值,这里是手动传入,我只要写一个递归函数让其自动添进去就可以了"}]},{type:a,tag:s,props:{code:"function run(createTime) {\n  let iterator = createTime();\n  let result = iterator.next();\n  function autoRun() {\n    if (!result.done) {\n      Promise.resolve(result.value)\n        .then((time) =\u003E {\n          result = iterator.next(time);\n          autoRun();\n        })\n        .catch((err) =\u003E {\n          result = iterator.throw(err);\n          autoRun();\n        });\n    }\n  }\n  autoRun();\n}\nrun(createTime);\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ab}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aU}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ab}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:bk}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" (!"}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aU}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bj}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aU}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:I}]}]},{type:a,tag:b,props:{class:e,line:Y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dj}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"then"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:ad},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aU}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:ar}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:bk}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ab}]}]},{type:a,tag:b,props:{class:e,line:af},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"        })\n"}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dj}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bd}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:ah},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aU}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ao}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"throw"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bd}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:bk}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ab}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"        });\n"}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dc}]}]},{type:a,tag:b,props:{class:e,line:al},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]}]},{type:a,tag:b,props:{class:e,line:av},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:bk}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ab}]}]},{type:a,tag:b,props:{class:e,line:aD},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:h},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:");"}]}]}]}]}]},{type:a,tag:w,props:{},children:[{type:c,value:"promise.resove 保证返回的是一个 promise 对象 可迭代对象除了有 next 方法还有 throw 方法用于往生成器内部传入错误,只要生成内部能捕获该对象,生成器就可以继承运行,类似下面的代码"}]},{type:a,tag:s,props:{code:"function delay(time) {\n  return new Promise((resolve, reject) =\u003E {\n    setTimeout(() =\u003E {\n      if (time == 2000) {\n        reject('2000错误');\n      }\n      resolve(time);\n    }, time);\n  });\n}\nfunction* createTime() {\n  let time1 = yield delay(1000);\n  let time2;\n  try {\n    time2 = yield delay(2000);\n  } catch (error) {\n    time2 = error;\n  }\n  let time3 = yield delay(3000);\n  console.log(time1, time2, time3);\n}\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ay}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:bw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bx}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" == "}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"'2000错误'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"      }\n"}]}]},{type:a,tag:b,props:{class:e,line:Y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ad},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:by}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:an}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bc}]}]},{type:a,tag:b,props:{class:e,line:af},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:"function*"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]}]},{type:a,tag:b,props:{class:e,line:ah},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:al},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aO}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:av},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:aD},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]}]},{type:a,tag:b,props:{class:e,line:aE},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bi}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:a$},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ba},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:_}]}]}]}]}]},{type:a,tag:w,props:{},children:[{type:c,value:"可以看出生成器函数其实和 async\u002Fawait 语法长得很像,只要改一下 async\u002Fawait 代码片段就是生成器函数了"}]},{type:a,tag:s,props:{code:"async function createTime() {\n  let time1 = await delay(1000);\n  let time2;\n  try {\n    time2 = await delay(2000);\n  } catch (error) {\n    time2 = error;\n  }\n  let time3 = await delay(3000);\n  console.log(time1, time2, time3);\n}\n\nfunction transform(async) {\n  let str = async.toString();\n  str = str.replace(\u002Fasync\\s+(function)\\s+\u002F, '$1 *').replace(\u002Fawait\u002Fg, 'yield');\n  return str;\n}\n",language:Q,meta:H},children:[{type:a,tag:R,props:{},children:[{type:a,tag:s,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:N},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:aA}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:S},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:O},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:y}]}]},{type:a,tag:b,props:{class:e,line:T},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aO}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:aw}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:Y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:v}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:ad},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:ax}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:G}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bi}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:af},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:E}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:F}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ac}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:J}]}]},{type:a,tag:b,props:{class:e,line:ah},children:[{type:a,tag:b,props:{},children:[{type:c,value:aq}]}]},{type:a,tag:b,props:{class:e,line:ai},children:[{type:a,tag:b,props:{class:i},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"transform"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]}]},{type:a,tag:b,props:{class:e,line:aj},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:o}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:"toString"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ab}]}]},{type:a,tag:b,props:{class:e,line:ak},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:n}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:m}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:dk}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:aV},children:[{type:c,value:"\u002Fasync\\s"}]},{type:a,tag:b,props:{class:dl},children:[{type:c,value:dm}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:aV},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:cB}]},{type:a,tag:b,props:{class:aV},children:[{type:c,value:"\\s"}]},{type:a,tag:b,props:{class:dl},children:[{type:c,value:dm}]},{type:a,tag:b,props:{class:aV},children:[{type:c,value:bo}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"'$1 *'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aZ}]},{type:a,tag:b,props:{class:h},children:[{type:c,value:dk}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:aV},children:[{type:c,value:"\u002Fawait\u002F"}]},{type:a,tag:b,props:{class:i},children:[{type:c,value:"g"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:r}]},{type:a,tag:b,props:{class:t},children:[{type:c,value:"'yield'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:p}]}]},{type:a,tag:b,props:{class:e,line:al},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:k}]},{type:a,tag:b,props:{class:l},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:g}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:L}]}]},{type:a,tag:b,props:{class:e,line:av},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:_}]}]}]}]}]},{type:a,tag:"style",children:[{type:c,value:".ct-5e105b{color:#D7BA7D}\n.ct-96a10c{color:#D16969}\n.ct-77fae4{color:#808080}\n.ct-df1edd{color:#C8C8C8}\n.ct-c609fc{color:#4EC9B0}\n.ct-cccbd6{color:#B5CEA8}\n.ct-17f2ac{color:#C586C0}\n.ct-89b320{color:#9CDCFE}\n.ct-a7bb81{color:#6A9955}\n.ct-7bec6a{color:#CE9178}\n.ct-6faf40{color:#DCDCAA}\n.ct-7094fa{color:#4FC1FF}\n.ct-53cb43{color:#D4D4D4}\n.ct-57f199{color:#569CD6}"}]}],toc:{title:C,searchDepth:x,depth:x,links:[{id:aY,depth:x,text:aY},{id:co,depth:x,text:cp},{id:cC,depth:x,text:cD},{id:cT,depth:x,text:cU},{id:cV,depth:x,text:cW},{id:cY,depth:x,text:cZ},{id:bg,depth:x,text:bg}]}},_type:bp,_id:"content:articles:javaScript:AsyncAwaitScene.md",_source:"content",_file:"articles\u002FjavaScript\u002FAsyncAwaitScene.md",_extension:"md"}},state:{},_errors:{"search-navigation":H,"content-navigation-8C37fagqQL":H,"content-query-DFIETUu7RI":H},serverRendered:true,prerenderedAt:1691747260550,config:{public:{content:{locales:[bq],defaultLocale:bq,integrity:1691746920731,experimental:{stripQueryParameters:ap,clientDB:ap,advancedIgnoresPattern:ap},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{theme:"dark-plus"},wsUrl:C,documentDriven:ap,host:C,trailingSlash:ap,anchorLinks:{depth:O,exclude:[N]}}},app:{baseURL:"\u002Fblog\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:C}}}}("element","span","text","ct-53cb43","line","ct-89b320"," ","ct-6faf40","ct-57f199","(","  ","ct-17f2ac","."," = ","let",");\n",") {\n",", ","code","ct-7bec6a","function","    ","p",2," {\n","url","await","ct-cccbd6","","async","console","log","delay",null,")\n","}\n","img",";\n","=\u003E",1,4,"return","js","pre",3,5,"ct-c609fc","Promise","ct-a7bb81",6,7,") ","}"," (","error","();\n","time2",8,9,10,11,12,13,14,15,16,"      ","time","iterator",false,"\n","next","resolve","h2","getImage",17,"catch","  }\n","((","          ","createTime",": ","imageCrawler",18,19,"imageUrls","reject","run","        ","time1","yield","time3","0","try","  } ","new","running","() {\n","2000","value","result","ct-96a10c","安装","使用说明","前言",").","res",20,21,"imageUrl","  });\n","err","urls","if","总结","1000","3000","done","autoRun","str","async\u002Fawait 异步应用的常用场景","\u002Farticles\u002Fjavascript\u002Fasyncawaitscene","\u002F","markdown","zh-Hans",22,23,24,"name","'done'","setTimeout","(() ","    }, ","r","))\n","{","文章","\u002Farticles","Css","\u002Farticles\u002Fcss","BFC,层叠上下文,级联层","\u002Farticles\u002Fcss\u002Fbfcstackcascading","css 各种居中方法总结","\u002Farticles\u002Fcss\u002Fcsscenter","纯 css 实现数字自增的动画效果","\u002Farticles\u002Fcss\u002Fcsspropertyatrule","JavaScript","\u002Farticles\u002Fjavascript","柯里化在异步编程的应用","\u002Farticles\u002Fjavascript\u002Fcurryandasync","js 浮点数存储精度丢失原理","\u002Farticles\u002Fjavascript\u002Ffloatingpointlossprecision","es6 深入理解 Proxy 和 Reflect 这对影子兄弟","\u002Farticles\u002Fjavascript\u002Fproxyandreflect","移动端","\u002Farticles\u002Fmobile","真的，移动端尺寸自适应与 dpr 无关","\u002Farticles\u002Fmobile\u002Fselfadaptiveanddpr","浏览器插件","\u002Fbrowser_plugins","修改网页信息","\u002Fbrowser_plugins\u002Fmodifyingwebdata","\u002Fbrowser_plugins\u002Fmodifyingwebdata\u002Finstall","\u002Fbrowser_plugins\u002Fmodifyingwebdata\u002Freadme","通用文字识别","\u002Fbrowser_plugins\u002Funiversaltextrecognition","\u002Fbrowser_plugins\u002Funiversaltextrecognition\u002Finstall","\u002Fbrowser_plugins\u002Funiversaltextrecognition\u002Freadme","首页","\u002Ftest","工具","\u002Ftools","抖音评论爬取","\u002Ftools\u002Fdouyin","unicode 字符查询","\u002Ftools\u002Funicodesearch","场景-1-一个请求接着一个请求","场景 1. 一个请求接着一个请求","const","ct-7094fa","require","cheerio","getHTML","set","html","$","$img","href","handler",")","场景-2并发请求","场景 2.并发请求","schoolAdr","homeAdr","all","([","), ",")]);\n","info","${"," = [","'href1'","'href2'","'href3'","];\n","saveImages","saveImage","场景-3错误处理","场景 3.错误处理","场景-4-超时处理","场景 4. 超时处理","timeOut","场景-5-并发限制","场景 5. 并发限制","limit"," && ","length"," === ","    }\n",25,26,27,"ct-77fae4"," { \u003Cpending\u003E }, ","false","        .","replace","ct-5e105b","+"))</script><script type="module" src="/blog/_nuxt/entry.c460ab73.js" crossorigin></script></body>
</html>