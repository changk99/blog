{"_path":"/articles/javascript/asyncawaitscene","_dir":"javascript","_draft":false,"_partial":false,"_locale":"zh-Hans","_empty":false,"title":"async/await 异步应用的常用场景","description":"","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"前言"},"children":[{"type":"text","value":"前言"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"async/await 语法用看起来像写同步代码的方式来优雅地处理异步操作,但是我们也要明白一点,异步操作本来带有复杂性,像写同步代码的方式并不能降低本质上的复杂性,所以在处理上我们要更加谨慎, 稍有不慎就可能写出不是预期执行的代码,从而影响执行效率。下面将简单地描述一下一些日常常用场景,加深对 async/await 认识"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最普遍的异步操作就是请求,我们也可以用 setTimeOut 来简单模拟异步请求。"}]},{"type":"element","tag":"h2","props":{"id":"场景-1-一个请求接着一个请求"},"children":[{"type":"text","value":"场景 1. 一个请求接着一个请求"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"相信这个场景是最常遇到,后一个请求依赖前一个请求,下面以爬取一个网页内的图片为例子进行描述,使用了 superagent 请求模块, cheerio 页面分析模块,图片的地址需要分析网页内容得出,所以必须按顺序进行请求。"}]},{"type":"element","tag":"code","props":{"code":"const request = require('superagent')\nconst cheerio = require('cheerio')\n// 简单封装下请求,其他的类似\n\nfunction getHTML(url) {\n// 一些操作,比如设置一下请求头信息\nreturn superagent.get(url).set('referer', referer).set('user-agent', userAgent)\n}\n// 下面就请求一张图片\nasync function imageCrawler(url) {\n  let res = await getHTML(url)\n  let html = res.text\n  let $ = cheerio.load(html)\n  let $img = $(selector)[0]\n  let href = $img.attribs.src\n  res = await getImage(href)\n  retrun res.body\n}\nasync function handler(url) {\n  let img = await imageCrawler(url)\n  console.log(img) // buffer 格式的数据\n  // 处理图片\n}\nhandler(url)\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a61c82"},"children":[{"type":"text","value":"request"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"require"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'superagent'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a61c82"},"children":[{"type":"text","value":"cheerio"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"require"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'cheerio'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-92e1e6"},"children":[{"type":"text","value":"// 简单封装下请求,其他的类似\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getHTML"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-92e1e6"},"children":[{"type":"text","value":"// 一些操作,比如设置一下请求头信息\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"superagent"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'referer'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"referer"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'user-agent'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"userAgent"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-92e1e6"},"children":[{"type":"text","value":"// 下面就请求一张图片\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"imageCrawler"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"res"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getHTML"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"html"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"res"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"text\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"cheerio"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"load"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"html"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"$img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"selector"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")["}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"href"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"$img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"attribs"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"src\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"res"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getImage"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"href"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"retrun"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"res"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"body\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"handler"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"imageCrawler"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-92e1e6"},"children":[{"type":"text","value":"// buffer 格式的数据\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-92e1e6"},"children":[{"type":"text","value":"// 处理图片\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"handler"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上面就是一个简单的获取图片数据的场景,图片数据是加载进内存中,如果只是简单的存储数据,可以用流的形式进行存储,以防止消耗太多内存。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"其中 await getHTML 是必须的,如果省略了 await 程序就不能按预期得到结果。执行流程会先执行 await 后面的表达式,其实际返回的是一个处于 pending 状态的 promise,等到这个 promise 处于已决议状态后才会执行 await 后面的操作,其中的代码执行会跳出 async 函数,继续执行函数外面的其他代码,所以并不会阻塞后续代码的执行。"}]},{"type":"element","tag":"h2","props":{"id":"场景-2并发请求"},"children":[{"type":"text","value":"场景 2.并发请求"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"有的时候我们并不需要等待一个请求回来才发出另一个请求,这样效率是很低的,所以这个时候就需要并发执行请求任务。下面以一个查询为例,先获取一个人的学校地址和家庭住址,再由这些信息获取详细的个人信息,学校地址和家庭住址是没有依赖关系的,后面的获取个人信息依赖于两者"}]},{"type":"element","tag":"code","props":{"code":"async function infoCrawler(url, name) {\n  let [schoolAdr, homeAdr] = await Promise.all([getSchoolAdr(name), getHomeAdr(name)]);\n  let info = await getInfo(url + `?schoolAdr=${schoolAdr}&homeAdr=${homeAdr}`);\n  return info;\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"infoCrawler"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"schoolAdr"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"homeAdr"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"] = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"all"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(["}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getSchoolAdr"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"), "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getHomeAdr"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")]);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"info"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getInfo"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" + "}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"`?schoolAdr="}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"${"}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"schoolAdr"}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"&homeAdr="}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"${"}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"homeAdr"}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"`"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"info"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上面使用的 Promise.all 里面的异步请求都会并发执行,并等到数据都准备后返回相应的按数据顺序返回的数组,这里最后处理获取信息的时间,由并发请求中最慢的请求决定,例如 getSchoolAdr 迟迟不返回数据,那么后续操作只能等待,就算 getHomeAdr 已经提前返回了,当然以上场景必须是这么做,但是有的时候我们并不需要这么做。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上面第一个场景中,我们只获取到一张图片,但是可能一个网页中不止一张图片,如果我们要把这些图片存储起来,其实是没有必要等待图片都并发请求回来后再处理,哪张图片早回来就存储哪张就行了"}]},{"type":"element","tag":"code","props":{"code":"let imageUrls = ['href1', 'href2', 'href3'];\nasync function saveImages(imageUrls) {\n  await Promise.all(\n    imageUrls.map(async (imageUrl) => {\n      let img = await getImage(imageUrl);\n      return await saveImage(img);\n    })\n  );\n  console.log('done');\n}\n// 如果我们连存储是否全部完成也不关心,也可以这么写\nlet imageUrls = ['href1', 'href2', 'href3'];\n// saveImages() 连 async 都省了\nfunction saveImages(imageUrls) {\n  imageUrls.forEach(async (imageUrl) => {\n    let img = await getImage(imageUrl);\n    saveImage(img);\n  });\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"imageUrls"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = ["}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'href1'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'href2'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'href3'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"];\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"saveImages"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"imageUrls"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"all"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"imageUrls"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"map"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"imageUrl"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getImage"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"imageUrl"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"saveImage"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  );\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'done'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-92e1e6"},"children":[{"type":"text","value":"// 如果我们连存储是否全部完成也不关心,也可以这么写\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"imageUrls"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = ["}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'href1'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'href2'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'href3'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"];\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-92e1e6"},"children":[{"type":"text","value":"// saveImages() 连 async 都省了\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"saveImages"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"imageUrls"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"imageUrls"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"forEach"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"imageUrl"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getImage"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"imageUrl"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"saveImage"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可能有人会疑问 forEach 不是不能用于异步吗,这个说法我也在刚接触这个语法的时候就听说过,很明显 forEach 是可以处理异步的,只是是并发处理,map 也是并发处理,这个怎么用主要看你的实际场景,还要看你是否对结果感兴趣"}]},{"type":"element","tag":"h2","props":{"id":"场景-3错误处理"},"children":[{"type":"text","value":"场景 3.错误处理"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一个请求发出,可以会遇到各种问题,我们是无法保证一定成功的,报错是常有的事,所以处理错误有时很有必要, async/await 处理错误也非常直观, 使用 try/catch 直接捕获就可以了"}]},{"type":"element","tag":"code","props":{"code":"async function imageCrawler(url) {\n  try {\n    let img = await getImage(url);\n    return img;\n  } catch (error) {\n    console.log(error);\n  }\n}\n// imageCrawler 返回的是一个 promise 可以这样处理\nasync function imageCrawler(url) {\n  let img = await getImage(url);\n  return img;\n}\nimageCrawler(url).catch((err) => {\n  console.log(err);\n});\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"imageCrawler"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getImage"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-92e1e6"},"children":[{"type":"text","value":"// imageCrawler 返回的是一个 promise 可以这样处理\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"imageCrawler"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getImage"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"imageCrawler"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"});"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可能有人会有疑问,是不是要在每个请求中都 try/catch 一下,这个其实你在最外层 catch 一下就可以了,一些基于中间件的设计就喜欢在最外层捕获错误"}]},{"type":"element","tag":"code","props":{"code":"async function ctx(next) {\n  try {\n    await next();\n  } catch (error) {\n    console.log(error);\n  }\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"ctx"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"场景-4-超时处理"},"children":[{"type":"text","value":"场景 4. 超时处理"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一个请求发出,我们是无法确定什么时候返回的,也总不能一直傻傻的等,设置超时处理有时是很有必要的"}]},{"type":"element","tag":"code","props":{"code":"function timeOut(delay) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      reject(new Error('不用等了,别傻了'));\n    }, delay);\n  });\n}\n\nasync function imageCrawler(url, delay) {\n  try {\n    let img = await Promise.race([getImage(url), timeOut(delay)]);\n    return img;\n  } catch (error) {\n    console.log(error);\n  }\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"timeOut"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"reject"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"reject"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"Error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'不用等了,别傻了'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    }, "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"imageCrawler"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"race"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(["}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getImage"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"), "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"timeOut"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")]);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这里使用 Promise.race 处理超时,要注意的是,如果超时了,请求还是没有终止的,只是不再进行后续处理。当然也不用担心,后续处理会报错而导致重新处理出错信息, 因为 promise 的状态一经改变是不会再改变的"}]},{"type":"element","tag":"h2","props":{"id":"场景-5-并发限制"},"children":[{"type":"text","value":"场景 5. 并发限制"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在并发请求的场景中,如果需要大量并发,必须要进行并发限制,不然会被网站屏蔽或者造成进程崩溃"}]},{"type":"element","tag":"code","props":{"code":"async function getImages(urls, limit) {\n  let running = 0;\n  let r;\n  let p = new Promise((resolve, reject) => {\n    r = resolve;\n  });\n  function run() {\n    if (running < limit && urls.length > 0) {\n      running++;\n      let url = urls.shift();\n      (async () => {\n        let img = await getImage(url);\n        running--;\n        console.log(img);\n        if (urls.length === 0 && running === 0) {\n          console.log('done');\n          return r('done');\n        } else {\n          run();\n        }\n      })();\n      run(); // 立即到并发上限\n    }\n  }\n  run();\n  return await p;\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getImages"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"urls"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"limit"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"running"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"r"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"p"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"reject"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"r"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"run"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"running"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" < "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"limit"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" && "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"urls"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"length"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" > "}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"running"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"++;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"urls"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"shift"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      ("}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"getImage"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"running"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"--;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"urls"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"length"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" && "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"running"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" === "}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'done'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"r"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'done'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        } "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"run"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      })();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"run"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(); "}]},{"type":"element","tag":"span","props":{"class":"ct-92e1e6"},"children":[{"type":"text","value":"// 立即到并发上限\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"run"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"p"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"总结"},"children":[{"type":"text","value":"总结"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"以上列举了一些日常场景处理的代码片段,在遇到比较复杂场景时,可以结合以上的场景进行组合使用,如果场景过于复杂,最好的办法是使用相关的异步代码控制库。如果想更好地了解 async/await 可以先去了解 promise 和 generator, async/await 基本上是 generator 函数的语法糖,下面简单的描述了一下内部的原理。"}]},{"type":"element","tag":"code","props":{"code":"function delay(time) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n        resolve(time)\n    }, time)\n  })\n}\nfunction *createTime() {\n  let time1 = yield delay(1000)\n  let time2 = yield delay(2000)\n  let time3 = yield delay(3000)\n  console.log(time1, time2, time3)\n}\nlet iterator = createTime()\nconsole.log(iterator.next())\nconsole.log(iterator.next(1000))\nconsole.log(iterator.next(2000))\nconsole.log(iterator.next(3000))\n// 输出\n\n{ value: Promise { <pending> }, done: false }\n\n{ value: Promise { <pending> }, done: false }\n\n{ value: Promise { <pending> }, done: false }\n\n1000 2000 3000\n\n{ value: undefined, done: true }\n\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"reject"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    }, "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"createTime"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time1"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"yield"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"1000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time2"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"yield"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"2000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time3"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"yield"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"3000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time1"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time2"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time3"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"iterator"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"createTime"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"iterator"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"iterator"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"1000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"iterator"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"2000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"iterator"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"3000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-92e1e6"},"children":[{"type":"text","value":"// 输出\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"{ "}]},{"type":"element","tag":"span","props":{"class":"ct-65f329"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-331def"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"pending"}]},{"type":"element","tag":"span","props":{"class":"ct-331def"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" }, done: false }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" { <pending> }, "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"done"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" { <pending> }, "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"done"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"1000 2000 3000\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"undefined"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"done"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以看出每个 value 都是 Promise,并且通过手动传入参数到 next 就可以设置生成器内部的值,这里是手动传入,我只要写一个递归函数让其自动添进去就可以了"}]},{"type":"element","tag":"code","props":{"code":"function run(createTime) {\n  let iterator = createTime();\n  let result = iterator.next();\n  function autoRun() {\n    if (!result.done) {\n      Promise.resolve(result.value)\n        .then((time) => {\n          result = iterator.next(time);\n          autoRun();\n        })\n        .catch((err) => {\n          result = iterator.throw(err);\n          autoRun();\n        });\n    }\n  }\n  autoRun();\n}\nrun(createTime);\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"run"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"createTime"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"iterator"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"createTime"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"result"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"iterator"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"autoRun"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" (!"}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"result"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"done"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"result"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        ."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"result"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"iterator"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"autoRun"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        ."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"result"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"iterator"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"throw"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"          "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"autoRun"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"autoRun"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"run"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"createTime"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"promise.resove 保证返回的是一个 promise 对象 可迭代对象除了有 next 方法还有 throw 方法用于往生成器内部传入错误,只要生成内部能捕获该对象,生成器就可以继承运行,类似下面的代码"}]},{"type":"element","tag":"code","props":{"code":"function delay(time) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (time == 2000) {\n        reject('2000错误');\n      }\n      resolve(time);\n    }, time);\n  });\n}\nfunction* createTime() {\n  let time1 = yield delay(1000);\n  let time2;\n  try {\n    time2 = yield delay(2000);\n  } catch (error) {\n    time2 = error;\n  }\n  let time3 = yield delay(3000);\n  console.log(time1, time2, time3);\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a4008d"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"reject"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" == "}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"2000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"reject"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'2000错误'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    }, "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function*"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"createTime"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time1"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"yield"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"1000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time2"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time2"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"yield"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"2000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time2"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time3"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"yield"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"3000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time1"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time2"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time3"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以看出生成器函数其实和 async/await 语法长得很像,只要改一下 async/await 代码片段就是生成器函数了"}]},{"type":"element","tag":"code","props":{"code":"async function createTime() {\n  let time1 = await delay(1000);\n  let time2;\n  try {\n    time2 = await delay(2000);\n  } catch (error) {\n    time2 = error;\n  }\n  let time3 = await delay(3000);\n  console.log(time1, time2, time3);\n}\n\nfunction transform(async) {\n  let str = async.toString();\n  str = str.replace(/async\\s+(function)\\s+/, '$1 *').replace(/await/g, 'yield');\n  return str;\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"createTime"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time1"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"1000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time2"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time2"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"2000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time2"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time3"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"delay"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-263e30"},"children":[{"type":"text","value":"3000"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time1"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time2"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"time3"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"transform"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"str"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"toString"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"str"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"str"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"replace"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-4a63fa"},"children":[{"type":"text","value":"/async\\s"}]},{"type":"element","tag":"span","props":{"class":"ct-2292b6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-4a63fa"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"class":"ct-4a63fa"},"children":[{"type":"text","value":"\\s"}]},{"type":"element","tag":"span","props":{"class":"ct-2292b6"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-4a63fa"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'$1 *'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"class":"ct-f85f4c"},"children":[{"type":"text","value":"replace"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-4a63fa"},"children":[{"type":"text","value":"/await/"}]},{"type":"element","tag":"span","props":{"class":"ct-b6240c"},"children":[{"type":"text","value":"g"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-667460"},"children":[{"type":"text","value":"'yield'"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3abbff"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-71f585"},"children":[{"type":"text","value":"str"}]},{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-05bee5"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-2292b6{color:#D7BA7D}\n.ct-4a63fa{color:#D16969}\n.ct-331def{color:#808080}\n.ct-65f329{color:#C8C8C8}\n.ct-a4008d{color:#4EC9B0}\n.ct-263e30{color:#B5CEA8}\n.ct-3abbff{color:#C586C0}\n.ct-71f585{color:#9CDCFE}\n.ct-92e1e6{color:#6A9955}\n.ct-667460{color:#CE9178}\n.ct-f85f4c{color:#DCDCAA}\n.ct-a61c82{color:#4FC1FF}\n.ct-05bee5{color:#D4D4D4}\n.ct-b6240c{color:#569CD6}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"前言","depth":2,"text":"前言"},{"id":"场景-1-一个请求接着一个请求","depth":2,"text":"场景 1. 一个请求接着一个请求"},{"id":"场景-2并发请求","depth":2,"text":"场景 2.并发请求"},{"id":"场景-3错误处理","depth":2,"text":"场景 3.错误处理"},{"id":"场景-4-超时处理","depth":2,"text":"场景 4. 超时处理"},{"id":"场景-5-并发限制","depth":2,"text":"场景 5. 并发限制"},{"id":"总结","depth":2,"text":"总结"}]}},"_type":"markdown","_id":"content:articles:javaScript:AsyncAwaitScene.md","_source":"content","_file":"articles/javaScript/AsyncAwaitScene.md","_extension":"md"}