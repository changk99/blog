<!DOCTYPE html>
<html >
<head><meta charset="utf-8">
<title>es6 深入理解 Proxy 和 Reflect 这对影子兄弟</title>
<script src="/blog/js/theme.js"></script>
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<link rel="icon" href="/blog/favicon.ico">
<meta property="og:title" content="es6 深入理解 Proxy 和 Reflect 这对影子兄弟"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/entry.a22f097f.js"><link rel="preload" as="style" href="/blog/_nuxt/entry.00bb0547.css"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ArticleSearch.889bf585.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/AsideNav.2f19726f.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/_...slug_.4432410d.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentDoc.1f331e2c.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentRenderer.5978bdc7.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentRendererMarkdown.24276d0f.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/index.a6ef77ff.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ContentQuery.61b0d716.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ClientOnlyIcon.0bae3a9b.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseH2.22ecbb63.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseP.fa685141.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseA.2f6bfaf9.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/Link.01541e8e.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseH3.fc707c85.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseCode.9cafeb8c.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/use-global-config.cd8d904f.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseUl.2e16dd40.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseLi.7dc8aa29.js"><link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ProseCodeInline.19b65b0e.js"><link rel="prefetch" as="image" type="image/jpeg" href="/blog/_nuxt/changlishe.0913a958.jpg"><link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/client-db.0345bf9e.js"><link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/error-component.04dc9c3d.js"><link rel="stylesheet" href="/blog/_nuxt/entry.00bb0547.css"><style>.header{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:var(--blog-bg);background-image:linear-gradient(0deg,var(--blog-divider-light),var(--blog-divider-light) 1px,transparent 1px,transparent);display:-webkit-box;display:-ms-flexbox;display:flex;height:var(--navigation-bar-height);justify-content:flex-end;position:sticky;top:0;z-index:100}.header .item{cursor:pointer;margin-right:12px}.header .search{margin-right:auto}.header .avatar-home{-ms-flex-negative:0;flex-shrink:0}@supports ((-webkit-backdrop-filter:blur(1px)) or (backdrop-filter:blur(1px))){.header{-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);background-color:transparent}}.container{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:calc(100% - var(--window-top))}.aside{background-color:var(--blog-bg-regular);min-width:var(--aside-min-width)}.aside-stick{max-height:calc(100vh - var(--navigation-bar-height));overflow:auto;padding-bottom:50px;position:sticky;top:var(--window-top)}.aside-stick,.main{-webkit-box-sizing:border-box;box-sizing:border-box}.main{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;min-height:calc(100vh - var(--navigation-bar-height));min-width:0;padding:1.5em;padding-bottom:var(--safe-bottom-area)}.fade-enter-active,.fade-leave-active{-webkit-transition:all .2s;transition:all .2s}.fade-enter-from,.fade-leave-to{opacity:0}.slide-enter-active{-webkit-transition:all .4s;transition:all .4s}.slide-leave-active{-webkit-transition:all .2s;transition:all .2s}.slide-enter-from,.slide-leave-to{-webkit-transform:translateY(100%);transform:translateY(100%)}#__nuxt{background-color:var(--blog-bg-soft)}.to-top{border:1px solid;border-radius:50%;bottom:1em;color:var(--blog-brand-light);cursor:pointer;line-height:1;opacity:.8;padding:.2em;position:fixed;right:2em}.to-top:hover{opacity:1}.article-outline{max-width:300px}@media screen and (max-width:900px){.article-outline{-webkit-box-shadow:1px 1px 5px 1px var(--blog-shadow-color);box-shadow:1px 1px 5px 1px var(--blog-shadow-color);-webkit-box-sizing:border-box;box-sizing:border-box;max-width:var(--aside-max-width);min-height:calc(100% - var(--navigation-bar-height));min-height:100%;position:fixed;right:0;top:var(--navigation-bar-height);-webkit-transform:translateX(calc(var(--aside-max-width) + 20px));transform:translateX(calc(var(--aside-max-width) + 20px));-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s;z-index:100}.article-outline.open{-webkit-transform:translateX(0);transform:translateX(0)}.article-outline .right-aside{position:static}}@media screen and (max-width:768px){.menu{-webkit-box-shadow:-2px 2px 5px 1px var(--blog-shadow-color);box-shadow:-2px 2px 5px 1px var(--blog-shadow-color);left:0;max-width:var(--aside-max-width);min-height:calc(100% - var(--navigation-bar-height));position:fixed;top:var(--navigation-bar-height);-webkit-transform:scale(0);transform:scale(0);-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s;z-index:100}.menu.open{-webkit-transform:scale(1);transform:scale(1)}.menu .left-aside{position:static}}@media screen and (max-width:500px){.search.is-focus{-webkit-box-flex:1;-ms-flex:1;flex:1}.search.is-focus .el-autocomplete{width:100%}.search.is-focus~.item{display:none}}.nuxt-loading-indicator{top:var(--navigation-bar-height)!important}</style><style>.article-search-wrapper .el-input{--el-input-focus-border-color:var(--blog-brand-light)}.article-search-wrapper .el-input__wrapper{background-color:transparent;border-radius:0;-webkit-box-shadow:0 1px 0 0 transparent;box-shadow:0 1px 0 0 transparent;padding:0}.article-search-wrapper .el-input__wrapper.is-focus{-webkit-box-shadow:0 1px 0 0 var(--el-input-focus-border-color);box-shadow:0 1px 0 0 var(--el-input-focus-border-color)}.article-search-wrapper .el-input__suffix .el-input__icon{color:var(--blog-brand-light)}.article-search-wrapper .el-input__suffix .el-input__icon:hover{color:var(--blog-brand-dark)}.article-search .el-autocomplete-suggestion{max-width:500px}.article-search .empty{font-size:12px}.article-search a{line-height:1.6;padding:0 .2em .2em;position:relative;text-decoration:none;vertical-align:baseline}.article-search a,.article-search a:visited{color:var(--blog-brand-light)}.article-search a:hover{color:var(--blog-brand-highlight)}.article-search a:active{color:var(--blog-brand-light)}.article-search-wrapper{padding:0 1em}@media screen and (max-width:500px){.article-search .el-autocomplete-suggestion{max-width:300px}.article-search .el-autocomplete-suggestion li{white-space:normal}}</style><style>.nav[data-v-9a6baa4a]{cursor:auto!important}.dropdown[data-v-9a6baa4a]{-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;direction:ltr;display:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.dropdown .title[data-v-9a6baa4a]{font-size:14px;white-space:nowrap}.dropdown .arrow[data-v-9a6baa4a]{padding:0 .3em;-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s}.nav-list[data-v-9a6baa4a]{-webkit-box-pack:center;-ms-flex-pack:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;justify-content:center;list-style:none;margin:0;padding:0}.nav-list a[data-v-9a6baa4a]{color:var(--blog-text-1);font-size:14px;text-decoration:none;white-space:nowrap}.nav-item[data-v-9a6baa4a]{margin:0;padding:.1em .3em;position:relative}.nav-item.active[data-v-9a6baa4a],.nav-item[data-v-9a6baa4a]:hover{color:var(--blog-brand-light)}.nav-item .link[data-v-9a6baa4a]{color:inherit;padding:.4em 0}.nav-item[data-v-9a6baa4a]:before{border-bottom:2px solid var(--blog-brand-light);content:"";height:100%;left:100%;position:absolute;top:0;-webkit-transition:all .2s linear;transition:all .2s linear;width:0;z-index:-1}.nav-item[data-v-9a6baa4a]:hover:before{left:0;width:100%}.nav-item:hover~.nav-item[data-v-9a6baa4a]:before{left:0}@media screen and (max-width:500px){.nav[data-v-9a6baa4a]{direction:rtl}.dropdown[data-v-9a6baa4a]{display:-webkit-box;display:-ms-flexbox;display:flex}.dropdown.open .arrow[data-v-9a6baa4a]{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.dropdown .title.active[data-v-9a6baa4a]{color:var(--blog-brand-light)}.nav-list[data-v-9a6baa4a]{--top:auto;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;background-color:var(--blog-bg-regular);border:1px solid var(--blog-text-4);border-radius:.4em;-webkit-box-shadow:var(--blog-shadow-4);box-shadow:var(--blog-shadow-4);direction:ltr;-ms-flex-direction:column;flex-direction:column;margin-top:.2em;padding:.5em .4em 1em;position:fixed;top:var(--top);-webkit-transform:scale(0);transform:scale(0);-webkit-transform-origin:50% 0;transform-origin:50% 0;-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s}.nav-list a[data-v-9a6baa4a]{font-size:13px}.nav-list[data-v-9a6baa4a]:after{border-bottom:1px solid transparent;border-left:1px solid var(--blog-text-4);border-right:1px solid transparent;border-top:1px solid var(--blog-text-4);height:.3em;right:calc(50% - .3em);top:calc(-.3em + 1px);-webkit-transform:rotate(45deg);transform:rotate(45deg);width:.3em;z-index:-1}.nav-list[data-v-9a6baa4a]:after,.nav-list[data-v-9a6baa4a]:before{background-color:var(--blog-bg-regular);content:"";position:absolute}.nav-list[data-v-9a6baa4a]:before{height:.5em;pointer-events:none;right:calc(50% - .5em);top:0;width:1em}.dropdown.open+.nav-list[data-v-9a6baa4a]{-webkit-transform:scale(1);transform:scale(1)}}</style><style>.theme-change[data-v-eea72278]{font-size:0}.theme-change .switch[data-v-eea72278]{background:var(--blog-bg-soft);border:1px solid var(--blog-border-color-1);border-radius:10px;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;display:inline-block;font-size:16px;height:20px;margin:0;outline:none;position:relative;-webkit-transition:border-color var(--transition-duration),background-color var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration)!important;width:40px}.theme-change .switch[data-v-eea72278]:hover{border-color:var(--blog-border-color-3)}.theme-change .switch__action[data-v-eea72278]{background-color:var(--blog-bg);border-radius:50%;color:var(--blog-text-1);left:1px;position:absolute;top:1px;-webkit-transform:translate(0);transform:translate(0);-webkit-transition:border-color var(--transition-duration),background-color var(--transition-duration),-webkit-transform var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration),-webkit-transform var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration),transform var(--transition-duration)!important;transition:border-color var(--transition-duration),background-color var(--transition-duration),transform var(--transition-duration),-webkit-transform var(--transition-duration)!important}.theme-change .switch__action[data-v-eea72278],.theme-change .switch__icon[data-v-eea72278]{height:16px;width:16px}.theme-change .switch__icon[data-v-eea72278]{position:relative}.theme-change .icon[data-v-eea72278]{left:0;position:absolute;top:0;-webkit-transition:color var(--transition-duration),opacity var(--transition-duration)!important;transition:color var(--transition-duration),opacity var(--transition-duration)!important}.theme-change .dark-icon[data-v-eea72278]{opacity:0}.dark .switch__action[data-v-eea72278]{-webkit-transform:translate(20px);transform:translate(20px)}.dark .dark-icon[data-v-eea72278]{opacity:1}.dark .light-icon[data-v-eea72278]{opacity:0}</style><style>.icon[data-v-95f7ae78]{fill:currentColor;vertical-align:middle}</style><style>.icon[data-v-42e682c2]{fill:currentColor;vertical-align:middle}</style><style>.icon[data-v-7a55d05e]{fill:currentColor;vertical-align:middle}</style><style>.aside-nav{--el-menu-item-height:44px;--el-menu-base-level-padding:20px;--el-menu-level-padding:1em;--el-menu-sub-item-height:calc(var(--el-menu-item-height) - 6px);padding-top:1em}.aside-nav a{-webkit-box-flex:1;color:var(--blog-text-2);-ms-flex:1;flex:1;overflow:hidden;text-decoration:none;text-overflow:ellipsis}.aside-nav a:hover{color:var(--blog-text-1)}.aside-nav a.router-link-active{color:var(--blog-brand-light)}.aside-nav .el-menu-item{cursor:auto;display:-webkit-box;display:-ms-flexbox;display:flex;font-size:12px;margin:0}.aside-nav .el-divider--horizontal{margin:12px 0}.open-menu{color:var(--blog-brand-light);cursor:pointer;left:0;opacity:.9;padding:.1em .5em .5em;position:fixed;top:calc(var(--navigation-bar-height));-webkit-transition:opacity .3s;transition:opacity .3s;z-index:101}.open-menu .toggle-icon{-webkit-transform:rotate(45deg);transform:rotate(45deg);-webkit-transition:-webkit-transform .5s;transition:-webkit-transform .5s;transition:transform .5s;transition:transform .5s,-webkit-transform .5s}.open-menu.open .toggle-icon{-webkit-transform:rotate(215deg);transform:rotate(215deg)}.scrolling .open-menu{opacity:0}@media screen and (min-width:768px){.open-menu{display:none}}</style><style>.wrapper[data-v-1423ab59]{-webkit-box-pack:center;-ms-flex-pack:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:none;height:50px;justify-content:center}.wrapper.loading[data-v-1423ab59]{display:-webkit-box;display:-ms-flexbox;display:flex}.snow[data-v-1423ab59]{-webkit-animation:rotating-1423ab59 2s linear infinite;animation:rotating-1423ab59 2s linear infinite;color:var(--blog-text-2);height:24px;width:24px}@-webkit-keyframes rotating-1423ab59{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotating-1423ab59{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.spinner[data-v-1423ab59]{height:24px;width:24px}.spinner .path[data-v-1423ab59]{stroke-dasharray:90,150;stroke-dashoffset:0;stroke-width:2;stroke:var(--blog-text-2);stroke-linecap:round;-webkit-animation:loading-dash-1423ab59 1.5s ease-in-out infinite;animation:loading-dash-1423ab59 1.5s ease-in-out infinite}.spinner .circular[data-v-1423ab59]{-webkit-animation:loading-rotate-1423ab59 2s linear infinite;animation:loading-rotate-1423ab59 2s linear infinite}@-webkit-keyframes loading-dash-1423ab59{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}@keyframes loading-dash-1423ab59{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}@-webkit-keyframes loading-rotate-1423ab59{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes loading-rotate-1423ab59{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}</style><style>.content-doc[data-v-58a2f6cb]{padding-bottom:2em}.content-doc[data-v-58a2f6cb] .content{min-height:400px}.content-doc .error[data-v-58a2f6cb]{color:var(--blog-text-1);font-size:2.66667vw;text-align:center}.content-doc .error[data-v-58a2f6cb] .refresh{color:var(--blog-brand-light);cursor:pointer}.nav[data-v-58a2f6cb]{-webkit-box-pack:justify;-ms-flex-pack:justify;display:-webkit-box;display:-ms-flexbox;display:flex;justify-content:space-between}.nav .link[data-v-58a2f6cb]{color:var(--blog-brand-light);font-weight:bolder;line-height:1.6;text-decoration:none;vertical-align:baseline;white-space:nowrap}.nav .link .title[data-v-58a2f6cb]{display:inline-block;vertical-align:middle;white-space:normal}.nav .link[data-v-58a2f6cb]:hover{color:var(--blog-brand-highlight)}.nav .link[data-v-58a2f6cb]:active{color:var(--blog-brand-light)}.nav .dir-title[data-v-58a2f6cb]{color:var(--blog-text-2);font-size:14px}.nav .nav-item[data-v-58a2f6cb]{min-width:0;word-break:break-all}.nav .nav-item-after .dir-title[data-v-58a2f6cb]{margin-right:1em;text-align:right}.nav .nav-item-before[data-v-58a2f6cb]{padding-right:2em}.nav .nav-item-before .dir-title[data-v-58a2f6cb]{margin-left:1em}</style><style>.icon[data-v-bfbb85d1]{fill:currentColor;vertical-align:middle}</style><style>.icon[data-v-d5088638]{fill:currentColor;vertical-align:middle}</style><style>.title[data-v-924fdd6f]{color:var(--blog-text-h);font-size:var(--blog-font-size-h2);margin:.2em 0;padding-left:.2em}.link[data-v-924fdd6f]{color:inherit;text-decoration:none}.symbol[data-v-924fdd6f]{color:var(--blog-brand-light);opacity:0}.title:hover .symbol[data-v-924fdd6f]{opacity:1}</style><style>.prose-p[data-v-4aba2c1d]{padding:0}</style><style>.prose-a{border-bottom:1px dashed;font-weight:bolder;line-height:1.6;padding:0 .2em .2em;position:relative;text-decoration:none;vertical-align:baseline}.prose-a,.prose-a:visited{color:var(--blog-brand-light)}.prose-a:hover{color:var(--blog-brand-highlight)}.prose-a:active{color:var(--blog-brand-light)}.prose-a .external-icon{margin-left:-.8em;opacity:0;-webkit-transform:translate(.8em,-.8em);transform:translate(.8em,-.8em)}.prose-a:hover .external-icon{opacity:1}</style><style>.icon[data-v-20b97dad]{fill:currentColor;vertical-align:middle}</style><style>.title[data-v-d3792100]{color:var(--blog-text-h);font-size:var(--blog-font-size-h3);margin:.2em 0;padding-left:.2em}.link[data-v-d3792100]{color:inherit;text-decoration:none}.symbol[data-v-d3792100]{color:var(--blog-brand-light);opacity:0}.title:hover .symbol[data-v-d3792100]{opacity:1}</style><style>.prose-code{background-color:var(--blog-gray-light-5);border:1px solid var(--blog-border-color-3);border-radius:var(--blog-radius-2);-webkit-box-sizing:border-box;box-sizing:border-box;margin:1em 0;padding:1em;position:relative}.prose-code.lang{background-color:var(--blog-black-regular);padding-bottom:0;padding-right:1.6em;padding-top:1.8em}.prose-code.lang .file-info{color:var(--blog-text-dark-2);font-size:12px;position:absolute;right:1em;top:.5em}.prose-code.lang pre code{word-wrap:normal;font-size:.9em;line-height:1.35;white-space:pre}.prose-code.no-lang{padding-bottom:.2em;padding-top:1.2em}.prose-code.no-lang pre{font-family:inherit}.prose-code.no-lang pre code{font-family:inherit;padding-bottom:.8em;white-space:pre-wrap}.prose-code.no-lang a{padding:0 .2em;position:relative;text-decoration:none;vertical-align:baseline}.prose-code.no-lang a,.prose-code.no-lang a:visited{color:var(--blog-brand-light)}.prose-code.no-lang a:hover{color:var(--blog-brand-highlight)}.prose-code.no-lang a:active{color:var(--blog-brand-light)}.prose-code pre{margin:0}.prose-code pre code{display:inline-block;overflow:auto;padding-bottom:1.5em;white-space:normal;width:100%}.prose-code .copy{bottom:.5em;color:var(--blog-text-dark-1);cursor:pointer;opacity:.5;position:absolute;right:.2em}.prose-code:hover .copy{opacity:1}pre code .line{display:block;line-height:1.6;min-height:1rem}.dark .prose-code.no-lang{background-color:var(--blog-black-regular)}.el-message--success.copy{--el-message-bg-color:var(--blog-bg-soft);--el-message-border-color:var(--blog-border-color-2);--el-message-text-color:var(--blog-text-2);white-space:nowrap;width:auto}.prose-code ::-webkit-scrollbar{height:8px;width:10px}.prose-code ::-webkit-scrollbar-track{background:var(--blog-black-soft);border-radius:10px}.prose-code ::-webkit-scrollbar-thumb{background:var(--blog-black-mute);border-radius:10px}.prose-code ::-webkit-scrollbar-thumb:hover{background:#646464;border-radius:10px}.prose-code ::-webkit-scrollbar-thumb:active{background:#444;border-radius:10px}@media screen and (max-width:768px){.prose-code ::-webkit-scrollbar{height:2px;width:2px}}</style><style>.prose-code-inline[data-v-39cc8780]{background-color:var(--blog-black-regular);border-radius:var(--blog-radius-1);color:var(--blog-text-dark-1);padding:.3em .5em}</style></head>
<body ><div id="el-popper-container-1024"><div style="z-index:2017;position:absolute;left:0;top:0;display:none;" class="el-popper is-pure is-light el-autocomplete__popper article-search" tabindex="-1" aria-hidden="true"><!--[--><!--[--><!--[--><!--[--><div class="el-autocomplete-suggestion" style="min-width:;outline:none;" role="region"><div class="el-scrollbar" id="el-autocomplete-78" role="listbox"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default" style=""><ul class="el-scrollbar__view el-autocomplete-suggestion__list" style=""><!--[--><!--]--></ul></div><!--[--><div class="el-scrollbar__bar is-horizontal" style="display:none;"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical" style="display:none;"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);"></div></div><!--]--></div></div><!--]--><span class="el-popper__arrow" style="position:absolute;" data-popper-arrow></span><!--]--><!--]--><!--]--></div><!--teleport anchor--></div><div id="__nuxt"><!--[--><header class="header"><div class="search item"><div class="article-search-wrapper"><!--[--><div class="el-autocomplete search el-tooltip__trigger el-tooltip__trigger" style="" role="combobox" aria-owns="el-autocomplete-78"><div class="el-input el-input--prefix el-input--suffix" style=""><!-- input --><!--[--><!-- prepend slot --><!--v-if--><div class="el-input__wrapper"><!-- prefix slot --><span class="el-input__prefix"><span class="el-input__prefix-inner"><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 20 20" class="icon search-icon" data-v-bfbb85d1><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-bfbb85d1></path></svg><!--]--><!--]--><!--v-if--></span></span><input class="el-input__inner" type="text" autocomplete="off" tabindex="0" placeholder="搜索" style=""><!-- suffix slot --><!--v-if--></div><!-- append slot --><!--v-if--><!--]--></div></div><!--teleport start--><!--teleport end--><!--]--></div></div><nav class="nav item" data-v-9a6baa4a><!--[--><div class="dropdown" data-v-9a6baa4a><span class="title" data-v-9a6baa4a>文章</span><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 1024 1024" class="icon arrow" data-v-9a6baa4a data-v-d5088638><path d="M831.872 340.864 512 652.672 192.128 340.864a30.592 30.592 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.592 30.592 0 0 0-42.752 0z" data-v-d5088638></path></svg></div><ul class="nav-list" data-v-9a6baa4a><!--[--><li class="active nav-item" data-v-9a6baa4a><a href="/blog/articles/css/bfcstackcascading" class="link" data-v-9a6baa4a>文章</a></li><li class="nav-item" data-v-9a6baa4a><a href="/blog/browser_plugins/modifyingwebdata/install" class="link" data-v-9a6baa4a>浏览器插件</a></li><li class="nav-item" data-v-9a6baa4a><a href="/blog/tools/douyin" class="link" data-v-9a6baa4a>工具</a></li><!--]--></ul><!--]--></nav><div class="theme-change item" title="切换主题" data-v-eea72278><button role="switch" aria-label="切换暗色主题" aria-checked="false" class="switch" data-v-eea72278><div class="switch__action" data-v-eea72278><div class="switch__icon" data-v-eea72278><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon dark-icon icon" data-v-eea72278 data-v-95f7ae78><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z" data-v-95f7ae78></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon light-icon icon" data-v-eea72278 data-v-42e682c2><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z" data-v-42e682c2></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z" data-v-42e682c2></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z" data-v-42e682c2></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z" data-v-42e682c2></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z" data-v-42e682c2></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z" data-v-42e682c2></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z" data-v-42e682c2></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z" data-v-42e682c2></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z" data-v-42e682c2></path></svg></div></div></button></div><div title="github 仓库" class="item"><svg xmlns="http://www.w3.org/2000/svg" width="1.8em" height="1.8em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-7a55d05e><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z" data-v-7a55d05e></path></svg></div><span class="el-avatar el-avatar--circle avatar-home item" style="--el-avatar-size:26px;" title="首页"><img src="/blog/_nuxt/changlishe.0913a958.jpg" alt="首页" style="object-fit:cover;"></span></header><div class="container"><aside style="" class="open aside menu"><div class="aside-stick left-aside"><nav class="nav"><span></span><ul role="menubar" style="--el-menu-level:0;" class="el-menu el-menu--vertical aside-nav"><!--[--><!--]--><div class="wrapper loading" data-v-1423ab59><div class="spinner" data-v-1423ab59><svg class="circular" viewBox="0 0 50 50" data-v-1423ab59><circle class="path" cx="25" cy="25" r="20" fill="none" data-v-1423ab59></circle></svg></div><!----></div><div class="el-divider el-divider--horizontal" style="--el-border-style:solid;" role="separator"><!--v-if--></div><!--[--><li class="el-menu-item" role="menuitem" tabindex="-1"><!--[--><!--[--><a href="/blog/test" class="">markdown</a><!--]--><!--[--><!--]--><!--]--></li><!--]--></ul></nav></div></aside><main class="main"><div class="content-doc" data-v-58a2f6cb><!--[--><div class="content"><h2 class="title" id="前言" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#前言" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->前言<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->vue3.0 使用了 Proxy 对象做响应式系统,让很多人都认识了 Proxy 对象,vue3.0 中的响应式数据甚至是组件实例,其实都是 Proxy 对象。但是这篇文章不是说 Proxy 对象在 vue3.0 是怎样发挥作用的,而是说说其影子兄弟 Reflect。既然是影子,自然是相映相随的。Reflect 中文解释可以是映射,也正好说明其设计初衷。简单来说 Proxy 对象代理并拦截目标对象特定行为,而这些行为都有其默认行为,而 Reflect 对象就是方便可以实现这些默认行为,Proxy 有多少拦截类型,Reflect 就实现了多少对应类型的映射函数(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy" rel="nofollow" target="_blank" class="prose-a"><!--[-->Proxy 对象的拦截类型<!--]--><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon external-icon" data-v-20b97dad><path fill="currentColor" d="M10 6v2H5v11h11v-5h2v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm11-3v8h-2V6.413l-7.793 7.794l-1.414-1.414L17.585 5H13V3h8z" data-v-20b97dad></path></svg></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect" rel="nofollow" target="_blank" class="prose-a"><!--[-->Reflect 对象的映射 API<!--]--><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon external-icon" data-v-20b97dad><path fill="currentColor" d="M10 6v2H5v11h11v-5h2v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm11-3v8h-2V6.413l-7.793 7.794l-1.414-1.414L17.585 5H13V3h8z" data-v-20b97dad></path></svg></a> 如果对这个两个对象还不是很了解,可以先看看上面链接中对这两个对象的介绍)<br>
可能你会想,我都知道默认行为了,自已实现不就可以了,为什么还需要 Reflect,为了说明这个问题,下文将针对 set 这个常用拦截类型去说明,如果不用 Reflect 去实现你将遇到多少问题,才能成功实现其默认行为。<!--]--></p><h2 class="title" id="存取器属性搭上-receiver-参数" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#存取器属性搭上-receiver-参数" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->存取器属性搭上 receiver 参数<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><h3 class="title" id="基础实现" data-v-d3792100><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#基础实现" class="router-link-active router-link-exact-active link" data-v-d3792100><span class="content" data-v-d3792100><!--[-->基础实现<!--]--></span><span class="symbol" data-v-d3792100>#</span></a></h3><p class="prose-p" data-v-4aba2c1d><!--[-->下面先定义基础的代码<!--]--></p><div class="lang prose-code"><div class="file-info">javascript</div><!--[--><pre><code><span class="line" line="1"><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">target</span><span class="ct-1c9fee"> = {
</span></span><span class="line" line="2"><span class="ct-1c9fee">  </span><span class="ct-21e7f5">_name:</span><span class="ct-1c9fee"> </span><span class="ct-8d33ce">&#39;目标对象&#39;</span><span class="ct-1c9fee">,
</span></span><span class="line" line="3"><span class="ct-1c9fee">  </span><span class="ct-829377">get</span><span class="ct-1c9fee"> </span><span class="ct-bf5eb0">name</span><span class="ct-1c9fee">() {
</span></span><span class="line" line="4"><span class="ct-1c9fee">    </span><span class="ct-2c3fbe">return</span><span class="ct-1c9fee"> </span><span class="ct-829377">this</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">_name</span><span class="ct-1c9fee">;
</span></span><span class="line" line="5"><span class="ct-1c9fee">  },
</span></span><span class="line" line="6"><span class="ct-1c9fee">  </span><span class="ct-829377">set</span><span class="ct-1c9fee"> </span><span class="ct-bf5eb0">name</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee">) {
</span></span><span class="line" line="7"><span class="ct-1c9fee">    </span><span class="ct-829377">this</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">_name</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">name</span><span class="ct-1c9fee">;
</span></span><span class="line" line="8"><span class="ct-1c9fee">  },
</span></span><span class="line" line="9"><span class="ct-1c9fee">  </span><span class="ct-21e7f5">age:</span><span class="ct-1c9fee"> </span><span class="ct-d6cb1c">18
</span></span><span class="line" line="10"><span class="ct-1c9fee">};
</span></span><span class="line" line="11"><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">defaultProxy</span><span class="ct-1c9fee"> = </span><span class="ct-829377">new</span><span class="ct-1c9fee"> </span><span class="ct-bf5eb0">Proxy</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, {});
</span></span><span class="line" line="12"><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">customProxy</span><span class="ct-1c9fee"> = </span><span class="ct-829377">new</span><span class="ct-1c9fee"> </span><span class="ct-bf5eb0">Proxy</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, {
</span></span><span class="line" line="13"><span class="ct-1c9fee">  </span><span class="ct-bf5eb0">set</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">) {
</span></span><span class="line" line="14"><span class="ct-1c9fee">    </span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">[</span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">] = </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">;
</span></span><span class="line" line="15"><span class="ct-1c9fee">  }
</span></span><span class="line" line="16"><span class="ct-1c9fee">});</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><h3 class="title" id="存取器属性" data-v-d3792100><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#存取器属性" class="router-link-active router-link-exact-active link" data-v-d3792100><span class="content" data-v-d3792100><!--[-->存取器属性<!--]--></span><span class="symbol" data-v-d3792100>#</span></a></h3><p class="prose-p" data-v-4aba2c1d><!--[-->先看设置的 target 对象,也就是代理的目标对象,先看 name 属性,可以看到该属性前面有 get set 标识,这类属性叫存取器属性,在访问值和设置值时才会惰性执行对应的 getter setter 函数。
每一个普通对象属性都有一个对应属性描述对象,下面是其属性描述符对象<!--]--></p><div class="lang prose-code"><div class="file-info">javascript</div><!--[--><pre><code><span class="line" line="1"><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">getOwnPropertyDescriptor</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-8d33ce">&#39;name&#39;</span><span class="ct-1c9fee">)
</span></span><span class="line" line="2"><span class="ct-1c9fee">{</span><span class="ct-8d0700">enumerable</span><span class="ct-1c9fee">: </span><span class="ct-829377">true</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">configurable</span><span class="ct-1c9fee">: </span><span class="ct-829377">true</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">get</span><span class="ct-1c9fee">: </span><span class="ct-21e7f5">ƒ</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">set</span><span class="ct-1c9fee">: </span><span class="ct-a18c13">ƒ</span><span class="ct-10f473">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->age 属性是一个数据属性,其属性描述符对象是<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-a18c13">Object</span><span class="ct-10f473">.</span><span class="ct-bf5eb0">getOwnPropertyDescriptor</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-8d33ce">&#39;age&#39;</span><span class="ct-1c9fee">)
</span></span><span class="line" line="2"><span class="ct-1c9fee">{</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">18</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">writable</span><span class="ct-1c9fee">: </span><span class="ct-829377">true</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">enumerable</span><span class="ct-1c9fee">: </span><span class="ct-829377">true</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">configurable</span><span class="ct-1c9fee">: </span><span class="ct-829377">true</span><span class="ct-1c9fee">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->如果要让一个属性变为只读可以把数据属性的 writable 设置为 false,或者把存取器属性的 set 设置为 undefined,具体怎么设置属性的描述符对象下文会有提及,以上只是稍微说一下基础的知识,下面回归正题<!--]--></p><h3 class="title" id="触发-set-拦截的行为" data-v-d3792100><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#触发-set-拦截的行为" class="router-link-active router-link-exact-active link" data-v-d3792100><span class="content" data-v-d3792100><!--[-->触发 set 拦截的行为<!--]--></span><span class="symbol" data-v-d3792100>#</span></a></h3><p class="prose-p" data-v-4aba2c1d><!--[-->defaultProxy 是一个默认的代理对象,没有设置任何拦截行为,接着设置了一个 customProxy 对象并设置了 set 拦截行为,这个方法具有 4 个参数,比较有疑惑的可能是 receiver 参数,下面通过例子就可以知道该参数的作用了。set 方法内部的代码就是要实现 set 拦截的默认行为,如果不用 Reflect 对象,实现其默认行为要遇到多少问题,就是下面要详细说明的内容。<!--]--></p><p class="prose-p" data-v-4aba2c1d><!--[-->在开始前先根据文档列出了能触发 set 拦截行为的操作<!--]--></p><ul><!--[--><li><!--[-->Property assignment: proxy<span>foo</span> = bar and proxy.foo = bar<!--]--></li><li><!--[-->Inherited property assignment: Object.create(proxy)<span>foo</span> = bar 代理对象位于原型链上,在这种情况下拦截函数的 receiver 指向子类实例对象<!--]--></li><li><!--[-->Reflect.set() 准确来说是 Reflect.set(proxy, key, value, receiver?) 注意第一个参数是代理对象不是目标对象,receiver 是可选值,不存在时指向第一个参数<!--]--></li><!--]--></ul><h3 class="title" id="基础实现的问题" data-v-d3792100><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#基础实现的问题" class="router-link-active router-link-exact-active link" data-v-d3792100><span class="content" data-v-d3792100><!--[-->基础实现的问题<!--]--></span><span class="symbol" data-v-d3792100>#</span></a></h3><p class="prose-p" data-v-4aba2c1d><!--[-->先从最容易的实现开始<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-a18c13">target</span><span class="ct-10f473">[</span><span class="ct-a18c13">key</span><span class="ct-10f473">] = </span><span class="ct-a18c13">value</span><span class="ct-10f473">;</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->先看默认行为,这里是控制台输出<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-a18c13">defaultProxy</span><span class="ct-10f473">.</span><span class="ct-a18c13">name</span><span class="ct-10f473"> = </span><span class="ct-083033">&#39;hello world&#39;</span><span class="ct-10f473">;
</span></span><span class="line" line="2"><span class="ct-10f473">(</span><span class="ct-8d33ce">&#39;hello world&#39;</span><span class="ct-1c9fee">);
</span></span><span class="line" line="3"><span class="ct-21e7f5">target</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee">;
</span></span><span class="line" line="4"><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;hello world&#39;</span><span class="ct-1c9fee">);
</span></span><span class="line" line="5"><span class="ct-21e7f5">defaultProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee"> = </span><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">;
</span></span><span class="line" line="6"><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">;
</span></span><span class="line" line="7"><span class="ct-21e7f5">target</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee">;
</span></span><span class="line" line="8"><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">;</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->再看实现的默认行为<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-21e7f5">customProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee"> = </span><span class="ct-8d33ce">&#39;hello world&#39;</span><span class="ct-1c9fee">;
</span></span><span class="line" line="2"><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;hello world&#39;</span><span class="ct-1c9fee">);
</span></span><span class="line" line="3"><span class="ct-21e7f5">customProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee">;
</span></span><span class="line" line="4"><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;hello world&#39;</span><span class="ct-1c9fee">);
</span></span><span class="line" line="5"><span class="ct-21e7f5">customProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee"> = </span><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">;
</span></span><span class="line" line="6"><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">;
</span></span><span class="line" line="7"><span class="ct-21e7f5">customProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee">;
</span></span><span class="line" line="8"><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">;</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->看似都一样,是不是就已经成功了?下面我们把 set name 修改一下,让其读出 this<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-21e7f5">set</span><span class="ct-1c9fee"> </span><span class="ct-bf5eb0">name</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee">) {
</span></span><span class="line" line="2"><span class="ct-1c9fee">  </span><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-829377">this</span><span class="ct-1c9fee">)
</span></span><span class="line" line="3"><span class="ct-1c9fee">  </span><span class="ct-829377">this</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">_name</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">name
</span></span><span class="line" line="4"><span class="ct-1c9fee">},</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->设置 <code class="prose-code-inline" data-v-39cc8780><!--[-->defaultProxy.name = &#39;hello world&#39;<!--]--></code> this 的输出是 <code class="prose-code-inline" data-v-39cc8780><!--[-->Proxy {_name: &quot;hello world&quot;, age: 18}<!--]--></code><br>
设置 <code class="prose-code-inline" data-v-39cc8780><!--[-->customProxy.name = &#39;hello world&#39;<!--]--></code> this 的输出是 <code class="prose-code-inline" data-v-39cc8780><!--[-->{_name: &quot;目标对象&quot;, age: 18}<!--]--></code><br>
设置 <code class="prose-code-inline" data-v-39cc8780><!--[-->defaultProxy.name = &#39;hello world&#39;<!--]--></code> this 的输出是 <code class="prose-code-inline" data-v-39cc8780><!--[-->Proxy {_name: &quot;hello world&quot;, age: 18}<!--]--></code><br>
设置 <code class="prose-code-inline" data-v-39cc8780><!--[-->Reflect.set(defaultProxy, &#39;name&#39;, &#39;hello world&#39;)<!--]--></code> this 的输出是 <code class="prose-code-inline" data-v-39cc8780><!--[-->Proxy {_name: &quot;hello world&quot;, age: 18}<!--]--></code><br>
设置 <code class="prose-code-inline" data-v-39cc8780><!--[-->Reflect.set(defaultProxy, &#39;name&#39;, &#39;hello world&#39;, { a: 1})<!--]--></code> this 的输出是 <code class="prose-code-inline" data-v-39cc8780><!--[-->{a: 1}<!--]--></code><br>
设置 <code class="prose-code-inline" data-v-39cc8780><!--[-->Reflect.set(customProxy, &#39;name&#39;, &#39;hello world&#39;, { a: 1})<!--]--></code> this 的输出是 <code class="prose-code-inline" data-v-39cc8780><!--[-->{_name: &quot;hello world&quot;, age: 18}<!--]--></code><br>
可以看出使用 cunstomProxy 其 this 值总是指向目标对象,因为我们的实现就是简单的对象属性赋值,this 自然就指向目标对象。而默认行为中,this 是指向代理对象的,而通过 <code class="prose-code-inline" data-v-39cc8780><!--[-->Reflect.set(defaultProxy, &#39;name&#39;, &#39;hello world&#39;, { a: 1})<!--]--></code>可以看出 this 更严格来说是指向 receiver 参数,在没有传入时就取第一个参数的值。<!--]--></p><h3 class="title" id="修复存取器属性" data-v-d3792100><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#修复存取器属性" class="router-link-active router-link-exact-active link" data-v-d3792100><span class="content" data-v-d3792100><!--[-->修复存取器属性<!--]--></span><span class="symbol" data-v-d3792100>#</span></a></h3><p class="prose-p" data-v-4aba2c1d><!--[-->很明显这里实现的默认行为是有问题的,针对这类问题可以修复为<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-bf5eb0">set</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">) {
</span></span><span class="line" line="2"><span class="ct-1c9fee">  </span><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">descriptor</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">getOwnPropertyDescriptor</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">)
</span></span><span class="line" line="3"><span class="ct-1c9fee">  </span><span class="ct-2c3fbe">if</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;set&#39;</span><span class="ct-1c9fee">)) {
</span></span><span class="line" line="4"><span class="ct-1c9fee">    </span><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">setter</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">set
</span></span><span class="line" line="5"><span class="ct-1c9fee">    </span><span class="ct-2c3fbe">if</span><span class="ct-1c9fee">(</span><span class="ct-829377">typeof</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">setter</span><span class="ct-1c9fee"> === </span><span class="ct-8d33ce">&#39;function&#39;</span><span class="ct-1c9fee"> ) {
</span></span><span class="line" line="6"><span class="ct-1c9fee">      </span><span class="ct-21e7f5">setter</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">call</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">)
</span></span><span class="line" line="7"><span class="ct-1c9fee">    }
</span></span><span class="line" line="8"><span class="ct-1c9fee">  } </span><span class="ct-2c3fbe">else</span><span class="ct-1c9fee"> {
</span></span><span class="line" line="9"><span class="ct-1c9fee">    </span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">[</span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">] = </span><span class="ct-21e7f5">value
</span></span><span class="line" line="10"><span class="ct-1c9fee">  }
</span></span><span class="line" line="11"><span class="ct-1c9fee">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->然后按上面的测试方法,测试了一番,发现都满足默认行为了,但是到这步只解决了存取器属性的问题,还有数据属性的还没有解决,下面看看数据属性你会遇到什么问题。<!--]--></p><h2 class="title" id="隐匿的-defineproperty-陷阱拦截" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#隐匿的-defineproperty-陷阱拦截" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->隐匿的 defineProperty 陷阱拦截<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><h3 class="title" id="增加-defineproperty-拦截" data-v-d3792100><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#增加-defineproperty-拦截" class="router-link-active router-link-exact-active link" data-v-d3792100><span class="content" data-v-d3792100><!--[-->增加 defineProperty 拦截<!--]--></span><span class="symbol" data-v-d3792100>#</span></a></h3><p class="prose-p" data-v-4aba2c1d><!--[-->在开始介绍这个问题前,先增加默认代理对象和实现代理对象一个 defineProperty 拦截,由于是针对 set 拦截实现默认行为,为了不引入其他问题,直接就使用 <code class="prose-code-inline" data-v-39cc8780><!--[-->return Reflect.defineProperty(target, property, descriptor)<!--]--></code> 实现 defineProperty 拦截的默认行为<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">defaultProxy</span><span class="ct-1c9fee"> = </span><span class="ct-829377">new</span><span class="ct-1c9fee"> </span><span class="ct-bf5eb0">Proxy</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, {
</span></span><span class="line" line="2"><span class="ct-1c9fee">  </span><span class="ct-bf5eb0">defineProperty</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">property</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">) {
</span></span><span class="line" line="3"><span class="ct-1c9fee">    </span><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">`defaultProxy defineProperty 拦截触发`</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">property</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">);
</span></span><span class="line" line="4"><span class="ct-1c9fee">    </span><span class="ct-2c3fbe">return</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">Reflect</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">defineProperty</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">property</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">);
</span></span><span class="line" line="5"><span class="ct-1c9fee">  }
</span></span><span class="line" line="6"><span class="ct-1c9fee">});
</span></span><span class="line" line="7"><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">customProxy</span><span class="ct-1c9fee"> = </span><span class="ct-829377">new</span><span class="ct-1c9fee"> </span><span class="ct-bf5eb0">Proxy</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, {
</span></span><span class="line" line="8"><span class="ct-1c9fee">  </span><span class="ct-bf5eb0">set</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">) {
</span></span><span class="line" line="9"><span class="ct-1c9fee">    </span><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">descriptor</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">getOwnPropertyDescriptor</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">);
</span></span><span class="line" line="10"><span class="ct-1c9fee">    </span><span class="ct-2c3fbe">if</span><span class="ct-1c9fee"> (</span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;set&#39;</span><span class="ct-1c9fee">)) {
</span></span><span class="line" line="11"><span class="ct-1c9fee">      </span><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">setter</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">set</span><span class="ct-1c9fee">;
</span></span><span class="line" line="12"><span class="ct-1c9fee">      </span><span class="ct-2c3fbe">if</span><span class="ct-1c9fee"> (</span><span class="ct-829377">typeof</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">setter</span><span class="ct-1c9fee"> === </span><span class="ct-8d33ce">&#39;function&#39;</span><span class="ct-1c9fee">) {
</span></span><span class="line" line="13"><span class="ct-1c9fee">        </span><span class="ct-21e7f5">setter</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">call</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">);
</span></span><span class="line" line="14"><span class="ct-1c9fee">      }
</span></span><span class="line" line="15"><span class="ct-1c9fee">    } </span><span class="ct-2c3fbe">else</span><span class="ct-1c9fee"> {
</span></span><span class="line" line="16"><span class="ct-1c9fee">      </span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">[</span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">] = </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">;
</span></span><span class="line" line="17"><span class="ct-1c9fee">    }
</span></span><span class="line" line="18"><span class="ct-1c9fee">  },
</span></span><span class="line" line="19"><span class="ct-1c9fee">  </span><span class="ct-bf5eb0">defineProperty</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">property</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">) {
</span></span><span class="line" line="20"><span class="ct-1c9fee">    </span><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">`cunstomProxy defineProperty 拦截触发`</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">property</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">);
</span></span><span class="line" line="21"><span class="ct-1c9fee">    </span><span class="ct-2c3fbe">return</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">Reflect</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">defineProperty</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">property</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">);
</span></span><span class="line" line="22"><span class="ct-1c9fee">  }
</span></span><span class="line" line="23"><span class="ct-1c9fee">});</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><h3 class="title" id="分析拦截逻辑" data-v-d3792100><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#分析拦截逻辑" class="router-link-active router-link-exact-active link" data-v-d3792100><span class="content" data-v-d3792100><!--[-->分析拦截逻辑<!--]--></span><span class="symbol" data-v-d3792100>#</span></a></h3><p class="prose-p" data-v-4aba2c1d><!--[-->下面执行默认行为<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-21e7f5">defaultProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee"> = </span><span class="ct-8d33ce">&#39;hello world&#39;
</span></span><span class="line" line="2"><span class="ct-21e7f5">Proxy</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">_name</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;目标对象&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">age</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">18</span><span class="ct-1c9fee">}
</span></span><span class="line" line="3"><span class="ct-21e7f5">defaultProxy</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">defineProperty</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">拦截触发</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">_name</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;目标对象&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">age</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">18</span><span class="ct-1c9fee">} </span><span class="ct-21e7f5">_name</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;hello world&quot;</span><span class="ct-1c9fee">}
</span></span><span class="line" line="4"><span class="ct-8d33ce">&quot;hello world&quot;
</span></span><span class="line" line="5"><span class="ct-21e7f5">defaultProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee"> = </span><span class="ct-d6cb1c">3
</span></span><span class="line" line="6"><span class="ct-21e7f5">defaultProxy</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">defineProperty</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">拦截触发</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">_name</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;hello world&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">age</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">18</span><span class="ct-1c9fee">} </span><span class="ct-21e7f5">age</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">}
</span></span><span class="line" line="7"><span class="ct-d6cb1c">3</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->下面执行实现行为<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-21e7f5">customProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee"> = </span><span class="ct-8d33ce">&#39;hello world&#39;
</span></span><span class="line" line="2"><span class="ct-21e7f5">Proxy</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">_name</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;目标对象&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">age</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">18</span><span class="ct-1c9fee">}
</span></span><span class="line" line="3"><span class="ct-8d33ce">&quot;hello world&quot;
</span></span><span class="line" line="4"><span class="ct-21e7f5">customProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee"> = </span><span class="ct-d6cb1c">3
</span></span><span class="line" line="5"><span class="ct-d6cb1c">3</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->可以看出默认的代理行为在设置属性时会触发 defineProperty 拦截,而查看文档你会发现,触发 defineProperty 拦截的行为有<!--]--></p><ul><!--[--><li><!--[-->Object.defineProperty()<!--]--></li><li><!--[-->Reflect.defineProperty()<br>
这里没有提到对象属性赋值也会触发 defineProperty 拦截,那这个触发行为应该是 set 默认行为所触发,如果要实现该默认行为也需要在 set 拦截中去实现。
仔细分析以上的输出可以发现,触发 defineProperty 拦截的属性是 <code class="prose-code-inline" data-v-39cc8780><!--[-->_name<!--]--></code> 和 <code class="prose-code-inline" data-v-39cc8780><!--[-->age<!--]--></code>,并没有 <code class="prose-code-inline" data-v-39cc8780><!--[-->name<!--]--></code>, <code class="prose-code-inline" data-v-39cc8780><!--[-->_name<!--]--></code> 是因为在设置 name 属性时在对应的 setter 函数执行时进行赋值的,从而执行对应的拦截函数,也就是在设置数据属性时会触发 defineProperty 拦截,而设置存取性属性时并不会触发 defineProperty 拦截。<!--]--></li><!--]--></ul><h3 class="title" id="修复数据属性" data-v-d3792100><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#修复数据属性" class="router-link-active router-link-exact-active link" data-v-d3792100><span class="content" data-v-d3792100><!--[-->修复数据属性<!--]--></span><span class="symbol" data-v-d3792100>#</span></a></h3><p class="prose-p" data-v-4aba2c1d><!--[-->基于上面的分析,让 set 拦截触发 defineProperty 拦截<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-bf5eb0">set</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">) {
</span></span><span class="line" line="2"><span class="ct-1c9fee">  </span><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">descriptor</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">getOwnPropertyDescriptor</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">)
</span></span><span class="line" line="3"><span class="ct-1c9fee">  </span><span class="ct-2c3fbe">if</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;set&#39;</span><span class="ct-1c9fee">)) {
</span></span><span class="line" line="4"><span class="ct-1c9fee">    </span><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">setter</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">set
</span></span><span class="line" line="5"><span class="ct-1c9fee">    </span><span class="ct-2c3fbe">if</span><span class="ct-1c9fee">(</span><span class="ct-829377">typeof</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">setter</span><span class="ct-1c9fee"> === </span><span class="ct-8d33ce">&#39;function&#39;</span><span class="ct-1c9fee"> ) {
</span></span><span class="line" line="6"><span class="ct-1c9fee">      </span><span class="ct-21e7f5">setter</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">call</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">)
</span></span><span class="line" line="7"><span class="ct-1c9fee">    }
</span></span><span class="line" line="8"><span class="ct-1c9fee">  } </span><span class="ct-2c3fbe">else</span><span class="ct-1c9fee"> {
</span></span><span class="line" line="9"><span class="ct-1c9fee">    </span><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">defineProperty</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">, {
</span></span><span class="line" line="10"><span class="ct-1c9fee">      </span><span class="ct-21e7f5">value:</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">value
</span></span><span class="line" line="11"><span class="ct-1c9fee">    })
</span></span><span class="line" line="12"><span class="ct-1c9fee">  }
</span></span><span class="line" line="13"><span class="ct-1c9fee">},</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->再次运行测试<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-21e7f5">customProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee"> = </span><span class="ct-8d33ce">&#39;hello world&#39;
</span></span><span class="line" line="2"><span class="ct-21e7f5">Proxy</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">_name</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;目标对象&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">age</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">18</span><span class="ct-1c9fee">}
</span></span><span class="line" line="3"><span class="ct-21e7f5">cunstomProxy</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">defineProperty</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">拦截触发</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">_name</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;目标对象&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">age</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">18</span><span class="ct-1c9fee">} </span><span class="ct-21e7f5">_name</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;hello world&quot;</span><span class="ct-1c9fee">}
</span></span><span class="line" line="4"><span class="ct-8d33ce">&quot;hello world&quot;
</span></span><span class="line" line="5"><span class="ct-21e7f5">customProxy</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee"> = </span><span class="ct-d6cb1c">3
</span></span><span class="line" line="6"><span class="ct-21e7f5">cunstomProxy</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">defineProperty</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">拦截触发</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">_name</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;hello world&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">age</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">18</span><span class="ct-1c9fee">} </span><span class="ct-21e7f5">age</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">}
</span></span><span class="line" line="7"><span class="ct-d6cb1c">3</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->以上的测试都是在修改已经存在的属性,如果增加属性, <code class="prose-code-inline" data-v-39cc8780><!--[-->Object.getOwnPropertyDescriptor(target, key)<!--]--></code> 会返回 undefined,执行 hasOwnProperty 方法是会报错的。<br>
当一个属性使用对象属性赋值的方式设置时,会默认设置为数据属性,而且是可枚举可配置和可写的。<br>
而且还有一点 Object.defineProperty 这个方法设置属性时,如果属性是新属性,那些忽略设置的描述属性都默认为 false 或者是 undefined,如果是已经存在的属性,忽略设置的描述属性取原来的值,例如<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-829377">let</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">o</span><span class="ct-1c9fee"> = {}
</span></span><span class="line" line="2"><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">defineProperty</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">o</span><span class="ct-1c9fee">, </span><span class="ct-8d33ce">&#39;value&#39;</span><span class="ct-1c9fee">, { </span><span class="ct-21e7f5">value:</span><span class="ct-1c9fee"> </span><span class="ct-8d33ce">&#39;2&#39;</span><span class="ct-1c9fee">})
</span></span><span class="line" line="3"><span class="ct-1c9fee">{</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;2&quot;</span><span class="ct-1c9fee">}
</span></span><span class="line" line="4"><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">getOwnPropertyDescriptor</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">o</span><span class="ct-1c9fee">, </span><span class="ct-8d33ce">&#39;value&#39;</span><span class="ct-1c9fee">)
</span></span><span class="line" line="5"><span class="ct-1c9fee">{</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;2&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">writable</span><span class="ct-1c9fee">: </span><span class="ct-829377">false</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">enumerable</span><span class="ct-1c9fee">: </span><span class="ct-829377">false</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">configurable</span><span class="ct-1c9fee">: </span><span class="ct-829377">false</span><span class="ct-1c9fee">}
</span></span><span class="line" line="6"><span class="ct-21e7f5">o</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee"> = </span><span class="ct-8d33ce">&#39;hh&#39;
</span></span><span class="line" line="7"><span class="ct-8d33ce">&quot;hh&quot;
</span></span><span class="line" line="8"><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">getOwnPropertyDescriptor</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">o</span><span class="ct-1c9fee">, </span><span class="ct-8d33ce">&#39;name&#39;</span><span class="ct-1c9fee">)
</span></span><span class="line" line="9"><span class="ct-1c9fee">{</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;hh&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">writable</span><span class="ct-1c9fee">: </span><span class="ct-829377">true</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">enumerable</span><span class="ct-1c9fee">: </span><span class="ct-829377">true</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">configurable</span><span class="ct-1c9fee">: </span><span class="ct-829377">true</span><span class="ct-1c9fee">}</span><span class="ct-8d0700">configurable</span><span class="ct-1c9fee">: </span><span class="ct-8d0700">trueenumerable</span><span class="ct-1c9fee">: </span><span class="ct-8d0700">truevalue</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;hh&quot;</span><span class="ct-8d0700">writable</span><span class="ct-1c9fee">: </span><span class="ct-8d0700">true__proto__</span><span class="ct-1c9fee">: </span><span class="ct-21e7f5">Object
</span></span><span class="line" line="10"><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">defineProperty</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">o</span><span class="ct-1c9fee">, </span><span class="ct-8d33ce">&#39;name&#39;</span><span class="ct-1c9fee">, { </span><span class="ct-21e7f5">value:</span><span class="ct-1c9fee"> </span><span class="ct-8d33ce">&#39;3&#39;</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">enumerable:</span><span class="ct-1c9fee"> </span><span class="ct-829377">false</span><span class="ct-1c9fee">})
</span></span><span class="line" line="11"><span class="ct-1c9fee">{</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;2&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">name</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;3&quot;</span><span class="ct-1c9fee">}
</span></span><span class="line" line="12"><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">getOwnPropertyDescriptor</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">o</span><span class="ct-1c9fee">, </span><span class="ct-8d33ce">&#39;name&#39;</span><span class="ct-1c9fee">)
</span></span><span class="line" line="13"><span class="ct-1c9fee">{</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;3&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">writable</span><span class="ct-1c9fee">: </span><span class="ct-829377">true</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">enumerable</span><span class="ct-1c9fee">: </span><span class="ct-829377">false</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">configurable</span><span class="ct-1c9fee">: </span><span class="ct-829377">true</span><span class="ct-1c9fee">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->基于这些要求重新修改 set 实现<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-bf5eb0">set</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">) {
</span></span><span class="line" line="2"><span class="ct-1c9fee">  </span><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">descriptor</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">getOwnPropertyDescriptor</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">)
</span></span><span class="line" line="3"><span class="ct-1c9fee">  </span><span class="ct-2c3fbe">if</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee"> &amp;&amp; </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;set&#39;</span><span class="ct-1c9fee">)) {
</span></span><span class="line" line="4"><span class="ct-1c9fee">    </span><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">setter</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">set
</span></span><span class="line" line="5"><span class="ct-1c9fee">    </span><span class="ct-2c3fbe">if</span><span class="ct-1c9fee">(</span><span class="ct-829377">typeof</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">setter</span><span class="ct-1c9fee"> === </span><span class="ct-8d33ce">&#39;function&#39;</span><span class="ct-1c9fee"> ) {
</span></span><span class="line" line="6"><span class="ct-1c9fee">      </span><span class="ct-21e7f5">setter</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">call</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">)
</span></span><span class="line" line="7"><span class="ct-1c9fee">    }
</span></span><span class="line" line="8"><span class="ct-1c9fee">  } </span><span class="ct-2c3fbe">else</span><span class="ct-1c9fee"> {
</span></span><span class="line" line="9"><span class="ct-1c9fee">    </span><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">defineProperty</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">receiver</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">key</span><span class="ct-1c9fee">, </span><span class="ct-21e7f5">descriptor</span><span class="ct-1c9fee"> ? {
</span></span><span class="line" line="10"><span class="ct-1c9fee">      </span><span class="ct-21e7f5">value:</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">, </span><span class="ct-a6c5fd">// 为保持和默认行为一致,不能修改 descriptor.value 后把 descriptor 返回
</span></span><span class="line" line="11"><span class="ct-1c9fee">    } : {
</span></span><span class="line" line="12"><span class="ct-1c9fee">      </span><span class="ct-21e7f5">value:</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">value</span><span class="ct-1c9fee">,
</span></span><span class="line" line="13"><span class="ct-1c9fee">      </span><span class="ct-21e7f5">writable:</span><span class="ct-1c9fee"> </span><span class="ct-829377">true</span><span class="ct-1c9fee">,
</span></span><span class="line" line="14"><span class="ct-1c9fee">      </span><span class="ct-21e7f5">enumerable:</span><span class="ct-1c9fee"> </span><span class="ct-829377">true</span><span class="ct-1c9fee">,
</span></span><span class="line" line="15"><span class="ct-1c9fee">      </span><span class="ct-21e7f5">configurable:</span><span class="ct-1c9fee"> </span><span class="ct-829377">true
</span></span><span class="line" line="16"><span class="ct-1c9fee">    })
</span></span><span class="line" line="17"><span class="ct-1c9fee">  }
</span></span><span class="line" line="18"><span class="ct-1c9fee">},</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><h3 class="title" id="defineproperty-拦截的作用" data-v-d3792100><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#defineproperty-拦截的作用" class="router-link-active router-link-exact-active link" data-v-d3792100><span class="content" data-v-d3792100><!--[-->defineProperty 拦截的作用<!--]--></span><span class="symbol" data-v-d3792100>#</span></a></h3><p class="prose-p" data-v-4aba2c1d><!--[-->基于上面的实现,也实现了在代理对象作用原型对象时,把数据属性设置在子类实例身上。
看下面的例子<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">children</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">create</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">);
</span></span><span class="line" line="2"><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee"> = </span><span class="ct-8d33ce">&#39;hello world&#39;</span><span class="ct-1c9fee">;
</span></span><span class="line" line="3"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;name&#39;</span><span class="ct-1c9fee">)); </span><span class="ct-a6c5fd">// false
</span></span><span class="line" line="4"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;_name&#39;</span><span class="ct-1c9fee">)); </span><span class="ct-a6c5fd">// true
</span></span><span class="line" line="5"><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee"> = </span><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">;
</span></span><span class="line" line="6"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;age&#39;</span><span class="ct-1c9fee">)); </span><span class="ct-a6c5fd">// true
</span></span><span class="line" line="7"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee">); </span><span class="ct-a6c5fd">// 3
</span></span><span class="line" line="8"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee">); </span><span class="ct-a6c5fd">// 18
</span></span><span class="line" line="9"><span>
</span></span><span class="line" line="10"><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">children2</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">create</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">defaultProxy</span><span class="ct-1c9fee">);
</span></span><span class="line" line="11"><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee"> = </span><span class="ct-8d33ce">&#39;hello world&#39;</span><span class="ct-1c9fee">;
</span></span><span class="line" line="12"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;name&#39;</span><span class="ct-1c9fee">)); </span><span class="ct-a6c5fd">// false
</span></span><span class="line" line="13"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;_name&#39;</span><span class="ct-1c9fee">)); </span><span class="ct-a6c5fd">// true
</span></span><span class="line" line="14"><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee"> = </span><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">;
</span></span><span class="line" line="15"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;age&#39;</span><span class="ct-1c9fee">)); </span><span class="ct-a6c5fd">// true
</span></span><span class="line" line="16"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee">); </span><span class="ct-a6c5fd">// 3
</span></span><span class="line" line="17"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">age</span><span class="ct-1c9fee">); </span><span class="ct-a6c5fd">// 18
</span></span><span class="line" line="18"><span>
</span></span><span class="line" line="19"><span class="ct-829377">const</span><span class="ct-1c9fee"> </span><span class="ct-fecd60">children3</span><span class="ct-1c9fee"> = </span><span class="ct-21e7f5">Object</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">create</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">customProxy</span><span class="ct-1c9fee">);
</span></span><span class="line" line="20"><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-21e7f5">name</span><span class="ct-1c9fee"> = </span><span class="ct-8d33ce">&#39;hello world&#39;</span><span class="ct-1c9fee">;
</span></span><span class="line" line="21"><span class="ct-21e7f5">console</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">log</span><span class="ct-10f473">(</span><span class="ct-a18c13">children</span><span class="ct-10f473">.</span><span class="ct-020411">hasOwnProperty</span><span class="ct-10f473">(</span><span class="ct-083033">&#39;name&#39;</span><span class="ct-10f473">)); </span><span class="ct-dd5b39">// false
</span></span><span class="line" line="22"><span class="ct-a18c13">console</span><span class="ct-10f473">.</span><span class="ct-020411">log</span><span class="ct-10f473">(</span><span class="ct-a18c13">children</span><span class="ct-10f473">.</span><span class="ct-020411">hasOwnProperty</span><span class="ct-10f473">(</span><span class="ct-083033">&#39;_name&#39;</span><span class="ct-10f473">)); </span><span class="ct-dd5b39">// true
</span></span><span class="line" line="23"><span class="ct-a18c13">children</span><span class="ct-10f473">.</span><span class="ct-a18c13">age</span><span class="ct-10f473"> = </span><span class="ct-91a694">3</span><span class="ct-10f473">;
</span></span><span class="line" line="24"><span class="ct-a18c13">console</span><span class="ct-10f473">.</span><span class="ct-020411">log</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">children</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">hasOwnProperty</span><span class="ct-1c9fee">(</span><span class="ct-8d33ce">&#39;age&#39;</span><span class="ct-1c9fee">)); </span><span class="ct-a6c5fd">// true
</span></span><span class="line" line="25"><span class="ct-a18c13">console</span><span class="ct-10f473">.</span><span class="ct-020411">log</span><span class="ct-10f473">(</span><span class="ct-a18c13">children</span><span class="ct-10f473">.</span><span class="ct-a18c13">age</span><span class="ct-10f473">); </span><span class="ct-dd5b39">// 3
</span></span><span class="line" line="26"><span class="ct-a18c13">console</span><span class="ct-10f473">.</span><span class="ct-020411">log</span><span class="ct-10f473">(</span><span class="ct-a18c13">target</span><span class="ct-10f473">.</span><span class="ct-a18c13">age</span><span class="ct-10f473">); </span><span class="ct-dd5b39">// 18</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->当代理对象在原型链上时,子类实例设置属性时,一样会触发代理的拦截行为,这个时候 receiver 参数的值表示的是子类实例,也就是这里的 children,如果 children 设置的属性是存取器属性默认会调用原型链对象中对应属性的 getter setter 函数,而并不会设置在 children 身上。如果是新属性或者是数据属性,那么会设置在自身身上,并不会修改原型链上的属性。如果不采用 defineProperty 进行设置,直接通过 <code class="prose-code-inline" data-v-39cc8780><!--[--> receiver[key] = value<!--]--></code> 来实现,就会出现无限递归。<br>
数据属性和存取器属性都修复了,还有什么问题吗<!--]--></p><h2 class="title" id="invariants" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#invariants" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->Invariants<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->如果你有看文档,你会发现每一个拦截操作中都有一个 Invariants,中文翻译为不变式。我的理解就是对拦截行为的限制,如果你的拦截行为超出了限制,就会报 TypeError<br>
先来看看 set 拦截的限制<!--]--></p><ul><!--[--><li><!--[-->Cannot change the value of a property to be different from the value of the corresponding target object property if the corresponding target object property is a non-writable, non-configurable data property.
这条限制是针对数据属性的,如果设置的对象属性是非可配置和非可读的,那么拦截函数不能返回 true<!--]--></li><li><!--[-->Cannot set the value of a property if the corresponding target object property is a non-configurable accessor property that has undefined as its [[Set]] attribute
这条限制是针对存取器属性的,如果设置的对象属性是非可配置且 set 为 undefined,,那么拦截函数不能返回 true<!--]--></li><li><!--[-->In strict mode, a false return value from the set() handler will throw a TypeError exception.
前两条都表明该属性如果是只读属性,就应该是不能修改的,最后一条就是在严格模式下如果返回 false 会触发报错<!--]--></li><!--]--></ul><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-6aa0d0">const</span><span class="ct-10f473"> </span><span class="ct-6cd240">o</span><span class="ct-10f473"> = {};
</span></span><span class="line" line="2"><span class="ct-a18c13">Object</span><span class="ct-10f473">.</span><span class="ct-020411">defineProperty</span><span class="ct-10f473">(</span><span class="ct-a18c13">o</span><span class="ct-10f473">, </span><span class="ct-083033">&#39;level&#39;</span><span class="ct-10f473">, {
</span></span><span class="line" line="3"><span class="ct-10f473">  </span><span class="ct-a18c13">value:</span><span class="ct-10f473"> </span><span class="ct-91a694">5</span><span class="ct-10f473"> </span><span class="ct-dd5b39">// 没有设置的描述属性均为 false
</span></span><span class="line" line="4"><span class="ct-10f473">});
</span></span><span class="line" line="5"><span class="ct-a18c13">Object</span><span class="ct-10f473">.</span><span class="ct-020411">defineProperty</span><span class="ct-10f473">(</span><span class="ct-a18c13">o</span><span class="ct-10f473">, </span><span class="ct-083033">&#39;grade&#39;</span><span class="ct-10f473">, {
</span></span><span class="line" line="6"><span class="ct-10f473">  </span><span class="ct-a18c13">set:</span><span class="ct-10f473"> </span><span class="ct-6aa0d0">undefined</span><span class="ct-10f473"> </span><span class="ct-dd5b39">// 没有设置的描述属性均为 false, get 为 undefined
</span></span><span class="line" line="7"><span class="ct-10f473">});
</span></span><span class="line" line="8"><span class="ct-6aa0d0">const</span><span class="ct-10f473"> </span><span class="ct-6cd240">proxy</span><span class="ct-10f473"> = </span><span class="ct-6aa0d0">new</span><span class="ct-10f473"> </span><span class="ct-020411">Proxy</span><span class="ct-10f473">(</span><span class="ct-a18c13">o</span><span class="ct-10f473">, {
</span></span><span class="line" line="9"><span class="ct-10f473">  </span><span class="ct-020411">set</span><span class="ct-10f473">() {
</span></span><span class="line" line="10"><span class="ct-10f473">    </span><span class="ct-8b8177">return</span><span class="ct-10f473"> </span><span class="ct-6aa0d0">true</span><span class="ct-10f473">; </span><span class="ct-dd5b39">// 强行认为可以修改,就会触发拦截行为限制错误
</span></span><span class="line" line="11"><span class="ct-10f473">  }
</span></span><span class="line" line="12"><span class="ct-10f473">});
</span></span><span class="line" line="13"><span class="ct-dd5b39">// proxy.level = 666 // Uncaught TypeError: &#39;set&#39; on proxy: trap returned truish for property &#39;level&#39; which exists in the proxy target as a non-configurable and non-writable data property with a different value
</span></span><span class="line" line="14"><span class="ct-dd5b39">// proxy.grade = 666 // Uncaught TypeError: &#39;set&#39; on proxy: trap returned truish for property &#39;grade&#39; which exists in the proxy target as a non-configurable and non-writable accessor property without a setter
</span></span><span class="line" line="15"><span>
</span></span><span class="line" line="16"><span class="ct-6aa0d0">void</span><span class="ct-10f473"> (</span><span class="ct-6aa0d0">function</span><span class="ct-10f473"> () {
</span></span><span class="line" line="17"><span class="ct-10f473">  </span><span class="ct-083033">&#39;use strict&#39;</span><span class="ct-10f473">;
</span></span><span class="line" line="18"><span class="ct-10f473">  </span><span class="ct-6aa0d0">const</span><span class="ct-10f473"> </span><span class="ct-6cd240">proxy2</span><span class="ct-10f473"> = </span><span class="ct-6aa0d0">new</span><span class="ct-10f473"> </span><span class="ct-020411">Proxy</span><span class="ct-10f473">(</span><span class="ct-a18c13">o</span><span class="ct-10f473">, {
</span></span><span class="line" line="19"><span class="ct-10f473">    </span><span class="ct-020411">set</span><span class="ct-10f473">() {
</span></span><span class="line" line="20"><span class="ct-10f473">      </span><span class="ct-8b8177">return</span><span class="ct-10f473"> </span><span class="ct-6aa0d0">false</span><span class="ct-10f473">;
</span></span><span class="line" line="21"><span class="ct-10f473">    }
</span></span><span class="line" line="22"><span class="ct-10f473">  });
</span></span><span class="line" line="23"><span class="ct-10f473">  </span><span class="ct-a18c13">proxy2</span><span class="ct-10f473">.</span><span class="ct-a18c13">a</span><span class="ct-10f473"> = </span><span class="ct-91a694">1</span><span class="ct-10f473">;
</span></span><span class="line" line="24"><span class="ct-10f473">  </span><span class="ct-a18c13">console</span><span class="ct-10f473">.</span><span class="ct-020411">log</span><span class="ct-10f473">(</span><span class="ct-a18c13">o</span><span class="ct-10f473">); </span><span class="ct-dd5b39">// Uncaught TypeError: &#39;set&#39; on proxy: trap returned falsish for property &#39;a&#39;
</span></span><span class="line" line="25"><span class="ct-10f473">})();</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->如果要正确触发这类默认行为,那么在实现中需要正确 return 设置是否成功的信息,这里可能有点难理解,可以看看这个例子<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-6aa0d0">const</span><span class="ct-10f473"> </span><span class="ct-6cd240">o</span><span class="ct-10f473"> = {};
</span></span><span class="line" line="2"><span class="ct-a18c13">Object</span><span class="ct-10f473">.</span><span class="ct-020411">defineProperty</span><span class="ct-10f473">(</span><span class="ct-a18c13">o</span><span class="ct-10f473">, </span><span class="ct-083033">&#39;level&#39;</span><span class="ct-10f473">, {
</span></span><span class="line" line="3"><span class="ct-10f473">  </span><span class="ct-a18c13">value:</span><span class="ct-10f473"> </span><span class="ct-91a694">5</span><span class="ct-10f473"> </span><span class="ct-dd5b39">// 没有设置的描述属性均为 false
</span></span><span class="line" line="4"><span class="ct-10f473">});
</span></span><span class="line" line="5"><span class="ct-6aa0d0">const</span><span class="ct-10f473"> </span><span class="ct-6cd240">proxy</span><span class="ct-10f473"> = </span><span class="ct-6aa0d0">new</span><span class="ct-10f473"> </span><span class="ct-020411">Proxy</span><span class="ct-10f473">(</span><span class="ct-a18c13">o</span><span class="ct-10f473">, {});
</span></span><span class="line" line="6"><span class="ct-a18c13">proxy</span><span class="ct-10f473">.</span><span class="ct-a18c13">level</span><span class="ct-10f473"> = </span><span class="ct-91a694">6</span><span class="ct-10f473">;</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->这个并不会报错,因为默认行为知道了这个是不能设置的,因此默认拦截函数就返回了 false,因此你如果要实现默认行为,也需要返回一个正确设置与否的信息。不能设置就应该返回 false,可以设置就应该返回 true。<!--]--></p><h3 class="title" id="返回设置信息" data-v-d3792100><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#返回设置信息" class="router-link-active router-link-exact-active link" data-v-d3792100><span class="content" data-v-d3792100><!--[-->返回设置信息<!--]--></span><span class="symbol" data-v-d3792100>#</span></a></h3><p class="prose-p" data-v-4aba2c1d><!--[-->基于这点我们再来看看有返回时的实现<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-020411">set</span><span class="ct-10f473">(</span><span class="ct-a18c13">target</span><span class="ct-10f473">, </span><span class="ct-a18c13">key</span><span class="ct-10f473">, </span><span class="ct-a18c13">value</span><span class="ct-10f473">, </span><span class="ct-a18c13">receiver</span><span class="ct-10f473">) {
</span></span><span class="line" line="2"><span class="ct-6aa0d0">const</span><span class="ct-10f473"> </span><span class="ct-6cd240">descriptor</span><span class="ct-10f473"> = </span><span class="ct-a18c13">Object</span><span class="ct-10f473">.</span><span class="ct-020411">getOwnPropertyDescriptor</span><span class="ct-10f473">(</span><span class="ct-a18c13">target</span><span class="ct-10f473">, </span><span class="ct-a18c13">key</span><span class="ct-10f473">)
</span></span><span class="line" line="3"><span class="ct-8b8177">if</span><span class="ct-10f473"> (</span><span class="ct-6aa0d0">typeof</span><span class="ct-10f473"> </span><span class="ct-a18c13">descriptor</span><span class="ct-10f473"> === </span><span class="ct-083033">&#39;object&#39;</span><span class="ct-10f473">) {
</span></span><span class="line" line="4"><span class="ct-10f473">  </span><span class="ct-8b8177">if</span><span class="ct-10f473">(</span><span class="ct-a18c13">descriptor</span><span class="ct-10f473">.</span><span class="ct-a18c13">configurable</span><span class="ct-10f473"> === </span><span class="ct-083033">&#39;false&#39;</span><span class="ct-10f473"> &amp;&amp; (</span><span class="ct-a18c13">descriptor</span><span class="ct-10f473">.</span><span class="ct-a18c13">writable</span><span class="ct-10f473"> === </span><span class="ct-083033">&#39;false&#39;</span><span class="ct-10f473"> || </span><span class="ct-a18c13">descriptor</span><span class="ct-10f473">.</span><span class="ct-a18c13">set</span><span class="ct-10f473"> === </span><span class="ct-083033">&#39;undefined&#39;</span><span class="ct-10f473">)) {
</span></span><span class="line" line="5"><span class="ct-10f473">    </span><span class="ct-8b8177">return</span><span class="ct-10f473"> </span><span class="ct-6aa0d0">false
</span></span><span class="line" line="6"><span class="ct-10f473">  }
</span></span><span class="line" line="7"><span class="ct-10f473">}
</span></span><span class="line" line="8"><span class="ct-8b8177">if</span><span class="ct-10f473">(</span><span class="ct-a18c13">descriptor</span><span class="ct-10f473"> &amp;&amp; </span><span class="ct-a18c13">descriptor</span><span class="ct-10f473">.</span><span class="ct-020411">hasOwnProperty</span><span class="ct-10f473">(</span><span class="ct-083033">&#39;set&#39;</span><span class="ct-10f473">)) {
</span></span><span class="line" line="9"><span class="ct-10f473">  </span><span class="ct-6aa0d0">const</span><span class="ct-10f473"> </span><span class="ct-6cd240">setter</span><span class="ct-10f473"> = </span><span class="ct-a18c13">descriptor</span><span class="ct-10f473">.</span><span class="ct-a18c13">set
</span></span><span class="line" line="10"><span class="ct-10f473">  </span><span class="ct-8b8177">if</span><span class="ct-10f473">(</span><span class="ct-6aa0d0">typeof</span><span class="ct-10f473"> </span><span class="ct-a18c13">setter</span><span class="ct-10f473"> === </span><span class="ct-083033">&#39;function&#39;</span><span class="ct-10f473"> ) {
</span></span><span class="line" line="11"><span class="ct-10f473">    </span><span class="ct-a18c13">setter</span><span class="ct-10f473">.</span><span class="ct-020411">call</span><span class="ct-10f473">(</span><span class="ct-a18c13">receiver</span><span class="ct-10f473">, </span><span class="ct-a18c13">value</span><span class="ct-10f473">)
</span></span><span class="line" line="12"><span class="ct-10f473">    </span><span class="ct-8b8177">return</span><span class="ct-10f473"> </span><span class="ct-6aa0d0">true
</span></span><span class="line" line="13"><span class="ct-10f473">  }
</span></span><span class="line" line="14"><span class="ct-10f473">} </span><span class="ct-8b8177">else</span><span class="ct-10f473"> {
</span></span><span class="line" line="15"><span class="ct-10f473">  </span><span class="ct-a18c13">Object</span><span class="ct-10f473">.</span><span class="ct-020411">defineProperty</span><span class="ct-10f473">(</span><span class="ct-a18c13">receiver</span><span class="ct-10f473">, </span><span class="ct-a18c13">key</span><span class="ct-10f473">, </span><span class="ct-a18c13">descriptor</span><span class="ct-10f473"> ? {
</span></span><span class="line" line="16"><span class="ct-10f473">  </span><span class="ct-a18c13">value:</span><span class="ct-10f473"> </span><span class="ct-a18c13">value</span><span class="ct-10f473">, </span><span class="ct-dd5b39">// 为保持和默认行为一致,不能修改 descriptor.value 后把 descriptor 返回
</span></span><span class="line" line="17"><span class="ct-10f473">  } : {
</span></span><span class="line" line="18"><span class="ct-10f473">    </span><span class="ct-a18c13">value:</span><span class="ct-10f473"> </span><span class="ct-a18c13">value</span><span class="ct-10f473">,
</span></span><span class="line" line="19"><span class="ct-10f473">    </span><span class="ct-a18c13">writable:</span><span class="ct-10f473"> </span><span class="ct-6aa0d0">true</span><span class="ct-10f473">,
</span></span><span class="line" line="20"><span class="ct-10f473">    </span><span class="ct-a18c13">enumerable:</span><span class="ct-10f473"> </span><span class="ct-6aa0d0">true</span><span class="ct-10f473">,
</span></span><span class="line" line="21"><span class="ct-10f473">    </span><span class="ct-a18c13">configurable:</span><span class="ct-10f473"> </span><span class="ct-6aa0d0">true
</span></span><span class="line" line="22"><span class="ct-10f473">  })
</span></span><span class="line" line="23"><span class="ct-10f473">  </span><span class="ct-8b8177">return</span><span class="ct-10f473"> </span><span class="ct-6aa0d0">true
</span></span><span class="line" line="24"><span class="ct-10f473">}
</span></span><span class="line" line="25"><span class="ct-10f473">},</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->下面测试一下<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-a18c13">Object</span><span class="ct-10f473">.</span><span class="ct-020411">defineProperty</span><span class="ct-10f473">(</span><span class="ct-a18c13">target</span><span class="ct-10f473">, </span><span class="ct-083033">&#39;level&#39;</span><span class="ct-10f473">, {
</span></span><span class="line" line="2"><span class="ct-10f473">  </span><span class="ct-a18c13">value:</span><span class="ct-10f473"> </span><span class="ct-91a694">5
</span></span><span class="line" line="3"><span class="ct-10f473">});
</span></span><span class="line" line="4"><span class="ct-6aa0d0">void</span><span class="ct-10f473"> (</span><span class="ct-6aa0d0">function</span><span class="ct-10f473"> () {
</span></span><span class="line" line="5"><span class="ct-10f473">  </span><span class="ct-083033">&#39;use strict&#39;</span><span class="ct-10f473">;
</span></span><span class="line" line="6"><span class="ct-10f473">  </span><span class="ct-a18c13">defaultProxy</span><span class="ct-10f473">.</span><span class="ct-a18c13">level</span><span class="ct-10f473"> = </span><span class="ct-91a694">6</span><span class="ct-10f473">; </span><span class="ct-dd5b39">//Uncaught TypeError: Cannot assign to read only property &#39;level&#39; of object &#39;[object Object]&#39;
</span></span><span class="line" line="7"><span class="ct-10f473">})();
</span></span><span class="line" line="8"><span class="ct-6aa0d0">void</span><span class="ct-10f473"> (</span><span class="ct-6aa0d0">function</span><span class="ct-10f473"> () {
</span></span><span class="line" line="9"><span class="ct-10f473">  </span><span class="ct-083033">&#39;use strict&#39;</span><span class="ct-10f473">;
</span></span><span class="line" line="10"><span class="ct-10f473">  </span><span class="ct-a18c13">customProxy</span><span class="ct-10f473">.</span><span class="ct-a18c13">level</span><span class="ct-10f473"> = </span><span class="ct-91a694">6</span><span class="ct-10f473">; </span><span class="ct-dd5b39">// Uncaught TypeError: &#39;set&#39; on proxy: trap returned falsish for property &#39;level&#39;
</span></span><span class="line" line="11"><span class="ct-10f473">})();</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->虽然都按期望那样报错了,但是报错的内容不同,很明显默认行为还执行了其他的操作。<!--]--></p><h2 class="title" id="总结" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#总结" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->总结<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><p class="prose-p" data-v-4aba2c1d><!--[-->最后,其实还是没有实现 set 的真实默认行为,但是通过这个例子,也可以清楚了解到,要模拟真实的默认拦截行为是很复杂的,而 Reflect 设计出来就是为了解决这样的难题。<br>
下面就是正确的实现<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-020411">set</span><span class="ct-10f473">(</span><span class="ct-a18c13">target</span><span class="ct-10f473">, </span><span class="ct-a18c13">key</span><span class="ct-10f473">, </span><span class="ct-a18c13">value</span><span class="ct-10f473">, </span><span class="ct-a18c13">receiver</span><span class="ct-10f473">) {
</span></span><span class="line" line="2"><span class="ct-10f473">  </span><span class="ct-8b8177">return</span><span class="ct-10f473"> </span><span class="ct-a18c13">Reflect</span><span class="ct-10f473">.</span><span class="ct-020411">set</span><span class="ct-10f473">(</span><span class="ct-a18c13">target</span><span class="ct-10f473">, </span><span class="ct-a18c13">key</span><span class="ct-10f473">, </span><span class="ct-a18c13">value</span><span class="ct-10f473">, </span><span class="ct-a18c13">receiver</span><span class="ct-10f473">)
</span></span><span class="line" line="3"><span class="ct-10f473">}</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->如果使用了拦截函数,并需要执行默认行为,如果要保持代码的健壮性,传入的参数都需要全部传入到 Reflect 对象内,如果漏掉 receiver, receiver 会被当做第一个参数,这样就不会触发 defineProperty 拦截,这个就违背了默认行为<!--]--></p><div class="lang prose-code"><div class="file-info">js</div><!--[--><pre><code><span class="line" line="1"><span class="ct-a18c13">Reflect</span><span class="ct-1c9fee">.</span><span class="ct-bf5eb0">set</span><span class="ct-1c9fee">(</span><span class="ct-21e7f5">target</span><span class="ct-10f473">, </span><span class="ct-083033">&#39;age&#39;</span><span class="ct-10f473">, </span><span class="ct-91a694">3</span><span class="ct-10f473">)
</span></span><span class="line" line="2"><span class="ct-6aa0d0">true
</span></span><span class="line" line="3"><span class="ct-a18c13">Reflect</span><span class="ct-10f473">.</span><span class="ct-020411">set</span><span class="ct-10f473">(</span><span class="ct-a18c13">target</span><span class="ct-10f473">, </span><span class="ct-083033">&#39;age&#39;</span><span class="ct-10f473">, </span><span class="ct-91a694">3</span><span class="ct-10f473">, </span><span class="ct-a18c13">defaultProxy</span><span class="ct-10f473">)
</span></span><span class="line" line="4"><span class="ct-a18c13">defaultProxy</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">defineProperty</span><span class="ct-1c9fee"> </span><span class="ct-21e7f5">拦截触发</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">_name</span><span class="ct-1c9fee">: </span><span class="ct-8d33ce">&quot;目标对象&quot;</span><span class="ct-1c9fee">, </span><span class="ct-8d0700">age</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">} </span><span class="ct-21e7f5">age</span><span class="ct-1c9fee"> {</span><span class="ct-8d0700">value</span><span class="ct-1c9fee">: </span><span class="ct-d6cb1c">3</span><span class="ct-1c9fee">}
</span></span><span class="line" line="5"><span class="ct-829377">true</span></span></code></pre><!--]--><div title="复制" class="copy"><span></span></div></div><p class="prose-p" data-v-4aba2c1d><!--[-->还需要注意的是需要 return 该返回值,不然不会正确触发 Invariants 的限制行为<!--]--></p><p class="prose-p" data-v-4aba2c1d><!--[-->这里举的是 set 拦截的例子,其他的拦截例子,如果需要调用默认行为也都是同样的操作,注意两点<!--]--></p><ul><!--[--><li><!--[-->Reflect 中传入全部参数<!--]--></li><li><!--[-->return Reflect 的执行结果<!--]--></li><!--]--></ul><h2 class="title" id="参考" data-v-924fdd6f><a aria-current="page" href="/blog/articles/javascript/proxyandreflect#参考" class="router-link-active router-link-exact-active link" data-v-924fdd6f><span class="content" data-v-924fdd6f><!--[-->参考<!--]--></span><span class="symbol" data-v-924fdd6f>#</span></a></h2><ul><!--[--><li><!--[--><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set" rel="nofollow" target="_blank" class="prose-a"><!--[-->https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set<!--]--><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon external-icon" data-v-20b97dad><path fill="currentColor" d="M10 6v2H5v11h11v-5h2v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm11-3v8h-2V6.413l-7.793 7.794l-1.414-1.414L17.585 5H13V3h8z" data-v-20b97dad></path></svg></a><!--]--></li><li><!--[--><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/set" rel="nofollow" target="_blank" class="prose-a"><!--[-->https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/set<!--]--><svg xmlns="http://www.w3.org/2000/svg" width="0.8em" height="0.8em" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon external-icon" data-v-20b97dad><path fill="currentColor" d="M10 6v2H5v11h11v-5h2v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm11-3v8h-2V6.413l-7.793 7.794l-1.414-1.414L17.585 5H13V3h8z" data-v-20b97dad></path></svg></a><!--]--></li><!--]--></ul><style>.ct-dd5b39{color:#6A9955}
.ct-ed2b1b{color:#C8C8C8}
.ct-91a694{color:#B5CEA8}
.ct-8b8177{color:#C586C0}
.ct-020411{color:#DCDCAA}
.ct-083033{color:#CE9178}
.ct-a18c13{color:#9CDCFE}
.ct-6cd240{color:#4FC1FF}
.ct-10f473{color:#D4D4D4}
.ct-6aa0d0{color:#569CD6}</style></div><!--]--><nav class="nav" data-v-58a2f6cb><div class="nav-item nav-item-before" data-v-58a2f6cb><div class="dir-title" data-v-58a2f6cb>JavaScript</div><a href="/blog/articles/javascript/floatingpointlossprecision" class="link" data-v-58a2f6cb><span style="transform:scale(-1, 1);" data-v-58a2f6cb></span><span class="title" data-v-58a2f6cb>js 浮点数存储精度丢失原理</span></a></div><div class="nav-item nav-item-after" data-v-58a2f6cb><div class="dir-title" data-v-58a2f6cb>移动端</div><a href="/blog/articles/mobile/selfadaptiveanddpr" class="link" data-v-58a2f6cb><span class="title" data-v-58a2f6cb>真的，移动端尺寸自适应与 dpr 无关</span><span data-v-58a2f6cb></span></a></div></nav></div></main><aside style="display:none;" class="aside article-outline"><div class="aside-stick right-aside"><span></span></div></aside></div><footer><div class="to-top" style="display:none;"><span></span></div></footer><div class="nuxt-loading-indicator" style="position:fixed;top:0;right:0;left:0;pointer-events:none;width:auto;height:3px;opacity:0;background:repeating-linear-gradient(to right,#00dc82 0%,#34cdfe 50%,#0047e1 100%);background-size:Infinity% auto;transform:scaleX(0%);transform-origin:left;transition:transform 0.1s, height 0.4s, opacity 0.4s;z-index:999999;"></div><!--]--></div><script>window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c_,c$,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn,do0,dp,dq,dr,ds,dt,du,dv,dw,dx,dy,dz,dA,dB,dC,dD,dE,dF,dG,dH,dI,dJ,dK,dL,dM,dN,dO,dP,dQ,dR,dS,dT,dU,dV,dW,dX,dY,dZ,d_,d$,ea,eb){return {data:{"search-navigation":[{title:cC,_path:cD,children:[{title:cE,_path:cF,children:[{title:cG,_path:cH},{title:cI,_path:cJ},{title:cK,_path:cL}]},{title:cM,_path:cN,children:[{title:cO,_path:cP},{title:cQ,_path:cR},{title:cS,_path:cT},{title:bZ,_path:b_}]},{title:cU,_path:cV,children:[{title:cW,_path:cX}]}]},{title:cY,_path:cZ,children:[{title:c_,_path:c$,children:[{title:bz,_path:da},{title:bA,_path:db}]},{title:dc,_path:dd,children:[{title:bz,_path:de},{title:bA,_path:df}]}]},{title:dg,_path:dh},{title:b$,_path:di},{title:dj,_path:dk,children:[{title:dl,_path:dm},{title:dn,_path:do0}]}],"content-navigation-8C37fagqQL":[{title:cC,_path:cD,children:[{title:cE,_path:cF,children:[{title:cG,_path:cH},{title:cI,_path:cJ},{title:cK,_path:cL}]},{title:cM,_path:cN,children:[{title:cO,_path:cP},{title:cQ,_path:cR},{title:cS,_path:cT},{title:bZ,_path:b_}]},{title:cU,_path:cV,children:[{title:cW,_path:cX}]}]},{title:cY,_path:cZ,children:[{title:c_,_path:c$,children:[{title:bz,_path:da},{title:bA,_path:db}]},{title:dc,_path:dd,children:[{title:bz,_path:de},{title:bA,_path:df}]}]},{title:dg,_path:dh},{title:b$,_path:di},{title:dj,_path:dk,children:[{title:dl,_path:dm},{title:dn,_path:do0}]}],"content-query-tD1yNpvbfE":{_path:b_,_dir:ca,_draft:aK,_partial:aK,_locale:cb,_empty:aK,title:bZ,description:C,body:{type:"root",children:[{type:a,tag:aV,props:{id:bB},children:[{type:c,value:bB}]},{type:a,tag:v,props:{},children:[{type:c,value:"vue3.0 使用了 Proxy 对象做响应式系统,让很多人都认识了 Proxy 对象,vue3.0 中的响应式数据甚至是组件实例,其实都是 Proxy 对象。但是这篇文章不是说 Proxy 对象在 vue3.0 是怎样发挥作用的,而是说说其影子兄弟 Reflect。既然是影子,自然是相映相随的。Reflect 中文解释可以是映射,也正好说明其设计初衷。简单来说 Proxy 对象代理并拦截目标对象特定行为,而这些行为都有其默认行为,而 Reflect 对象就是方便可以实现这些默认行为,Proxy 有多少拦截类型,Reflect 就实现了多少对应类型的映射函数("},{type:a,tag:bk,props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FProxy\u002FProxy",rel:[bC]},children:[{type:c,value:"Proxy 对象的拦截类型"}]},{type:c,value:i},{type:a,tag:bk,props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FReflect",rel:[bC]},children:[{type:c,value:"Reflect 对象的映射 API"}]},{type:c,value:" 如果对这个两个对象还不是很了解,可以先看看上面链接中对这两个对象的介绍)"},{type:a,tag:aj,props:{},children:[]},{type:c,value:"\n可能你会想,我都知道默认行为了,自已实现不就可以了,为什么还需要 Reflect,为了说明这个问题,下文将针对 set 这个常用拦截类型去说明,如果不用 Reflect 去实现你将遇到多少问题,才能成功实现其默认行为。"}]},{type:a,tag:aV,props:{id:dp},children:[{type:c,value:dq}]},{type:a,tag:av,props:{id:bD},children:[{type:c,value:bD}]},{type:a,tag:v,props:{},children:[{type:c,value:"下面先定义基础的代码"}]},{type:a,tag:r,props:{code:"const target = {\n  _name: '目标对象',\n  get name() {\n    return this._name;\n  },\n  set name(name) {\n    this._name = name;\n  },\n  age: 18\n};\nconst defaultProxy = new Proxy(target, {});\nconst customProxy = new Proxy(target, {\n  set(target, key, value, receiver) {\n    target[key] = value;\n  }\n});\n",language:ca,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" = {\n"}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"_name:"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:"'目标对象'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aO}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:dr}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:cc}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bE}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:cd}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bE}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:cd}]}]},{type:a,tag:b,props:{class:e,line:aw},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"age:"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:"18\n"}]}]},{type:a,tag:b,props:{class:e,line:ax},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"};\n"}]}]},{type:a,tag:b,props:{class:e,line:ay},children:[{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ds}]}]},{type:a,tag:b,props:{class:e,line:aL},children:[{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aA}]}]},{type:a,tag:b,props:{class:e,line:aM},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:aW},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bF}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bG}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:aX},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aG}]}]},{type:a,tag:b,props:{class:e,line:aY},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dt}]}]}]}]}]},{type:a,tag:av,props:{id:bH},children:[{type:c,value:bH}]},{type:a,tag:v,props:{},children:[{type:c,value:"先看设置的 target 对象,也就是代理的目标对象,先看 name 属性,可以看到该属性前面有 get set 标识,这类属性叫存取器属性,在访问值和设置值时才会惰性执行对应的 getter setter 函数。\n每一个普通对象属性都有一个对应属性描述对象,下面是其属性描述符对象"}]},{type:a,tag:r,props:{code:"Object.getOwnPropertyDescriptor(target, 'name')\n{enumerable: true, configurable: true, get: ƒ, set: ƒ}\n",language:ca,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:bl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:dr}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:du}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:du}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aZ}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"age 属性是一个数据属性,其属性描述符对象是"}]},{type:a,tag:r,props:{code:"Object.getOwnPropertyDescriptor(target, 'age')\n{value: 18, writable: true, enumerable: true, configurable: true}\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:a_}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:a$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:bl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aZ}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"如果要让一个属性变为只读可以把数据属性的 writable 设置为 false,或者把存取器属性的 set 设置为 undefined,具体怎么设置属性的描述符对象下文会有提及,以上只是稍微说一下基础的知识,下面回归正题"}]},{type:a,tag:av,props:{id:dv},children:[{type:c,value:dw}]},{type:a,tag:v,props:{},children:[{type:c,value:"defaultProxy 是一个默认的代理对象,没有设置任何拦截行为,接着设置了一个 customProxy 对象并设置了 set 拦截行为,这个方法具有 4 个参数,比较有疑惑的可能是 receiver 参数,下面通过例子就可以知道该参数的作用了。set 方法内部的代码就是要实现 set 拦截的默认行为,如果不用 Reflect 对象,实现其默认行为要遇到多少问题,就是下面要详细说明的内容。"}]},{type:a,tag:v,props:{},children:[{type:c,value:"在开始前先根据文档列出了能触发 set 拦截行为的操作"}]},{type:a,tag:bm,props:{},children:[{type:a,tag:ar,props:{},children:[{type:c,value:"Property assignment: proxy"},{type:a,tag:b,props:{},children:[{type:c,value:dx}]},{type:c,value:" = bar and proxy.foo = bar"}]},{type:a,tag:ar,props:{},children:[{type:c,value:"Inherited property assignment: Object.create(proxy)"},{type:a,tag:b,props:{},children:[{type:c,value:dx}]},{type:c,value:" = bar 代理对象位于原型链上,在这种情况下拦截函数的 receiver 指向子类实例对象"}]},{type:a,tag:ar,props:{},children:[{type:c,value:"Reflect.set() 准确来说是 Reflect.set(proxy, key, value, receiver?) 注意第一个参数是代理对象不是目标对象,receiver 是可选值,不存在时指向第一个参数"}]}]},{type:a,tag:av,props:{id:bI},children:[{type:c,value:bI}]},{type:a,tag:v,props:{},children:[{type:c,value:"先从最容易的实现开始"}]},{type:a,tag:r,props:{code:"target[key] = value;\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bF}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bG}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bJ}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"先看默认行为,这里是控制台输出"}]},{type:a,tag:r,props:{code:"defaultProxy.name = 'hello world';\n('hello world');\ntarget.name;\n('hello world');\ndefaultProxy.age = 3;\n3;\ntarget.age;\n3;\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bJ}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"再看实现的默认行为"}]},{type:a,tag:r,props:{code:"customProxy.name = 'hello world';\n('hello world');\ncustomProxy.name;\n('hello world');\ncustomProxy.age = 3;\n3;\ncustomProxy.age;\n3;\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bJ}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"看似都一样,是不是就已经成功了?下面我们把 set name 修改一下,让其读出 this"}]},{type:a,tag:r,props:{code:"set name(name) {\n  console.log(this)\n  this._name = name\n},\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bE}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bE}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"name\n"}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bK}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"设置 "},{type:a,tag:O,props:{},children:[{type:c,value:dy}]},{type:c,value:ba},{type:a,tag:O,props:{},children:[{type:c,value:ce}]},{type:a,tag:aj,props:{},children:[]},{type:c,value:bn},{type:a,tag:O,props:{},children:[{type:c,value:"customProxy.name = 'hello world'"}]},{type:c,value:ba},{type:a,tag:O,props:{},children:[{type:c,value:"{_name: \"目标对象\", age: 18}"}]},{type:a,tag:aj,props:{},children:[]},{type:c,value:bn},{type:a,tag:O,props:{},children:[{type:c,value:dy}]},{type:c,value:ba},{type:a,tag:O,props:{},children:[{type:c,value:ce}]},{type:a,tag:aj,props:{},children:[]},{type:c,value:bn},{type:a,tag:O,props:{},children:[{type:c,value:"Reflect.set(defaultProxy, 'name', 'hello world')"}]},{type:c,value:ba},{type:a,tag:O,props:{},children:[{type:c,value:ce}]},{type:a,tag:aj,props:{},children:[]},{type:c,value:bn},{type:a,tag:O,props:{},children:[{type:c,value:dz}]},{type:c,value:ba},{type:a,tag:O,props:{},children:[{type:c,value:"{a: 1}"}]},{type:a,tag:aj,props:{},children:[]},{type:c,value:bn},{type:a,tag:O,props:{},children:[{type:c,value:"Reflect.set(customProxy, 'name', 'hello world', { a: 1})"}]},{type:c,value:ba},{type:a,tag:O,props:{},children:[{type:c,value:"{_name: \"hello world\", age: 18}"}]},{type:a,tag:aj,props:{},children:[]},{type:c,value:"\n可以看出使用 cunstomProxy 其 this 值总是指向目标对象,因为我们的实现就是简单的对象属性赋值,this 自然就指向目标对象。而默认行为中,this 是指向代理对象的,而通过 "},{type:a,tag:O,props:{},children:[{type:c,value:dz}]},{type:c,value:"可以看出 this 更严格来说是指向 receiver 参数,在没有传入时就取第一个参数的值。"}]},{type:a,tag:av,props:{id:bL},children:[{type:c,value:bL}]},{type:a,tag:v,props:{},children:[{type:c,value:"很明显这里实现的默认行为是有问题的,针对这类问题可以修复为"}]},{type:a,tag:r,props:{code:"set(target, key, value, receiver) {\n  const descriptor = Object.getOwnPropertyDescriptor(target, key)\n  if(descriptor.hasOwnProperty('set')) {\n    const setter = descriptor.set\n    if(typeof setter === 'function' ) {\n      setter.call(receiver, value)\n    }\n  } else {\n    target[key] = value\n  }\n}\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:m},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bo}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bb}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bM}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bc}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bp}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bN}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:bq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:br}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:cf}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:bs}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bt}]}]},{type:a,tag:b,props:{class:e,line:aw},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bF}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bG}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:dA}]}]},{type:a,tag:b,props:{class:e,line:ax},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aG}]}]},{type:a,tag:b,props:{class:e,line:ay},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aZ}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"然后按上面的测试方法,测试了一番,发现都满足默认行为了,但是到这步只解决了存取器属性的问题,还有数据属性的还没有解决,下面看看数据属性你会遇到什么问题。"}]},{type:a,tag:aV,props:{id:dB},children:[{type:c,value:dC}]},{type:a,tag:av,props:{id:dD},children:[{type:c,value:dE}]},{type:a,tag:v,props:{},children:[{type:c,value:"在开始介绍这个问题前,先增加默认代理对象和实现代理对象一个 defineProperty 拦截,由于是针对 set 拦截实现默认行为,为了不引入其他问题,直接就使用 "},{type:a,tag:O,props:{},children:[{type:c,value:"return Reflect.defineProperty(target, property, descriptor)"}]},{type:c,value:" 实现 defineProperty 拦截的默认行为"}]},{type:a,tag:r,props:{code:"const defaultProxy = new Proxy(target, {\n  defineProperty(target, property, descriptor) {\n    console.log(`defaultProxy defineProperty 拦截触发`, target, property, descriptor);\n    return Reflect.defineProperty(target, property, descriptor);\n  }\n});\nconst customProxy = new Proxy(target, {\n  set(target, key, value, receiver) {\n    const descriptor = Object.getOwnPropertyDescriptor(target, key);\n    if (descriptor.hasOwnProperty('set')) {\n      const setter = descriptor.set;\n      if (typeof setter === 'function') {\n        setter.call(receiver, value);\n      }\n    } else {\n      target[key] = value;\n    }\n  },\n  defineProperty(target, property, descriptor) {\n    console.log(`cunstomProxy defineProperty 拦截触发`, target, property, descriptor);\n    return Reflect.defineProperty(target, property, descriptor);\n  }\n});\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aA}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bd}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:"`defaultProxy defineProperty 拦截触发`"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bd}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bd}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aG}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:be}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aA}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:aw},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:ax},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bo}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bb}]}]},{type:a,tag:b,props:{class:e,line:ay},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:aL},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bc}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bp}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:aM},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"        "}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:bq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:aW},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"      }\n"}]}]},{type:a,tag:b,props:{class:e,line:aX},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"    } "}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:bs}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bt}]}]},{type:a,tag:b,props:{class:e,line:aY},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bF}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bG}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:bv},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:br}]}]},{type:a,tag:b,props:{class:e,line:bw},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:cd}]}]},{type:a,tag:b,props:{class:e,line:bO},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bd}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:bP},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:"`cunstomProxy defineProperty 拦截触发`"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bd}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:bQ},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bd}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:bR},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aG}]}]},{type:a,tag:b,props:{class:e,line:bS},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dt}]}]}]}]}]},{type:a,tag:av,props:{id:bT},children:[{type:c,value:bT}]},{type:a,tag:v,props:{},children:[{type:c,value:"下面执行默认行为"}]},{type:a,tag:r,props:{code:"defaultProxy.name = 'hello world'\nProxy {_name: \"目标对象\", age: 18}\ndefaultProxy defineProperty 拦截触发 {_name: \"目标对象\", age: 18} _name {value: \"hello world\"}\n\"hello world\"\ndefaultProxy.age = 3\ndefaultProxy defineProperty 拦截触发 {_name: \"hello world\", age: 18} age {value: 3}\n3\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:cg}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ch}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bg}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bx}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bg}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bU}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:n},children:[{type:c,value:ci}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:cj}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bx}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bU}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"下面执行实现行为"}]},{type:a,tag:r,props:{code:"customProxy.name = 'hello world'\nProxy {_name: \"目标对象\", age: 18}\n\"hello world\"\ncustomProxy.age = 3\n3\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:cg}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ch}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bg}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:n},children:[{type:c,value:ci}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:cj}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"可以看出默认的代理行为在设置属性时会触发 defineProperty 拦截,而查看文档你会发现,触发 defineProperty 拦截的行为有"}]},{type:a,tag:bm,props:{},children:[{type:a,tag:ar,props:{},children:[{type:c,value:"Object.defineProperty()"}]},{type:a,tag:ar,props:{},children:[{type:c,value:"Reflect.defineProperty()"},{type:a,tag:aj,props:{},children:[]},{type:c,value:"\n这里没有提到对象属性赋值也会触发 defineProperty 拦截,那这个触发行为应该是 set 默认行为所触发,如果要实现该默认行为也需要在 set 拦截中去实现。\n仔细分析以上的输出可以发现,触发 defineProperty 拦截的属性是 "},{type:a,tag:O,props:{},children:[{type:c,value:ad}]},{type:c,value:" 和 "},{type:a,tag:O,props:{},children:[{type:c,value:A}]},{type:c,value:",并没有 "},{type:a,tag:O,props:{},children:[{type:c,value:P}]},{type:c,value:i},{type:a,tag:O,props:{},children:[{type:c,value:ad}]},{type:c,value:" 是因为在设置 name 属性时在对应的 setter 函数执行时进行赋值的,从而执行对应的拦截函数,也就是在设置数据属性时会触发 defineProperty 拦截,而设置存取性属性时并不会触发 defineProperty 拦截。"}]}]},{type:a,tag:av,props:{id:bV},children:[{type:c,value:bV}]},{type:a,tag:v,props:{},children:[{type:c,value:"基于上面的分析,让 set 拦截触发 defineProperty 拦截"}]},{type:a,tag:r,props:{code:"set(target, key, value, receiver) {\n  const descriptor = Object.getOwnPropertyDescriptor(target, key)\n  if(descriptor.hasOwnProperty('set')) {\n    const setter = descriptor.set\n    if(typeof setter === 'function' ) {\n      setter.call(receiver, value)\n    }\n  } else {\n    Object.defineProperty(receiver, key, {\n      value: value\n    })\n  }\n},\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:m},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bo}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bb}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bM}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bc}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bp}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bN}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:bq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:br}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:cf}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:bs}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bt}]}]},{type:a,tag:b,props:{class:e,line:aw},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aA}]}]},{type:a,tag:b,props:{class:e,line:ax},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:dA}]}]},{type:a,tag:b,props:{class:e,line:ay},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dF}]}]},{type:a,tag:b,props:{class:e,line:aL},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aG}]}]},{type:a,tag:b,props:{class:e,line:aM},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bK}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"再次运行测试"}]},{type:a,tag:r,props:{code:"customProxy.name = 'hello world'\nProxy {_name: \"目标对象\", age: 18}\ncunstomProxy defineProperty 拦截触发 {_name: \"目标对象\", age: 18} _name {value: \"hello world\"}\n\"hello world\"\ncustomProxy.age = 3\ncunstomProxy defineProperty 拦截触发 {_name: \"hello world\", age: 18} age {value: 3}\n3\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:cg}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ch}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bg}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:dG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bx}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bg}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bU}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:n},children:[{type:c,value:ci}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:cj}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:dG}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bx}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bU}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:aN}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"以上的测试都是在修改已经存在的属性,如果增加属性, "},{type:a,tag:O,props:{},children:[{type:c,value:"Object.getOwnPropertyDescriptor(target, key)"}]},{type:c,value:" 会返回 undefined,执行 hasOwnProperty 方法是会报错的。"},{type:a,tag:aj,props:{},children:[]},{type:c,value:"\n当一个属性使用对象属性赋值的方式设置时,会默认设置为数据属性,而且是可枚举可配置和可写的。"},{type:a,tag:aj,props:{},children:[]},{type:c,value:"\n而且还有一点 Object.defineProperty 这个方法设置属性时,如果属性是新属性,那些忽略设置的描述属性都默认为 false 或者是 undefined,如果是已经存在的属性,忽略设置的描述属性取原来的值,例如"}]},{type:a,tag:r,props:{code:"let o = {}\nObject.defineProperty(o, 'value', { value: '2'})\n{value: \"2\"}\nObject.getOwnPropertyDescriptor(o, 'value')\n{value: \"2\", writable: false, enumerable: false, configurable: false}\no.name = 'hh'\n\"hh\"\nObject.getOwnPropertyDescriptor(o, 'name')\n{value: \"hh\", writable: true, enumerable: true, configurable: true}configurable: trueenumerable: truevalue: \"hh\"writable: true__proto__: Object\nObject.defineProperty(o, 'name', { value: '3', enumerable: false})\n{value: \"2\", name: \"3\"}\nObject.getOwnPropertyDescriptor(o, 'name')\n{value: \"3\", writable: true, enumerable: false, configurable: true}\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:o},children:[{type:c,value:"let"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:" = {}\n"}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:dH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dI}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:"'2'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dJ}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:ck}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:dH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:ck}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:a$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bi}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:bl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bi}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bi}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:"'hh'\n"}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:n},children:[{type:c,value:"\"hh\"\n"}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:aw},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:dK}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:a$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:bl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aZ}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:"trueenumerable"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:"truevalue"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:dK}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:a$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:"true__proto__"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:"Object\n"}]}]},{type:a,tag:b,props:{class:e,line:ax},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dI}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:"'3'"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bi}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dJ}]}]},{type:a,tag:b,props:{class:e,line:ay},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:ck}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:dL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:aL},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:aM},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aR}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:dL}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:a$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:bl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bi}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aZ}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"基于这些要求重新修改 set 实现"}]},{type:a,tag:r,props:{code:"set(target, key, value, receiver) {\n  const descriptor = Object.getOwnPropertyDescriptor(target, key)\n  if(descriptor && descriptor.hasOwnProperty('set')) {\n    const setter = descriptor.set\n    if(typeof setter === 'function' ) {\n      setter.call(receiver, value)\n    }\n  } else {\n    Object.defineProperty(receiver, key, descriptor ? {\n      value: value, \u002F\u002F 为保持和默认行为一致,不能修改 descriptor.value 后把 descriptor 返回\n    } : {\n      value: value,\n      writable: true,\n      enumerable: true,\n      configurable: true\n    })\n  }\n},\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:m},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dM}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bo}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bb}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bM}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:bc}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bp}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bN}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:bq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:br}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:cf}]},{type:a,tag:b,props:{class:ac},children:[{type:c,value:bs}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bt}]}]},{type:a,tag:b,props:{class:e,line:aw},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:dN}]}]},{type:a,tag:b,props:{class:e,line:ax},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:dO}]}]},{type:a,tag:b,props:{class:e,line:ay},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:"    } : {\n"}]}]},{type:a,tag:b,props:{class:e,line:aL},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aO}]}]},{type:a,tag:b,props:{class:e,line:aM},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:dP}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aO}]}]},{type:a,tag:b,props:{class:e,line:aW},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:cl}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aO}]}]},{type:a,tag:b,props:{class:e,line:aX},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:dQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:o},children:[{type:c,value:by}]}]},{type:a,tag:b,props:{class:e,line:aY},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:dF}]}]},{type:a,tag:b,props:{class:e,line:bv},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:aG}]}]},{type:a,tag:b,props:{class:e,line:bw},children:[{type:a,tag:b,props:{class:d},children:[{type:c,value:bK}]}]}]}]}]},{type:a,tag:av,props:{id:dR},children:[{type:c,value:dS}]},{type:a,tag:v,props:{},children:[{type:c,value:"基于上面的实现,也实现了在代理对象作用原型对象时,把数据属性设置在子类实例身上。\n看下面的例子"}]},{type:a,tag:r,props:{code:"const children = Object.create(target);\nchildren.name = 'hello world';\nconsole.log(children.hasOwnProperty('name')); \u002F\u002F false\nconsole.log(children.hasOwnProperty('_name')); \u002F\u002F true\nchildren.age = 3;\nconsole.log(children.hasOwnProperty('age')); \u002F\u002F true\nconsole.log(children.age); \u002F\u002F 3\nconsole.log(target.age); \u002F\u002F 18\n\nconst children2 = Object.create(defaultProxy);\nchildren.name = 'hello world';\nconsole.log(children.hasOwnProperty('name')); \u002F\u002F false\nconsole.log(children.hasOwnProperty('_name')); \u002F\u002F true\nchildren.age = 3;\nconsole.log(children.hasOwnProperty('age')); \u002F\u002F true\nconsole.log(children.age); \u002F\u002F 3\nconsole.log(target.age); \u002F\u002F 18\n\nconst children3 = Object.create(customProxy);\nchildren.name = 'hello world';\nconsole.log(children.hasOwnProperty('name')); \u002F\u002F false\nconsole.log(children.hasOwnProperty('_name')); \u002F\u002F true\nchildren.age = 3;\nconsole.log(children.hasOwnProperty('age')); \u002F\u002F true\nconsole.log(children.age); \u002F\u002F 3\nconsole.log(target.age); \u002F\u002F 18\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:cm}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:cn}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:co}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:bj}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:a_}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:bj}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:cp}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:dT}]}]},{type:a,tag:b,props:{class:e,line:aw},children:[{type:a,tag:b,props:{},children:[{type:c,value:cq}]}]},{type:a,tag:b,props:{class:e,line:ax},children:[{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:"children2"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:cm}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:ay},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:aL},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:cn}]}]},{type:a,tag:b,props:{class:e,line:aM},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:co}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:bj}]}]},{type:a,tag:b,props:{class:e,line:aW},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:aX},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:a_}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:bj}]}]},{type:a,tag:b,props:{class:e,line:aY},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:cp}]}]},{type:a,tag:b,props:{class:e,line:bv},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:dT}]}]},{type:a,tag:b,props:{class:e,line:bw},children:[{type:a,tag:b,props:{},children:[{type:c,value:cq}]}]},{type:a,tag:b,props:{class:e,line:bO},children:[{type:a,tag:b,props:{class:o},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:_},children:[{type:c,value:"children3"}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:cm}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:al}]}]},{type:a,tag:b,props:{class:e,line:bP},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:P}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:aH}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:bQ},children:[{type:a,tag:b,props:{class:f},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:aQ}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:cn}]}]},{type:a,tag:b,props:{class:e,line:bR},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:co}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:bj}]}]},{type:a,tag:b,props:{class:e,line:bS},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:aE},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:cr},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:a_}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aJ}]},{type:a,tag:b,props:{class:at},children:[{type:c,value:bj}]}]},{type:a,tag:b,props:{class:e,line:cs},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:T}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:cp}]}]},{type:a,tag:b,props:{class:e,line:26},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:"\u002F\u002F 18"}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"当代理对象在原型链上时,子类实例设置属性时,一样会触发代理的拦截行为,这个时候 receiver 参数的值表示的是子类实例,也就是这里的 children,如果 children 设置的属性是存取器属性默认会调用原型链对象中对应属性的 getter setter 函数,而并不会设置在 children 身上。如果是新属性或者是数据属性,那么会设置在自身身上,并不会修改原型链上的属性。如果不采用 defineProperty 进行设置,直接通过 "},{type:a,tag:O,props:{},children:[{type:c,value:" receiver[key] = value"}]},{type:c,value:" 来实现,就会出现无限递归。"},{type:a,tag:aj,props:{},children:[]},{type:c,value:"\n数据属性和存取器属性都修复了,还有什么问题吗"}]},{type:a,tag:aV,props:{id:dU},children:[{type:c,value:dV}]},{type:a,tag:v,props:{},children:[{type:c,value:"如果你有看文档,你会发现每一个拦截操作中都有一个 Invariants,中文翻译为不变式。我的理解就是对拦截行为的限制,如果你的拦截行为超出了限制,就会报 TypeError"},{type:a,tag:aj,props:{},children:[]},{type:c,value:"\n先来看看 set 拦截的限制"}]},{type:a,tag:bm,props:{},children:[{type:a,tag:ar,props:{},children:[{type:c,value:"Cannot change the value of a property to be different from the value of the corresponding target object property if the corresponding target object property is a non-writable, non-configurable data property.\n这条限制是针对数据属性的,如果设置的对象属性是非可配置和非可读的,那么拦截函数不能返回 true"}]},{type:a,tag:ar,props:{},children:[{type:c,value:"Cannot set the value of a property if the corresponding target object property is a non-configurable accessor property that has undefined as its [[Set]] attribute\n这条限制是针对存取器属性的,如果设置的对象属性是非可配置且 set 为 undefined,,那么拦截函数不能返回 true"}]},{type:a,tag:ar,props:{},children:[{type:c,value:"In strict mode, a false return value from the set() handler will throw a TypeError exception.\n前两条都表明该属性如果是只读属性,就应该是不能修改的,最后一条就是在严格模式下如果返回 false 会触发报错"}]}]},{type:a,tag:r,props:{code:"const o = {};\nObject.defineProperty(o, 'level', {\n  value: 5 \u002F\u002F 没有设置的描述属性均为 false\n});\nObject.defineProperty(o, 'grade', {\n  set: undefined \u002F\u002F 没有设置的描述属性均为 false, get 为 undefined\n});\nconst proxy = new Proxy(o, {\n  set() {\n    return true; \u002F\u002F 强行认为可以修改,就会触发拦截行为限制错误\n  }\n});\n\u002F\u002F proxy.level = 666 \u002F\u002F Uncaught TypeError: 'set' on proxy: trap returned truish for property 'level' which exists in the proxy target as a non-configurable and non-writable data property with a different value\n\u002F\u002F proxy.grade = 666 \u002F\u002F Uncaught TypeError: 'set' on proxy: trap returned truish for property 'grade' which exists in the proxy target as a non-configurable and non-writable accessor property without a setter\n\nvoid (function () {\n  'use strict';\n  const proxy2 = new Proxy(o, {\n    set() {\n      return false;\n    }\n  });\n  proxy2.a = 1;\n  console.log(o); \u002F\u002F Uncaught TypeError: 'set' on proxy: trap returned falsish for property 'a'\n})();\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:B},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:aU},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:dW}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:ct}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aA}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:aE},children:[{type:c,value:dX}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:dY}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:be}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:"'grade'"}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aA}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:"set:"}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:"undefined"}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:"\u002F\u002F 没有设置的描述属性均为 false, get 为 undefined\n"}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:be}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:B},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:aU},children:[{type:c,value:cu}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aA}]}]},{type:a,tag:b,props:{class:e,line:aw},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:cc}]}]},{type:a,tag:b,props:{class:e,line:ax},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:au},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:cv}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:"\u002F\u002F 强行认为可以修改,就会触发拦截行为限制错误\n"}]}]},{type:a,tag:b,props:{class:e,line:ay},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:aG}]}]},{type:a,tag:b,props:{class:e,line:aL},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:be}]}]},{type:a,tag:b,props:{class:e,line:aM},children:[{type:a,tag:b,props:{class:ai},children:[{type:c,value:"\u002F\u002F proxy.level = 666 \u002F\u002F Uncaught TypeError: 'set' on proxy: trap returned truish for property 'level' which exists in the proxy target as a non-configurable and non-writable data property with a different value\n"}]}]},{type:a,tag:b,props:{class:e,line:aW},children:[{type:a,tag:b,props:{class:ai},children:[{type:c,value:"\u002F\u002F proxy.grade = 666 \u002F\u002F Uncaught TypeError: 'set' on proxy: trap returned truish for property 'grade' which exists in the proxy target as a non-configurable and non-writable accessor property without a setter\n"}]}]},{type:a,tag:b,props:{class:e,line:aX},children:[{type:a,tag:b,props:{},children:[{type:c,value:cq}]}]},{type:a,tag:b,props:{class:e,line:aY},children:[{type:a,tag:b,props:{class:B},children:[{type:c,value:cw}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:cx}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:cy}]}]},{type:a,tag:b,props:{class:e,line:bv},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:cz}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:bw},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:aU},children:[{type:c,value:dZ}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aA}]}]},{type:a,tag:b,props:{class:e,line:bO},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:cc}]}]},{type:a,tag:b,props:{class:e,line:bP},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:am}]},{type:a,tag:b,props:{class:au},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bi}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:bQ},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:br}]}]},{type:a,tag:b,props:{class:e,line:bR},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:"  });\n"}]}]},{type:a,tag:b,props:{class:e,line:bS},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:dZ}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:bk}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:aE},children:[{type:c,value:"1"}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:cr},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:R}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:S}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aT}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:"\u002F\u002F Uncaught TypeError: 'set' on proxy: trap returned falsish for property 'a'\n"}]}]},{type:a,tag:b,props:{class:e,line:cs},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:d_}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"如果要正确触发这类默认行为,那么在实现中需要正确 return 设置是否成功的信息,这里可能有点难理解,可以看看这个例子"}]},{type:a,tag:r,props:{code:"const o = {};\nObject.defineProperty(o, 'level', {\n  value: 5 \u002F\u002F 没有设置的描述属性均为 false\n});\nconst proxy = new Proxy(o, {});\nproxy.level = 6;\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:B},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:aU},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:dW}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:ct}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aA}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:aE},children:[{type:c,value:dX}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:dY}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:be}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:B},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:aU},children:[{type:c,value:cu}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aP}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:az}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:ab}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ds}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:cu}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:cA}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:aE},children:[{type:c,value:cB}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bJ}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"这个并不会报错,因为默认行为知道了这个是不能设置的,因此默认拦截函数就返回了 false,因此你如果要实现默认行为,也需要返回一个正确设置与否的信息。不能设置就应该返回 false,可以设置就应该返回 true。"}]},{type:a,tag:av,props:{id:bW},children:[{type:c,value:bW}]},{type:a,tag:v,props:{},children:[{type:c,value:"基于这点我们再来看看有返回时的实现"}]},{type:a,tag:r,props:{code:"set(target, key, value, receiver) {\nconst descriptor = Object.getOwnPropertyDescriptor(target, key)\nif (typeof descriptor === 'object') {\n  if(descriptor.configurable === 'false' && (descriptor.writable === 'false' || descriptor.set === 'undefined')) {\n    return false\n  }\n}\nif(descriptor && descriptor.hasOwnProperty('set')) {\n  const setter = descriptor.set\n  if(typeof setter === 'function' ) {\n    setter.call(receiver, value)\n    return true\n  }\n} else {\n  Object.defineProperty(receiver, key, descriptor ? {\n  value: value, \u002F\u002F 为保持和默认行为一致,不能修改 descriptor.value 后把 descriptor 返回\n  } : {\n    value: value,\n    writable: true,\n    enumerable: true,\n    configurable: true\n  })\n  return true\n}\n},\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:H},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:B},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:aU},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:aB}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:au},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bc}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:"'object'"}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:au},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:aS}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:d$}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:" && ("}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:a$}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:d$}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:" || "}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:"'undefined'"}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bb}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:au},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:"false\n"}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:aG}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:au},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:dM}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:ah}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:bo}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bb}]}]},{type:a,tag:b,props:{class:e,line:aw},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:J}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:aU},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:bM}]}]},{type:a,tag:b,props:{class:e,line:ax},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:au},children:[{type:c,value:as}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:bc}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aI}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:bp}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bN}]}]},{type:a,tag:b,props:{class:e,line:ay},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:af}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:bq}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:aL},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:au},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:by}]}]},{type:a,tag:b,props:{class:e,line:aM},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:aG}]}]},{type:a,tag:b,props:{class:e,line:aW},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:au},children:[{type:c,value:bs}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bt}]}]},{type:a,tag:b,props:{class:e,line:aX},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:z}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:dN}]}]},{type:a,tag:b,props:{class:e,line:aY},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:dO}]}]},{type:a,tag:b,props:{class:e,line:bv},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:"  } : {\n"}]}]},{type:a,tag:b,props:{class:e,line:bw},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aO}]}]},{type:a,tag:b,props:{class:e,line:bO},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:dP}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aO}]}]},{type:a,tag:b,props:{class:e,line:bP},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:cl}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:aa}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aO}]}]},{type:a,tag:b,props:{class:e,line:bQ},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:D}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:dQ}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:by}]}]},{type:a,tag:b,props:{class:e,line:bR},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:"  })\n"}]}]},{type:a,tag:b,props:{class:e,line:bS},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:au},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:by}]}]},{type:a,tag:b,props:{class:e,line:cr},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:cs},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:bK}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"下面测试一下"}]},{type:a,tag:r,props:{code:"Object.defineProperty(target, 'level', {\n  value: 5\n});\nvoid (function () {\n  'use strict';\n  defaultProxy.level = 6; \u002F\u002FUncaught TypeError: Cannot assign to read only property 'level' of object '[object Object]'\n})();\nvoid (function () {\n  'use strict';\n  customProxy.level = 6; \u002F\u002F Uncaught TypeError: 'set' on proxy: trap returned falsish for property 'level'\n})();\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:L}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:ct}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:aA}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:aD}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:aE},children:[{type:c,value:"5\n"}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:be}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:B},children:[{type:c,value:cw}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:cx}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:cy}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:cz}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:ae},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:cA}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:aE},children:[{type:c,value:cB}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:cv}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:"\u002F\u002FUncaught TypeError: Cannot assign to read only property 'level' of object '[object Object]'\n"}]}]},{type:a,tag:b,props:{class:e,line:ag},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:"})();\n"}]}]},{type:a,tag:b,props:{class:e,line:ao},children:[{type:a,tag:b,props:{class:B},children:[{type:c,value:cw}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:bf}]},{type:a,tag:b,props:{class:B},children:[{type:c,value:cx}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:cy}]}]},{type:a,tag:b,props:{class:e,line:aw},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:cz}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:F}]}]},{type:a,tag:b,props:{class:e,line:ax},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:aq}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:cA}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:s}]},{type:a,tag:b,props:{class:aE},children:[{type:c,value:cB}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:cv}]},{type:a,tag:b,props:{class:ai},children:[{type:c,value:"\u002F\u002F Uncaught TypeError: 'set' on proxy: trap returned falsish for property 'level'\n"}]}]},{type:a,tag:b,props:{class:e,line:ay},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:d_}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"虽然都按期望那样报错了,但是报错的内容不同,很明显默认行为还执行了其他的操作。"}]},{type:a,tag:aV,props:{id:bX},children:[{type:c,value:bX}]},{type:a,tag:v,props:{},children:[{type:c,value:"最后,其实还是没有实现 set 的真实默认行为,但是通过这个例子,也可以清楚了解到,要模拟真实的默认拦截行为是很复杂的,而 Reflect 设计出来就是为了解决这样的难题。"},{type:a,tag:aj,props:{},children:[]},{type:c,value:"\n下面就是正确的实现"}]},{type:a,tag:r,props:{code:"set(target, key, value, receiver) {\n  return Reflect.set(target, key, value, receiver)\n}\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:H},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:ak}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:u}]},{type:a,tag:b,props:{class:au},children:[{type:c,value:aF}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:M}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:$}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:g},children:[{type:c,value:aZ}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"如果使用了拦截函数,并需要执行默认行为,如果要保持代码的健壮性,传入的参数都需要全部传入到 Reflect 对象内,如果漏掉 receiver, receiver 会被当做第一个参数,这样就不会触发 defineProperty 拦截,这个就违背了默认行为"}]},{type:a,tag:r,props:{code:"Reflect.set(target, 'age', 3)\ntrue\nReflect.set(target, 'age', 3, defaultProxy)\ndefaultProxy defineProperty 拦截触发 {_name: \"目标对象\", age: 3} age {value: 3}\ntrue\n",language:N,meta:G},children:[{type:a,tag:K,props:{},children:[{type:a,tag:r,props:{__ignoreMap:C},children:[{type:a,tag:b,props:{class:e,line:I},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:m},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:a_}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:aE},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:x},children:[{type:a,tag:b,props:{class:B},children:[{type:c,value:by}]}]},{type:a,tag:b,props:{class:e,line:y},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:bu}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:h}]},{type:a,tag:b,props:{class:H},children:[{type:c,value:Y}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:j}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:t}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:U},children:[{type:c,value:a_}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:aE},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:k},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:g},children:[{type:c,value:Z}]}]},{type:a,tag:b,props:{class:e,line:Q},children:[{type:a,tag:b,props:{class:k},children:[{type:c,value:ap}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:W}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:l}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:bx}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:ad}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:n},children:[{type:c,value:bg}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:i}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:bh}]},{type:a,tag:b,props:{class:f},children:[{type:c,value:A}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:aC}]},{type:a,tag:b,props:{class:p},children:[{type:c,value:w}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:q}]},{type:a,tag:b,props:{class:E},children:[{type:c,value:V}]},{type:a,tag:b,props:{class:d},children:[{type:c,value:an}]}]},{type:a,tag:b,props:{class:e,line:X},children:[{type:a,tag:b,props:{class:o},children:[{type:c,value:aa}]}]}]}]}]},{type:a,tag:v,props:{},children:[{type:c,value:"还需要注意的是需要 return 该返回值,不然不会正确触发 Invariants 的限制行为"}]},{type:a,tag:v,props:{},children:[{type:c,value:"这里举的是 set 拦截的例子,其他的拦截例子,如果需要调用默认行为也都是同样的操作,注意两点"}]},{type:a,tag:bm,props:{},children:[{type:a,tag:ar,props:{},children:[{type:c,value:"Reflect 中传入全部参数"}]},{type:a,tag:ar,props:{},children:[{type:c,value:"return Reflect 的执行结果"}]}]},{type:a,tag:aV,props:{id:bY},children:[{type:c,value:bY}]},{type:a,tag:bm,props:{},children:[{type:a,tag:ar,props:{},children:[{type:a,tag:bk,props:{href:ea,rel:[bC]},children:[{type:c,value:ea}]}]},{type:a,tag:ar,props:{},children:[{type:a,tag:bk,props:{href:eb,rel:[bC]},children:[{type:c,value:eb}]}]}]},{type:a,tag:"style",children:[{type:c,value:".ct-dd5b39{color:#6A9955}\n.ct-ed2b1b{color:#C8C8C8}\n.ct-91a694{color:#B5CEA8}\n.ct-8b8177{color:#C586C0}\n.ct-020411{color:#DCDCAA}\n.ct-083033{color:#CE9178}\n.ct-a18c13{color:#9CDCFE}\n.ct-6cd240{color:#4FC1FF}\n.ct-10f473{color:#D4D4D4}\n.ct-6aa0d0{color:#569CD6}"}]}],toc:{title:C,searchDepth:x,depth:x,links:[{id:bB,depth:x,text:bB},{id:dp,depth:x,text:dq,children:[{id:bD,depth:y,text:bD},{id:bH,depth:y,text:bH},{id:dv,depth:y,text:dw},{id:bI,depth:y,text:bI},{id:bL,depth:y,text:bL}]},{id:dB,depth:x,text:dC,children:[{id:dD,depth:y,text:dE},{id:bT,depth:y,text:bT},{id:bV,depth:y,text:bV},{id:dR,depth:y,text:dS}]},{id:dU,depth:x,text:dV,children:[{id:bW,depth:y,text:bW}]},{id:bX,depth:x,text:bX},{id:bY,depth:x,text:bY}]}},_type:b$,_id:"content:articles:javaScript:ProxyAndReflect.md",_source:"content",_file:"articles\u002FjavaScript\u002FProxyAndReflect.md",_extension:"md"}},state:{},_errors:{"search-navigation":G,"content-navigation-8C37fagqQL":G,"content-query-tD1yNpvbfE":G},serverRendered:true,prerenderedAt:1691740317142,config:{public:{content:{locales:[cb],defaultLocale:cb,integrity:1691740155184,experimental:{stripQueryParameters:aK,clientDB:aK,advancedIgnoresPattern:aK},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{theme:"dark-plus"},wsUrl:C,documentDriven:aK,host:C,trailingSlash:aK,anchorLinks:{depth:Q,exclude:[I]}}},app:{baseURL:"\u002Fblog\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:C}}}}("element","span","text","ct-1c9fee","line","ct-21e7f5","ct-10f473",".",", ","(","ct-a18c13"," ","ct-bf5eb0","ct-8d33ce","ct-829377","ct-8d0700",": ","code"," = ","target","  ","p","value",2,3,"descriptor","age","ct-6aa0d0","","    ","ct-d6cb1c",";\n",null,"ct-020411",1,"const","pre","Object","key","js","code-inline","name",4,"console","log","children","ct-083033","3","defineProperty",5,"set",")\n","ct-fecd60","receiver","true","o","ct-2c3fbe","_name",6,"setter",7,"hasOwnProperty","ct-dd5b39","br",") {\n",");\n","      ","}\n",8,"defaultProxy","customProxy","li","if","ct-a6c5fd","ct-8b8177","h3",9,10,11,"Proxy",", {\n","getOwnPropertyDescriptor"," {","value:","ct-91a694","return","  }\n","'hello world'"," === ",")); ",false,12,13,"18",",\n","new","'name'","{","configurable","); ","ct-6cd240","h2",14,15,16,"}","'age'","writable"," this 的输出是 ",")) {\n","typeof","property","});\n"," (","\"目标对象\"","} ","false","\u002F\u002F true\n","a","enumerable","ul","\n设置 ","'set'","'function'","call","    }\n","else"," {\n","Reflect",17,18,"拦截触发","true\n","安装","使用说明","前言","nofollow","基础实现","this","[","] = ","存取器属性","基础实现的问题",";","},","修复存取器属性","set\n"," ) {\n",19,20,21,22,23,"分析拦截逻辑","\"hello world\"","修复数据属性","返回设置信息","总结","参考","es6 深入理解 Proxy 和 Reflect 这对影子兄弟","\u002Farticles\u002Fjavascript\u002Fproxyandreflect","markdown","javascript","zh-Hans","() {\n","  },\n","Proxy {_name: \"hello world\", age: 18}","  } ","'hello world'\n"," {","\"hello world\"\n","3\n","\"2\"","enumerable:","create","\u002F\u002F false\n","'_name'","\u002F\u002F 3\n","\n",24,25,"'level'","proxy","; ","void","function"," () {\n","'use strict'","level","6","文章","\u002Farticles","Css","\u002Farticles\u002Fcss","BFC,层叠上下文,级联层","\u002Farticles\u002Fcss\u002Fbfcstackcascading","css 各种居中方法总结","\u002Farticles\u002Fcss\u002Fcsscenter","纯 css 实现数字自增的动画效果","\u002Farticles\u002Fcss\u002Fcsspropertyatrule","JavaScript","\u002Farticles\u002Fjavascript","async\u002Fawait 异步应用的常用场景","\u002Farticles\u002Fjavascript\u002Fasyncawaitscene","柯里化在异步编程的应用","\u002Farticles\u002Fjavascript\u002Fcurryandasync","js 浮点数存储精度丢失原理","\u002Farticles\u002Fjavascript\u002Ffloatingpointlossprecision","移动端","\u002Farticles\u002Fmobile","真的，移动端尺寸自适应与 dpr 无关","\u002Farticles\u002Fmobile\u002Fselfadaptiveanddpr","浏览器插件","\u002Fbrowser_plugins","修改网页信息","\u002Fbrowser_plugins\u002Fmodifyingwebdata","\u002Fbrowser_plugins\u002Fmodifyingwebdata\u002Finstall","\u002Fbrowser_plugins\u002Fmodifyingwebdata\u002Freadme","通用文字识别","\u002Fbrowser_plugins\u002Funiversaltextrecognition","\u002Fbrowser_plugins\u002Funiversaltextrecognition\u002Finstall","\u002Fbrowser_plugins\u002Funiversaltextrecognition\u002Freadme","首页","\u002F","\u002Ftest","工具","\u002Ftools","抖音评论爬取","\u002Ftools\u002Fdouyin","unicode 字符查询","\u002Ftools\u002Funicodesearch","存取器属性搭上-receiver-参数","存取器属性搭上 receiver 参数","get",", {});\n","});","ƒ","触发-set-拦截的行为","触发 set 拦截的行为","foo","defaultProxy.name = 'hello world'","Reflect.set(defaultProxy, 'name', 'hello world', { a: 1})","value\n","隐匿的-defineproperty-陷阱拦截","隐匿的 defineProperty 陷阱拦截","增加-defineproperty-拦截","增加 defineProperty 拦截","    })\n","cunstomProxy","'value'",", { ","})\n","\"hh\"","\"3\""," && "," ? {\n","\u002F\u002F 为保持和默认行为一致,不能修改 descriptor.value 后把 descriptor 返回\n","writable:","configurable:","defineproperty-拦截的作用","defineProperty 拦截的作用","\u002F\u002F 18\n","invariants","Invariants"," = {};\n","5","\u002F\u002F 没有设置的描述属性均为 false\n","proxy2","})();","'false'","https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FProxy\u002FProxy\u002Fset","https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FReflect\u002Fset"))</script><script type="module" src="/blog/_nuxt/entry.a22f097f.js" crossorigin></script></body>
</html>